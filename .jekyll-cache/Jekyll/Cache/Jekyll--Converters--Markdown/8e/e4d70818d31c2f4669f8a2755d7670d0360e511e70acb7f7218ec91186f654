I"Ì\<p>by æŸæŸç™½ç±³é¥­</p>

<h1 id="xpath-å’Œ-lxml">XPath å’Œ lxml</h1>

<p>XPath å…¨ç§°ä¸º Xml Path Languageï¼Œå³ Xml è·¯å¾„è¯­è¨€ï¼Œæ˜¯ä¸€ç§åœ¨ Xml æ–‡æ¡£ä¸­æŸ¥æ‰¾ä¿¡æ¯çš„è¯­è¨€ã€‚å®ƒæä¾›äº†éå¸¸ç®€æ´çš„è·¯å¾„é€‰æ‹©è¡¨è¾¾å¼ï¼Œå‡ ä¹æ‰€æœ‰çš„èŠ‚ç‚¹å®šä½éƒ½å¯ä»¥ç”¨å®ƒæ¥é€‰æ‹©ã€‚</p>

<p>XPath å¯ä»¥ç”¨äº Xml å’Œ Htmlï¼Œåœ¨çˆ¬è™«ä¸­ç»å¸¸ä½¿ç”¨ XPath è·å– Html æ–‡æ¡£å†…å®¹ã€‚</p>

<p>lxml æ˜¯ Python è¯­è¨€ç”¨ Xpath è§£æ XMLã€Htmlæ–‡æ¡£åŠŸèƒ½æœ€ä¸°å¯Œçš„ã€æœ€å®¹æ˜“çš„åŠŸèƒ½æ¨¡å—ã€‚ 
<!--more--></p>
<h2 id="xpath-æœ¯è¯­">XPath æœ¯è¯­</h2>

<h3 id="èŠ‚ç‚¹">èŠ‚ç‚¹</h3>

<p>åœ¨ XPath ä¸­æœ‰ä¸ƒç§èŠ‚ç‚¹åˆ†åˆ«æ˜¯å…ƒç´ ã€å±æ€§ã€æ–‡æœ¬ã€æ–‡æ¡£ã€å‘½åç©ºé—´ã€å¤„ç†æŒ‡ä»¤ã€æ³¨é‡Šï¼Œå‰3ç§èŠ‚ç‚¹ä¸ºå¸¸ç”¨èŠ‚ç‚¹</p>

<p>è¯·çœ‹ä¸‹é¢çš„ Html ä¾‹å­ï¼Œ(æ³¨ï¼šè¿™ä¸ªä¾‹å­å…¨æ–‡éƒ½éœ€è¦ä½¿ç”¨)</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            <span class="c">&lt;!-- è¿™é‡Œæ˜¯æ³¨é‡Š --&gt;</span>
            <span class="nt">&lt;h4&gt;</span>æ‰‹æœºå“ç‰Œå•†<span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"margin-left:10px"</span><span class="nt">&gt;</span>4<span class="nt">&lt;/span&gt;&lt;/h4&gt;</span>
            <span class="nt">&lt;ul&gt;</span>
               <span class="nt">&lt;li&gt;</span>å°ç±³<span class="nt">&lt;/li&gt;</span>
               <span class="nt">&lt;li&gt;</span>åä¸º<span class="nt">&lt;/li&gt;</span> 
               <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">'blank'</span><span class="nt">&gt;</span> OPPO <span class="nt">&lt;/li&gt;</span>
               <span class="nt">&lt;li&gt;</span>è‹¹æœ<span class="nt">&lt;/li&gt;</span>
            <span class="nt">&lt;/ul&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            <span class="nt">&lt;h4&gt;</span>ç”µè„‘å“ç‰Œå•†<span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"margin-left:10px"</span><span class="nt">&gt;</span>3<span class="nt">&lt;/span&gt;&lt;/h4&gt;</span>
            <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"ul"</span> <span class="na">style=</span><span class="s">"color:red"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;li&gt;</span>æˆ´å°”<span class="nt">&lt;/li&gt;</span> 
                <span class="nt">&lt;li&gt;</span>æœºæ¢°é©å‘½<span class="nt">&lt;/li&gt;</span> 
                <span class="nt">&lt;li&gt;</span>ThinkPad<span class="nt">&lt;/li&gt;</span>
            <span class="nt">&lt;/ul&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;html&gt;</span> ä¸ºæ–‡æ¡£èŠ‚ç‚¹
<span class="nt">&lt;li&gt;</span>å°ç±³<span class="nt">&lt;/li&gt;</span> ä¸ºå…ƒç´ èŠ‚ç‚¹
class='blank' ä¸ºå±æ€§èŠ‚ç‚¹
<span class="c">&lt;!-- è¿™é‡Œæ˜¯æ³¨é‡Š --&gt;</span> ä¸ºæ³¨é‡ŠèŠ‚ç‚¹
</code></pre></div></div>

<h3 id="èŠ‚ç‚¹å…³ç³»">èŠ‚ç‚¹å…³ç³»</h3>

<p>åœ¨ XPathä¸­æœ‰å¤šä¸­èŠ‚ç‚¹å…³ç³»åˆ†åˆ«æ˜¯çˆ¶èŠ‚ç‚¹ã€å­èŠ‚ç‚¹ã€åŒèƒèŠ‚ç‚¹ã€å…ˆè¾ˆèŠ‚ç‚¹ã€åä»£èŠ‚ç‚¹</p>

<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­</p>

<ol>
  <li>çˆ¶èŠ‚ç‚¹ï¼šæ¯ä¸ªå…ƒç´ ä»¥åŠå±æ€§éƒ½æœ‰ä¸€ä¸ªçˆ¶èŠ‚ç‚¹ï¼Œå¦‚ï¼šdiv èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æ˜¯ body èŠ‚ç‚¹</li>
  <li>å­èŠ‚ç‚¹ï¼šå…ƒç´ èŠ‚ç‚¹å¯æœ‰é›¶ä¸ªã€ä¸€ä¸ªæˆ–å¤šä¸ªå­èŠ‚ç‚¹ï¼Œå¦‚ï¼šç¬¬ä¸€ä¸ª ul èŠ‚ç‚¹çš„å­èŠ‚ç‚¹æ˜¯4ä¸ª li èŠ‚ç‚¹</li>
  <li>åŒèƒèŠ‚ç‚¹ï¼šæ‹¥æœ‰ç›¸åŒçš„çˆ¶èŠ‚ç‚¹çš„èŠ‚ç‚¹ï¼Œå¦‚ï¼šä¸¤ä¸ª div èŠ‚ç‚¹æ˜¯åŒèƒèŠ‚ç‚¹</li>
  <li>å…ˆè¾ˆèŠ‚ç‚¹ï¼šæŸèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ã€çˆ¶èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹â€¦ï¼Œå¦‚ï¼šul èŠ‚ç‚¹çš„å…ˆè¾ˆèŠ‚ç‚¹æœ‰ div èŠ‚ç‚¹ã€body èŠ‚ç‚¹</li>
  <li>åä»£èŠ‚ç‚¹ï¼šæŸä¸ªèŠ‚ç‚¹çš„å­èŠ‚ç‚¹ï¼Œå­èŠ‚ç‚¹çš„å­èŠ‚ç‚¹â€¦ï¼Œå¦‚ï¼šbody èŠ‚ç‚¹çš„åä»£èŠ‚ç‚¹æœ‰div èŠ‚ç‚¹ã€ul èŠ‚ç‚¹ã€li èŠ‚ç‚¹</li>
</ol>

<h2 id="xpath-è¯­æ³•">XPath è¯­æ³•</h2>

<h3 id="åŸºæœ¬è¯­æ³•">åŸºæœ¬è¯­æ³•</h3>

<table>
  <thead>
    <tr>
      <th>è¡¨è¾¾å¼</th>
      <th>æè¿°</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>nodeName</td>
      <td>é€‰æ‹©nodeNameèŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td>/</td>
      <td>ä»æ ¹èŠ‚ç‚¹å¼€å§‹</td>
    </tr>
    <tr>
      <td>//</td>
      <td>ä»åŒ¹é…çš„èŠ‚ç‚¹å¼€å§‹é€‰æ‹©èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td>.</td>
      <td>é€‰æ‹©å½“å‰èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td>..</td>
      <td>é€‰æ‹©å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td>@</td>
      <td>é€‰æ‹©å…ƒç´ </td>
    </tr>
    <tr>
      <td>*</td>
      <td>åŒ¹é…ä»»æ„å…ƒç´ èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td>@*</td>
      <td>åŒ¹é…ä»»æ„å±æ€§èŠ‚ç‚¹</td>
    </tr>
  </tbody>
</table>

<p>ç”¨ä¸Šé¢çš„ Html æ–‡æ¡£ä¸¾ä¸ªä¾‹å­</p>

<table>
  <thead>
    <tr>
      <th>è·¯å¾„è¡¨è¾¾å¼</th>
      <th>æè¿°</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>body</td>
      <td>é€‰å– body çš„æ‰€æœ‰å­èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td>/html</td>
      <td>é€‰å– html èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td>//div</td>
      <td>é€‰å–æ‰€æœ‰ div èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td>//div/./h4</td>
      <td>div èŠ‚ç‚¹ä¸‹çš„ h4 èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td>../div</td>
      <td>é€‰å–å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰ div èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td>//@class</td>
      <td>æ‰€æœ‰å¸¦æœ‰ class å…ƒç´ çš„èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td>//*</td>
      <td>é€‰æ‹©æ‰€æœ‰èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td>//@*</td>
      <td>é€‰æ‹©æ‰€æœ‰å±æ€§èŠ‚ç‚¹</td>
    </tr>
  </tbody>
</table>

<h3 id="å¸¸ç”¨å‡½æ•°">å¸¸ç”¨å‡½æ•°</h3>

<table>
  <thead>
    <tr>
      <th>è¡¨è¾¾å¼</th>
      <th>æè¿°</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>position()</td>
      <td>è¿”å›èŠ‚ç‚¹çš„ index ä½ç½®</td>
    </tr>
    <tr>
      <td>last()</td>
      <td>è¿”å›èŠ‚ç‚¹çš„ä¸ªæ•°</td>
    </tr>
    <tr>
      <td>contains(string1,string2)</td>
      <td>string1 æ˜¯å¦åŒ…å« string2</td>
    </tr>
    <tr>
      <td>text()</td>
      <td>è¿”å›æ–‡æœ¬èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td>comment()</td>
      <td>è¿”å›æ³¨é‡ŠèŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td>normalize-space(string)</td>
      <td>å»é™¤é¦–ä½ç©ºæ ¼ï¼Œä¸­é—´å¤šä¸ªç©ºæ ¼ç”¨ä¸€ä¸ªç©ºæ ¼ä»£æ›¿</td>
    </tr>
    <tr>
      <td>substring(string,start,len)</td>
      <td>è¿”å›ä» start ä½ç½®å¼€å§‹çš„æŒ‡å®šé•¿åº¦çš„å­å­—ç¬¦ä¸²,ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸‹æ ‡ä¸º1</td>
    </tr>
    <tr>
      <td>substring-before(string1,string2)</td>
      <td>è¿”å›string1ä¸­ä½äºç¬¬ä¸€ä¸ªstring2ä¹‹å‰çš„éƒ¨åˆ†</td>
    </tr>
    <tr>
      <td>substring-after(string1,string2)</td>
      <td>è¿”å›string1ä¸­ä½äºç¬¬ä¸€ä¸ªstring2ä¹‹åçš„éƒ¨åˆ†</td>
    </tr>
  </tbody>
</table>

<p>åŒæ ·ç”¨ä¸Šé¢çš„Htmlæ–‡æ¡£ä¸¾ä¸ªä¾‹å­</p>

<table>
  <thead>
    <tr>
      <th>è·¯å¾„è¡¨è¾¾å¼</th>
      <th>æè¿°</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>//div[position()&gt;1]</td>
      <td>é€‰æ‹©ç¬¬äºŒä¸ª div èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td>//div[last()]</td>
      <td>é€‰æ‹©æœ€åä¸€ä¸ª div èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td>contains(//h4[2],â€™æ‰‹æœºâ€™)</td>
      <td>ç¬¬äºŒä¸ª h4 æ ‡ç­¾æ˜¯å¦åŒ…å«æ‰‹æœºå­—ç¬¦ä¸²</td>
    </tr>
    <tr>
      <td>//li/text()</td>
      <td>li èŠ‚ç‚¹ä¸­çš„æ–‡æœ¬å†…å®¹</td>
    </tr>
    <tr>
      <td>//div/comment()</td>
      <td>div èŠ‚ç‚¹ä¸‹çš„ html æ³¨é‡Š</td>
    </tr>
    <tr>
      <td>normalize-space(//li[@class=â€™blankâ€™])</td>
      <td>li èŠ‚ç‚¹ä¸‹ classå±æ€§ä¸º blank çš„æ–‡æœ¬å»æ‰ç©ºæ ¼</td>
    </tr>
    <tr>
      <td>substring(//h4[1],1,2)</td>
      <td>ç¬¬ä¸€ä¸ª h4 èŠ‚ç‚¹çš„å‰2ä¸ªå­—</td>
    </tr>
    <tr>
      <td>substring-before(//h4[1],â€™å“ç‰Œå•†â€™)</td>
      <td>ç¬¬ä¸€ä¸ª h4 èŠ‚ç‚¹çš„å“ç‰Œå•†å­—ç¬¦ä¸²ä¹‹å‰çš„å­—ç¬¦ä¸²</td>
    </tr>
    <tr>
      <td>substring-after(//h4[1],â€™å“ç‰Œå•†â€™)</td>
      <td>ç¬¬ä¸€ä¸ª h4 èŠ‚ç‚¹çš„å“ç‰Œå•†å­—ç¬¦ä¸²ä¹‹åçš„å­—ç¬¦ä¸²</td>
    </tr>
  </tbody>
</table>

<h3 id="è°“è¯­">è°“è¯­</h3>

<p>XPath ä¸­çš„è°“è¯­å°±æ˜¯åˆ é€‰è¡¨è¾¾å¼ï¼Œç›¸å½“äº SQL ä¸­çš„ Where æ¡ä»¶ï¼Œè°“è¯­è¢«åµŒåœ¨ [ ] ä¸­</p>

<table>
  <thead>
    <tr>
      <th>è·¯å¾„è¡¨è¾¾å¼</th>
      <th>æè¿°</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>//div[1]</td>
      <td>é€‰æ‹©ç¬¬ä¸€ä¸ª div èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td>//div[2]/ul/li[last()]</td>
      <td>é€‰æ‹©ç¬¬äºŒä¸ª div èŠ‚ç‚¹ä¸‹çš„æœ€åä¸€ä¸ª li èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td>//div[2]/ul/li[position()&gt;3]</td>
      <td>é€‰æ‹©ç¬¬äºŒä¸ª div èŠ‚ç‚¹ä¸‹çš„å‰ä¸¤ä¸ª li èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td>//ul[@class]</td>
      <td>é€‰æ‹©æ‰€æœ‰å¸¦ class å±æ€§çš„ ul èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td>//ul[@class=â€™computerâ€™]</td>
      <td>é€‰æ‹© class å±æ€§ä¸º computer çš„ ul èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td>//h4[span = 4]</td>
      <td>é€‰æ‹© h4 èŠ‚ç‚¹ä¸‹ span å€¼ç­‰äº4çš„èŠ‚ç‚¹</td>
    </tr>
  </tbody>
</table>

<h3 id="xpath-ç»“è¯­">Xpath ç»“è¯­</h3>

<p>ä»¥ä¸Šå†…å®¹ä»‹ç»äº† XPath çš„åŸºæœ¬è¯­æ³•ï¼Œä¸‹é¢å°†ä»‹ç» XPath å¦‚ä½•åœ¨ Python ä¸­ä½¿ç”¨ã€‚</p>

<h2 id="lxml-æ¨¡å—">lxml æ¨¡å—</h2>

<h3 id="å®‰è£…">å®‰è£…</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sudo</span> <span class="n">pip3</span> <span class="n">install</span> <span class="n">lxml</span><span class="o">==</span><span class="mf">4.4</span><span class="p">.</span><span class="mi">1</span>
</code></pre></div></div>

<h3 id="è§£æ-html-æ–‡æ¡£">è§£æ HTML æ–‡æ¡£</h3>

<p>lxml.etree ä¸€ä¸ªå¼ºå¤§çš„ Xml å¤„ç†æ¨¡å—ï¼Œetree ä¸­çš„ ElementTree ç±»æ˜¯ä¸€ä¸ªä¸»è¦çš„ç±»ï¼Œç”¨äºå¯¹XPathçš„è§£æã€å¢åŠ ã€åˆ é™¤å’Œä¿®æ”¹èŠ‚ç‚¹ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>
</code></pre></div></div>

<p>etree.parse() å‡½æ•°å¯ä»¥è§£æä¸€ä¸ªç½‘é¡µæ–‡ä»¶è¿˜å¯ä»¥è§£æå­—ç¬¦ä¸²ï¼Œ åœ¨ç½‘é¡µä¸­ä¸‹è½½çš„æ•°æ®ä¸€èˆ¬éƒ½æ˜¯å­—ç¬¦ä¸²å½¢å¼çš„ï¼Œä½¿ç”¨ parse(StringIO(str)) å°†æ•´ä¸ªé¡µé¢å†…å®¹è§£æåŠ è½½æ„å»ºä¸€ä¸ª ElementTree å¯¹è±¡ï¼ŒElementTree å¯ä»¥ä½¿ç”¨ XPath è¯­æ³•ç²¾å‡†æ‰¾åˆ°éœ€è¦çš„æ•°æ®ã€‚</p>

<p>1.åŠ è½½é¡µé¢åˆ°å†…å­˜</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>

<span class="n">test_html</span> <span class="o">=</span> <span class="s">'''
&lt;html&gt;
    &lt;body&gt;
        &lt;div&gt;
            &lt;!-- è¿™é‡Œæ˜¯æ³¨é‡Š --&gt;
            &lt;h4&gt;æ‰‹æœºå“ç‰Œå•†&lt;span style="margin-left:10px"&gt;4&lt;/span&gt;&lt;/h4&gt;
            &lt;ul&gt;
               &lt;li&gt;å°ç±³&lt;/li&gt;
               &lt;li&gt;åä¸º&lt;/li&gt;
               &lt;li class='blank'&gt; OPPO &lt;/li&gt;
               &lt;li&gt;è‹¹æœ&lt;/li&gt;
            &lt;/ul&gt;
        &lt;/div&gt;
        &lt;div&gt;
            &lt;h4&gt;ç”µè„‘å“ç‰Œå•†&lt;span style="margin-left:10px"&gt;3&lt;/span&gt;&lt;/h4&gt;
            &lt;ul class="ul" style="color:red"&gt;
                &lt;li&gt;æˆ´å°”&lt;/li&gt;
                &lt;li&gt;æœºæ¢°é©å‘½&lt;/li&gt;
                &lt;li&gt;ThinkPad&lt;/li&gt;
            &lt;/ul&gt;
        &lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;'''</span>

<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">test_html</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
</code></pre></div></div>

<p>ç»“æœï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;lxml.etree._ElementTree object at 0x10bd6b948&gt;
</code></pre></div></div>

<p>2.è·å–æ‰€æœ‰ li æ ‡ç­¾æ•°æ®</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">li_list</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li'</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"ç±»å‹ï¼š"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">li_list</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="s">"å€¼ï¼š"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">li_list</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"ä¸ªæ•°ï¼š"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">li_list</span><span class="p">))</span>


<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">li_list</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"liæ–‡æœ¬ä¸ºï¼š"</span> <span class="o">+</span> <span class="n">l</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></div>

<p>ç»“æœï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ç±»å‹ï¼š
&lt;class 'list'&gt;
å€¼ï¼š
[&lt;Element li at 0x10543c9c8&gt;, &lt;Element li at 0x10543ca08&gt;, &lt;Element li at 0x10543ca48&gt;, &lt;Element li at 0x10543ca88&gt;, &lt;Element li at 0x10543cac8&gt;, &lt;Element li at 0x10543cb48&gt;, &lt;Element li at 0x10543cb88&gt;]
ä¸ªæ•°ï¼š
7
liæ–‡æœ¬ä¸ºï¼šå°ç±³
liæ–‡æœ¬ä¸ºï¼šåä¸º
liæ–‡æœ¬ä¸ºï¼š OPPO 
liæ–‡æœ¬ä¸ºï¼šè‹¹æœ
liæ–‡æœ¬ä¸ºï¼šæˆ´å°”
liæ–‡æœ¬ä¸ºï¼šæœºæ¢°é©å‘½
liæ–‡æœ¬ä¸ºï¼šThinkPad
</code></pre></div></div>

<p>3.è·å–å¸¦ class=â€™blankâ€™ å±æ€§æ•°æ®</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">blank_li_list</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[@class="blank"]'</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"ç±»å‹ï¼š"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">blank_li_list</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="s">"å€¼ï¼š"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">blank_li_list</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"ä¸ªæ•°ï¼š"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">blank_li_list</span><span class="p">))</span>


<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">blank_li_list</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"liæ–‡æœ¬ä¸ºï¼š"</span> <span class="o">+</span> <span class="n">l</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></div>

<p>ç»“æœï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ç±»å‹ï¼š
&lt;class 'list'&gt;
å€¼ï¼š
[&lt;Element li at 0x105253a48&gt;]
ä¸ªæ•°ï¼š
1
liæ–‡æœ¬ä¸ºï¼š OPPO 
</code></pre></div></div>

<p>4.å±æ€§æ“ä½œ</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ul</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//ul'</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="c1">#éå†å±æ€§
</span><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">ul</span><span class="p">.</span><span class="n">attrib</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'{0}="{1}"'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

<span class="c1">#æ·»åŠ æ–°çš„å±æ€§
</span><span class="n">ul</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="s">"new_attr"</span><span class="p">,</span> <span class="s">"true"</span><span class="p">)</span>
<span class="c1"># è·å–å•ä¸ªå±æ€§
</span><span class="n">new_attr</span> <span class="o">=</span> <span class="n">ul</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'new_attr'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">new_attr</span><span class="p">)</span>
</code></pre></div></div>

<p>ç»“æœï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class="ul"
style="color:red"
true
</code></pre></div></div>

<p>5.è·å–æœ€åä¸€ä¸ªdivæ ‡ç­¾æ•°æ®</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">last_div</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//div[last()]'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"TAGï¼š"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">last_div</span><span class="p">.</span><span class="n">tag</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"å€¼ï¼š"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">last_div</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></div>

<p>ç»“æœ</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">div</span>
<span class="n">å€¼</span><span class="err">ï¼š</span>

   
</code></pre></div></div>

<p>6.æ·»åŠ å­èŠ‚ç‚¹</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">child</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">Element</span><span class="p">(</span><span class="s">"child"</span><span class="p">)</span>
<span class="n">child</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">"è¿™é‡Œæ˜¯æ–°çš„å­å…ƒç´ "</span>
<span class="n">last_div</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
<span class="c1"># åœ¨æœ€åä¸€ä¸ª div æ ‡ç­¾æŸ¥æ‰¾æ–°çš„å­å…ƒç´ 
</span><span class="n">clild_text</span> <span class="o">=</span> <span class="n">last_div</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">"child"</span><span class="p">).</span><span class="n">text</span>
<span class="k">print</span><span class="p">(</span><span class="n">clild_text</span><span class="p">)</span>
</code></pre></div></div>

<p>7.åˆ é™¤å­å…ƒç´ </p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># æŸ¥æ‰¾å¹¶è®¾ç½®ç¬¬ä¸€ä¸ªæŸ¥è¯¢åˆ°çš„å…ƒç´ 
</span><span class="n">first_ul</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">"//ul"</span><span class="p">)</span>
<span class="n">ul_li</span> <span class="o">=</span> <span class="n">first_ul</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">"li"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="n">ul_li</span><span class="p">:</span>
    <span class="c1"># åˆ é™¤å…ƒç´ 
</span>    <span class="n">first_ul</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">li</span><span class="p">)</span>

<span class="n">ul_li</span> <span class="o">=</span> <span class="n">first_ul</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">"li"</span><span class="p">)</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ul_li</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"å…ƒç´ è¢«åˆ é™¤äº†"</span><span class="p">)</span>
</code></pre></div></div>

<p>8.éå†å…ƒç´ åä»£</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">body</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">"body"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">body</span><span class="p">.</span><span class="nb">iter</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="n">sub</span><span class="p">.</span><span class="n">tag</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">sub</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></div>

<p>ç»“æœ</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>body

        
div

            
&lt;cyfunction Comment at 0x10c374b10&gt;
 è¿™é‡Œæ˜¯æ³¨é‡Š 
h4
æ‰‹æœºå“ç‰Œå•†
span
4
ul
...
</code></pre></div></div>

<h2 id="å·¥å…·">å·¥å…·</h2>

<ol>
  <li>åœ¨ google æµè§ˆå™¨å¼€å‘è€…æ¨¡å¼ä¸‹ï¼ŒElements ç•Œé¢é€‰æ‹©å…ƒç´ åå³é”® Copyï¼Œå¯ä»¥ Copy å…ƒç´ çš„ XPath è·¯å¾„</li>
  <li>XPath Helper æ˜¯ä¸€ä¸ª google æµè§ˆå™¨æ’ä»¶ï¼Œå¯ä»¥éªŒè¯ XPath æ˜¯å¦æ­£ç¡®</li>
</ol>

<h2 id="æ€»ç»“">æ€»ç»“</h2>

<ol>
  <li>å­¦ä¹ äº† XPAth çš„çŸ¥è¯†ï¼Œå¯ä»¥å¿«é€ŸåŒ¹é…å•ä¸ªæˆ–å¤šä¸ªå…ƒç´ èŠ‚ç‚¹å’Œå±æ€§ï¼Œåœ¨å·¥ä½œä¸­å¤§å¤§åŠ å¿«äº†å·¥ä½œçš„æ•ˆç‡ã€‚</li>
  <li>lxml æ˜¯ä¸€ä¸ª Python ä¸­å¼ºå¤§çš„ Xml å’Œ Html å¤„ç†æ¨¡å—ï¼Œç»“åˆ XPath çš„ä½¿ç”¨åœ¨ç¨‹åºä¸­å¿«é€Ÿã€ä¾¿æ·çš„åˆ†æã€ä¿®æ”¹ç½‘é¡µå†…å®¹ã€‚</li>
</ol>

<blockquote>
  <p>ç¤ºä¾‹ä»£ç ï¼š<a href="https://github.com/JustDoPython/python-100-day/tree/master/day-064">Python-100-days-day064</a></p>
</blockquote>

:ET