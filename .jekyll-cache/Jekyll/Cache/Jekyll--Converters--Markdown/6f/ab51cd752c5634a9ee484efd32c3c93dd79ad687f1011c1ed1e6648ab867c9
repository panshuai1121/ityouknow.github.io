I"¨3<p>ä¸Šç¯‡æ–‡ç« <a href="http://www.ityouknow.com/docker/2018/03/22/docker-compose.html">Docker(å››)ï¼šDocker ä¸‰å‰‘å®¢ä¹‹ Docker Compose </a>ä»‹ç»äº† Docker Composeï¼Œè¿™ç¯‡æ–‡ç« æˆ‘ä»¬æ¥äº†è§£ Docker Machine ã€‚</p>

<h2 id="docker-machine-ä»‹ç»">Docker Machine ä»‹ç»</h2>

<p>Docker Machine æ˜¯ Docker å®˜æ–¹ç¼–æ’ï¼ˆOrchestrationï¼‰é¡¹ç›®ä¹‹ä¸€ï¼Œè´Ÿè´£åœ¨å¤šç§å¹³å°ä¸Šå¿«é€Ÿå®‰è£… Docker ç¯å¢ƒã€‚</p>

<p>Docker Machine æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œå®ƒå…è®¸ä½ åœ¨è™šæ‹Ÿå®¿ä¸»æœºä¸Šå®‰è£… Docker Engine ï¼Œå¹¶ä½¿ç”¨ docker-machine  å‘½ä»¤ç®¡ç†è¿™äº›å®¿ä¸»æœºã€‚ä½ å¯ä»¥ä½¿ç”¨ Machine åœ¨ä½ æœ¬åœ°çš„ Mac æˆ– Windows boxã€å…¬å¸ç½‘ç»œã€æ•°æ®ä¸­å¿ƒã€æˆ–åƒ AWS æˆ– Digital Ocean è¿™æ ·çš„äº‘æä¾›å•†ä¸Šåˆ›å»º Docker å®¿ä¸»æœºã€‚</p>

<p>ä½¿ç”¨ docker-machine å‘½ä»¤ï¼Œä½ å¯ä»¥å¯åŠ¨ã€å®¡æŸ¥ã€åœæ­¢å’Œé‡æ–°å¯åŠ¨æ‰˜ç®¡çš„å®¿ä¸»æœºã€å‡çº§ Docker å®¢æˆ·ç«¯å’Œå®ˆæŠ¤ç¨‹åºã€å¹¶é…ç½® Docker å®¢æˆ·ç«¯ä¸ä½ çš„å®¿ä¸»æœºé€šä¿¡ã€‚</p>

<h2 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å®ƒ">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å®ƒï¼Ÿ</h2>

<p>Docker Machine ä½¿ä½ èƒ½å¤Ÿåœ¨å„ç§ Linux ä¸Šé…ç½®å¤šä¸ªè¿œç¨‹ Docker å®¿ä¸»æœºã€‚
æ­¤å¤–ï¼ŒMachine å…è®¸ä½ åœ¨è¾ƒæ—©çš„ Mac æˆ– Windows ç³»ç»Ÿä¸Šè¿è¡Œ Dockerï¼Œå¦‚ä¸Šä¸€ä¸»é¢˜æ‰€è¿°ã€‚
Docker Machine æœ‰è¿™ä¸¤ä¸ªå¹¿æ³›çš„ç”¨ä¾‹ã€‚</p>

<ul>
  <li>æˆ‘æœ‰ä¸€ä¸ªè¾ƒæ—§çš„æ¡Œé¢ç³»ç»Ÿï¼Œå¹¶å¸Œæœ›åœ¨ Mac æˆ– Windows ä¸Šè¿è¡Œ Docker</li>
</ul>

<p><img src="http://favorites.ren/assets/images/2018/docker/machine-mac-win.png" alt="" /></p>

<p>å¦‚æœä½ ä¸»è¦åœ¨ä¸ç¬¦åˆæ–°çš„ Docker for Mac å’Œ Docker for Windows åº”ç”¨ç¨‹åºçš„æ—§ Mac æˆ– Windows ç¬”è®°æœ¬ç”µè„‘æˆ–å°å¼æœºä¸Šå·¥ä½œï¼Œåˆ™éœ€è¦ Docker Machine æ¥åœ¨æœ¬åœ°â€œè¿è¡ŒDockerâ€ï¼ˆå³Docker Engineï¼‰ã€‚åœ¨ Mac æˆ– Windows box ä¸­ä½¿ç”¨ Docker Toolbox å®‰è£…ç¨‹åºå®‰è£… Docker Machine å°†ä¸º Docker Engine é…ç½®ä¸€ä¸ªæœ¬åœ°çš„è™šæ‹Ÿæœºï¼Œä½¿ä½ èƒ½å¤Ÿè¿æ¥å®ƒã€å¹¶è¿è¡Œ docker å‘½ä»¤ã€‚</p>

<ul>
  <li>æˆ‘æƒ³åœ¨è¿œç¨‹ç³»ç»Ÿä¸Šé…ç½® Docker å®¿ä¸»æœº</li>
</ul>

<p><img src="http://favorites.ren/assets/images/2018/docker/provision-use-case.png" alt="" /></p>

<p>Docker Engine Linux ç³»ç»Ÿä¸ŠåŸç”Ÿåœ°è¿è¡Œã€‚å¦‚æœä½ æœ‰ä¸€ä¸ª Linux ä½œä¸ºä½ çš„ä¸»ç³»ç»Ÿï¼Œå¹¶ä¸”æƒ³è¦è¿è¡Œ docker å‘½ä»¤ï¼Œæ‰€æœ‰ä½ éœ€è¦åšçš„å°±æ˜¯ä¸‹è½½å¹¶å®‰è£… Docker Engine ã€‚ç„¶è€Œï¼Œå¦‚æœä½ æƒ³è¦åœ¨ç½‘ç»œä¸Šã€äº‘ä¸­ç”šè‡³æœ¬åœ°é…ç½®å¤šä¸ª Docker å®¿ä¸»æœºæœ‰ä¸€ä¸ªæœ‰æ•ˆçš„æ–¹å¼ï¼Œä½ éœ€è¦ Docker Machineã€‚</p>

<p>æ— è®ºä½ çš„ä¸»ç³»ç»Ÿæ˜¯ Macã€Windows è¿˜æ˜¯ Linuxï¼Œä½ éƒ½å¯ä»¥åœ¨å…¶ä¸Šå®‰è£… Docker Machineï¼Œå¹¶ä½¿ç”¨ docker-machine å‘½ä»¤æ¥é…ç½®å’Œç®¡ç†å¤§é‡çš„ Docker å®¿ä¸»æœºã€‚å®ƒä¼šè‡ªåŠ¨åˆ›å»ºå®¿ä¸»æœºã€åœ¨å…¶ä¸Šå®‰è£… Docker Engine ã€ç„¶åé…ç½® docker å®¢æˆ·ç«¯ã€‚æ¯ä¸ªè¢«ç®¡ç†çš„å®¿ä¸»æœºï¼ˆâ€œmachineâ€ï¼‰æ˜¯ Docker å®¿ä¸»æœºå’Œé…ç½®å¥½çš„å®¢æˆ·ç«¯çš„ç»“åˆã€‚</p>

<h2 id="docker-engine-å’Œ-docker-machine-æœ‰ä»€ä¹ˆåŒºåˆ«">Docker Engine å’Œ Docker Machine æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h2>

<p>å½“äººä»¬è¯´â€œDockerâ€æ—¶ï¼Œä»–ä»¬é€šå¸¸æ˜¯æŒ‡ Docker Engineï¼Œå®ƒæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯ - æœåŠ¡å™¨åº”ç”¨ç¨‹åºï¼Œç”± Docker å®ˆæŠ¤è¿›ç¨‹ã€ä¸€ä¸ªREST APIæŒ‡å®šä¸å®ˆæŠ¤è¿›ç¨‹äº¤äº’çš„æ¥å£ã€å’Œä¸€ä¸ªå‘½ä»¤è¡Œæ¥å£ï¼ˆCLIï¼‰ä¸å®ˆæŠ¤è¿›ç¨‹é€šä¿¡ï¼ˆé€šè¿‡å°è£…REST APIï¼‰ã€‚Docker Engine ä» CLI ä¸­æ¥å—docker å‘½ä»¤ï¼Œä¾‹å¦‚<code class="highlighter-rouge">docker run &lt;image&gt;</code>ã€<code class="highlighter-rouge">docker ps</code> æ¥åˆ—å‡ºæ­£åœ¨è¿è¡Œçš„å®¹å™¨ã€<code class="highlighter-rouge">docker images</code>æ¥åˆ—å‡ºé•œåƒï¼Œç­‰ç­‰ã€‚</p>

<p><img src="http://favorites.ren/assets/images/2018/docker/engine.png" alt="" /></p>

<p>Docker Machine æ˜¯ä¸€ä¸ªç”¨äºé…ç½®å’Œç®¡ç†ä½ çš„å®¿ä¸»æœºï¼ˆä¸Šé¢å…·æœ‰ Docker Engine çš„ä¸»æœºï¼‰çš„å·¥å…·ã€‚é€šå¸¸ï¼Œä½ åœ¨ä½ çš„æœ¬åœ°ç³»ç»Ÿä¸Šå®‰è£… Docker Machineã€‚Docker Machineæœ‰è‡ªå·±çš„å‘½ä»¤è¡Œå®¢æˆ·ç«¯ docker-machine å’Œ Docker Engine å®¢æˆ·ç«¯ dockerã€‚ä½ å¯ä»¥ä½¿ç”¨ Machine åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªè™šæ‹Ÿç³»ç»Ÿä¸Šå®‰è£… Docker Engineã€‚</p>

<p>è¿™äº›è™šæ‹Ÿç³»ç»Ÿå¯ä»¥æ˜¯æœ¬åœ°çš„ï¼ˆå°±åƒä½ åœ¨ Mac æˆ– Windows ä¸Šä½¿ç”¨ Machine åœ¨ VirtualBox ä¸­å®‰è£…å’Œè¿è¡Œ Docker Engine ä¸€æ ·ï¼‰æˆ–è¿œç¨‹çš„ï¼ˆå°±åƒä½ ä½¿ç”¨ Machine åœ¨äº‘æä¾›å•†ä¸Š provision Dockerized å®¿ä¸»æœºä¸€æ ·ï¼‰ã€‚Dockerized å®¿ä¸»æœºæœ¬èº«å¯ä»¥è®¤ä¸ºæ˜¯ï¼Œä¸”æœ‰æ—¶å°±ç§°ä¸ºï¼Œè¢«ç®¡ç†çš„â€œmachinesâ€ã€‚</p>

<p><img src="http://favorites.ren/assets/images/2018/docker/machine.png" alt="" /></p>

<h2 id="å®‰è£…å’Œä½¿ç”¨">å®‰è£…å’Œä½¿ç”¨</h2>

<p>Docker Machine å®‰è£…å¾ˆç®€å•</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-L</span> https://github.com/docker/machine/releases/download/v0.14.0/docker-machine-<span class="sb">`</span><span class="nb">uname</span> <span class="nt">-s</span><span class="sb">`</span>-<span class="sb">`</span><span class="nb">uname</span> <span class="nt">-m</span><span class="sb">`</span> <span class="o">&gt;</span>/tmp/docker-machine <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="nb">install</span> /tmp/docker-machine /usr/local/bin/docker-machine

<span class="c">#å®Œæˆåï¼ŒæŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯ã€‚</span>
docker-machine <span class="nt">-v</span>
docker-machine version 0.14.0, build 89b8332
</code></pre></div></div>

<h3 id="åˆ›å»ºä¸€ä¸ª-virtualbox">åˆ›å»ºä¸€ä¸ª VirtualBox</h3>

<p>æŸ¥çœ‹æ˜¯å¦å­˜åœ¨å¯ç”¨çš„ä¸»æœº</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span> docker-machine <span class="nb">ls
</span>NAME   ACTIVE   DRIVER   STATE   URL   SWARM   DOCKER   ERRORS
</code></pre></div></div>

<p>åˆ›å»ºä¸€ä¸ªä¸»æœº:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker-machine create <span class="nt">--driver</span> virtualbox default
Running pre-create checks...
<span class="o">(</span>default<span class="o">)</span> Default Boot2Docker ISO is out-of-date, downloading the latest release...
<span class="o">(</span>default<span class="o">)</span> Latest release <span class="k">for </span>github.com/boot2docker/boot2docker is v17.12.1-ce
<span class="o">(</span>default<span class="o">)</span> Downloading C:<span class="se">\U</span>sers<span class="se">\h</span>krt-neo<span class="se">\.</span>docker<span class="se">\m</span>achine<span class="se">\c</span>ache<span class="se">\b</span>oot2docker.iso from https://github.com/boot2docker/boot2docker/releases/download/v17.12.1-ce/boot2docker.iso...
<span class="o">(</span>default<span class="o">)</span> 0%....10%....20%....30%....40%....50%....60%....70%....80%....90%....100%
Creating machine...
<span class="o">(</span>default<span class="o">)</span> Copying C:<span class="se">\U</span>sers<span class="se">\h</span>krt-neo<span class="se">\.</span>docker<span class="se">\m</span>achine<span class="se">\c</span>ache<span class="se">\b</span>oot2docker.iso to C:<span class="se">\U</span>sers<span class="se">\h</span>krt-neo<span class="se">\.</span>docker<span class="se">\m</span>achine<span class="se">\m</span>achines<span class="se">\d</span>efault<span class="se">\b</span>oot2docker.iso...
<span class="o">(</span>default<span class="o">)</span> Creating VirtualBox VM...
<span class="o">(</span>default<span class="o">)</span> Creating SSH key...
<span class="o">(</span>default<span class="o">)</span> Starting the VM...
<span class="o">(</span>default<span class="o">)</span> Check network to re-create <span class="k">if </span>needed...
<span class="o">(</span>default<span class="o">)</span> Windows might ask <span class="k">for </span>the permission to configure a dhcp server. Sometimes, such confirmation window is minimized <span class="k">in </span>the taskbar.
<span class="o">(</span>default<span class="o">)</span> Waiting <span class="k">for </span>an IP...
Waiting <span class="k">for </span>machine to be running, this may take a few minutes...
Detecting operating system of created instance...
Waiting <span class="k">for </span>SSH to be available...
Detecting the provisioner...
Provisioning with boot2docker...
Copying certs to the <span class="nb">local </span>machine directory...
Copying certs to the remote machine...
Setting Docker configuration on the remote daemon...
...
</code></pre></div></div>

<p>è¿™ä¸ªå‘½ä»¤ä¼šä¸‹è½½ boot2dockerï¼ŒåŸºäº boot2docker åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿä¸»æœºã€‚boot2docker æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ linux å‘è¡Œç‰ˆï¼ŒåŸºäºä¸“é—¨ä¸ºè¿è¡Œ docker å®¹å™¨è€Œè®¾è®¡çš„ Tiny Core Linux ç³»ç»Ÿï¼Œå®Œå…¨ä» RAM è¿è¡Œï¼Œ45Mbå·¦å³ï¼Œå¯åŠ¨æ—¶é—´çº¦5sã€‚</p>

<p>å†æ¬¡æŸ¥çœ‹æœåŠ¡åˆ—è¡¨</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-machine <span class="nb">ls
</span>NAME      ACTIVE   DRIVER       STATE     URL                         SWARM   DOCKER        ERRORS
default   <span class="k">*</span>        virtualbox   Running   tcp://192.168.99.100:2376           v17.12.1-ce
</code></pre></div></div>

<p>å‘ç°å·²ç»å­˜åœ¨ä¸€ä¸ªè™šæ‹Ÿä¸»æœº</p>

<p>åˆ›å»ºä¸»æœºæˆåŠŸåï¼Œå¯ä»¥é€šè¿‡ env å‘½ä»¤æ¥è®©åç»­æ“ä½œå¯¹è±¡éƒ½æ˜¯ç›®æ ‡ä¸»æœºã€‚</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker-machine <span class="nb">env </span>default
<span class="nb">export </span><span class="nv">DOCKER_TLS_VERIFY</span><span class="o">=</span><span class="s2">"1"</span>
<span class="nb">export </span><span class="nv">DOCKER_HOST</span><span class="o">=</span><span class="s2">"tcp://192.168.99.100:2376"</span>
<span class="nb">export </span><span class="nv">DOCKER_CERT_PATH</span><span class="o">=</span><span class="s2">"C:</span><span class="se">\U</span><span class="s2">sers</span><span class="se">\h</span><span class="s2">krt-neo</span><span class="se">\.</span><span class="s2">docker</span><span class="se">\m</span><span class="s2">achine</span><span class="se">\m</span><span class="s2">achines</span><span class="se">\d</span><span class="s2">efault"</span>
<span class="nb">export </span><span class="nv">DOCKER_MACHINE_NAME</span><span class="o">=</span><span class="s2">"default"</span>
<span class="nb">export </span><span class="nv">COMPOSE_CONVERT_WINDOWS_PATHS</span><span class="o">=</span><span class="s2">"true"</span>
<span class="c"># Run this command to configure your shell:</span>
<span class="c"># eval $("D:\Program Files\Docker Toolbox\docker-machine.exe" env default)</span>
</code></pre></div></div>

<p>ç›¸å½“äºé…ç½®äº†ä¸€ä¸ªç¯å¢ƒå˜é‡ defaultï¼Œåç»­æ ¹æ®æç¤ºåœ¨å‘½ä»¤è¡Œè¾“å…¥å‘½ä»¤ä¹‹åå°±å¯ä»¥æ“ä½œ default ä¸»æœºã€‚</p>

<p>å¯ä»¥é€šè¿‡ SSH ç™»å½•åˆ°ä¸»æœº</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker-machine ssh default

docker@default:~<span class="nv">$ </span>docker <span class="nt">--version</span>
Docker version 17.12.1-ce, build 7390fc6
</code></pre></div></div>

<p>è¿æ¥åˆ°ä¸»æœºä¹‹åä½ å°±å¯ä»¥åœ¨å…¶ä¸Šä½¿ç”¨ Docker äº†ï¼Œé€€å‡ºè™šæ‹Ÿæœºä½¿ç”¨å‘½ä»¤ï¼š<code class="highlighter-rouge">exit </code></p>

<h3 id="docker-machine-å¸¸ç”¨å‘½ä»¤">Docker Machine å¸¸ç”¨å‘½ä»¤</h3>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//åˆ›å»ºè™šæ‹Ÿæœº
docker-machine create <span class="o">[</span>OPTIONS] <span class="o">[</span>arg...]

//ç§»é™¤è™šæ‹Ÿæœº
docker-machine <span class="nb">rm</span> <span class="o">[</span>OPTIONS] <span class="o">[</span>arg...]

//ç™»å½•è™šæ‹Ÿæœº
docker-machine ssh <span class="o">[</span>arg...]

//dockerå®¢æˆ·ç«¯é…ç½®ç¯å¢ƒå˜é‡
docker-machine <span class="nb">env</span> <span class="o">[</span>OPTIONS] <span class="o">[</span>arg...]

//æ£€æŸ¥æœºå­ä¿¡æ¯
docker-machine inspect

//æŸ¥çœ‹è™šæ‹Ÿæœºåˆ—è¡¨
docker-machine <span class="nb">ls</span> <span class="o">[</span>OPTIONS] <span class="o">[</span>arg...]

//æŸ¥çœ‹è™šæ‹ŸæœºçŠ¶æ€
docker-machine status <span class="o">[</span>arg...]  //ä¸€ä¸ªè™šæ‹Ÿæœºåç§°

//å¯åŠ¨è™šæ‹Ÿæœº
docker-machine start <span class="o">[</span>arg...]  //ä¸€ä¸ªæˆ–å¤šä¸ªè™šæ‹Ÿæœºåç§°

//åœæ­¢è™šæ‹Ÿæœº
docker-machine stop <span class="o">[</span>arg...]  //ä¸€ä¸ªæˆ–å¤šä¸ªè™šæ‹Ÿæœºåç§°

//é‡å¯è™šæ‹Ÿæœº
docker-machine restart <span class="o">[</span>arg...]  //ä¸€ä¸ªæˆ–å¤šä¸ªè™šæ‹Ÿæœºåç§°
</code></pre></div></div>

<blockquote>
  <p>æ›´å¤šå‚æ•°è¯·ä½¿ç”¨ docker-machine  â€“help å‘½ä»¤æŸ¥çœ‹ã€‚</p>
</blockquote>

<h2 id="æ€»ç»“">æ€»ç»“</h2>

<p>Docker Machine æœ€ä¸»è¦æœ‰ä¸¤ä¸ªä½œç”¨ï¼š</p>

<ul>
  <li>ä½¿ç”¨ Docker Machine æ–¹ä¾¿åœ¨ä¸åŒçš„ç¯å¢ƒä¸­ä½¿ç”¨ Docker ï¼Œæ¯”å¦‚ï¼šWin/Mac</li>
  <li>ä½¿ç”¨ Docker Machine æ–¹ä¾¿åœ¨äº‘ç¯å¢ƒä¸‹æ‰¹é‡éƒ¨ç½² Dockerç¯å¢ƒï¼Œæ¯”å¦‚ï¼šç§æœ‰äº‘ï¼Œå…¬æœ‰äº‘æ‰¹é‡å®‰è£…Dockerç¯å¢ƒ</li>
</ul>

<blockquote>
  <p>virtualbox å®‰è£…å¾ˆéº»çƒ¦ï¼Œæˆ‘ä½¿ç”¨çš„è™šæ‹Ÿæœºå’Œäº‘ä¸»æœºæ¥åšå®éªŒå‡æ²¡æœ‰å®‰è£…æˆåŠŸï¼Œæœ€åä½¿ç”¨çš„æ˜¯ Docker å®˜æ–¹æä¾›çš„ Windows å®‰è£…åŒ…æ¥å®Œæˆçš„ virtualbox ç›¸å…³æ“ä½œã€‚é™„ virtualbox å®˜ç½‘ï¼šhttps://www.virtualbox.org/wiki/Downloads</p>
</blockquote>

<h2 id="å‚è€ƒ">å‚è€ƒ</h2>

<p><a href="https://docs.docker.com/machine/overview/">Docker Machine Overview</a><br />
<a href="http://blog.csdn.net/cnleocc/article/details/56513004">docker-machineå¸¸ç”¨å‘½ä»¤</a></p>
:ET