I"‚/<p>äº‘æ”¶è—é¡¹ç›®å·²ç»å¼€æº2å¹´å¤šäº†ï¼Œä½œä¸ºå½“åˆåˆšå¼€å§‹å­¦ä¹  Spring Boot çš„ç»ƒæ‰‹é¡¹ç›®ï¼Œä½¿ç”¨äº†å¾ˆå¤šå½“æ—¶å¾ˆæ–°çš„æŠ€æœ¯ï¼Œç°åœ¨çœ‹æ¥å…¶å®å¾ˆå¤šæ–°æŠ€æœ¯æ˜¯æ²¡æœ‰å¿…è¦ä½¿ç”¨çš„ï¼Œä½†åšä¸ºå­¦ä¹ æ¡ˆä¾‹æ¥è®²ç¡®å®æ˜¯ä¸€ä¸ªç»ä½³çš„ Spring Boot å®è·µã€‚</p>

<p>ä»å¼€æºåˆ°ç°åœ¨ï¼Œå†™äº†ä¸€äº›æ•™ç¨‹ç»™å¤§å®¶ä»‹ç»å¦‚ä½•éƒ¨ç½²äº‘æ”¶è—ï¼Œå¦‚ä½•åœ¨IDEä¸­è¿è¡Œäº‘æ”¶è—ï¼Œä½†æ˜¯ä»ç„¶æœ‰å¾ˆå¤šçš„æœ‹å‹ä¸çŸ¥é“å¦‚ä½•ä½¿ç”¨ï¼Œå¦‚ä½•éƒ¨ç½²ï¼Ÿå°±åƒâ€œè¯·æä¾›ä¸€ä»½äº‘æ”¶è—æ•°æ®ç»“æ„â€ è¿™æ ·çš„é—®é¢˜æˆ‘è‡³å°‘éƒ½å›ç­”äº†ä¸€ç™¾å¤šæ¬¡ï¼Œå¹¶ä¸”åœ¨ github å…³é—­äº†è¿‘åä¸ªç±»ä¼¼çš„é—®é¢˜ã€‚</p>

<p>è¿™ä¹Ÿä»å¦å¤–ä¸€ä¸ªæ–¹é¢å¯ä»¥çœ‹å‡ºï¼Œéƒ¨ç½²äº‘æ”¶è—é¡¹ç›®å¯¹ä¸€äº›æœ‹å‹è¿˜æ˜¯æ¯”è¾ƒå¤æ‚ï¼Œç°åœ¨æœ‰äº† Docker æˆ‘ä»¬å°±å¯ä»¥æ„‰å¿«çš„è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåªéœ€ä¸‰æ­¥å°±å¯ä»¥éƒ¨ç½²äº‘æ”¶è—é¡¹ç›®ï¼Œæ‰“é€ ä¸“å±ä¸ªäººçš„æ”¶è—ç³»ç»Ÿã€‚</p>

<h2 id="äº‘æ”¶è—"><a href="https://github.com/cloudfavorites/favorites-web">äº‘æ”¶è—</a></h2>

<p>ä¸€äº›æœ‹å‹å¯èƒ½è¿˜ä¸äº†è§£<a href="http://favorites.ren">äº‘æ”¶è—</a>ï¼Œç»™å¤§å®¶ç®€å•ä»‹ç»ä¸€ä¸‹ï¼š</p>

<p>äº‘æ”¶è—æ˜¯ä¸€ä¸ªä½¿ç”¨ Spring Boot æ„å»ºçš„å¼€æºç½‘ç«™ï¼Œå¯ä»¥è®©ç”¨æˆ·åœ¨çº¿éšæ—¶éšåœ°æ”¶è—çš„ä¸€ä¸ªç½‘ç«™ï¼Œåœ¨ç½‘ç«™ä¸Šåˆ†ç±»æ•´ç†æ”¶è—çš„ç½‘ç«™æˆ–è€…æ–‡ç« ï¼Œå¯ä»¥ä½œä¸ºç¨åé˜…è¯»çš„ä¸€ä¸ªä¸´æ—¶å­˜æ”¾ã€‚ä½œä¸ºä¸€ä¸ªå¼€æ”¾å¼€æºçš„è½¯ä»¶ï¼Œå¯ä»¥è®©ç”¨æˆ·ä»æµè§ˆå™¨å°†æ”¶è—å¤¹å†…å®¹å¯¼å…¥åˆ°äº‘æ”¶è—ï¼Œä¹Ÿæ”¯æŒéšæ—¶å°†äº‘æ”¶è—æ”¶é›†çš„æ–‡ç« å¯¼å‡ºå»åšå¤‡ä»½ã€‚</p>

<p><strong>äº§å“ä¸»é¡µ</strong></p>

<p><a href="http://favorites.ren/">http://favorites.ren</a></p>

<p><strong>é¡¹ç›®ä¸»é¡µ</strong></p>

<p><a href="https://github.com/cloudfavorites/favorites-web">https://github.com/cloudfavorites/favorites-web</a></p>

<p><strong>äº§å“æˆªå›¾</strong></p>

<p><img src="http://favorites.ren/assets/images/2016/favorites_index.png" alt="" /></p>

<p>æ ¸å¿ƒåŠŸèƒ½ç‚¹ï¼š</p>

<ul>
  <li>æ”¶è—ã€åˆ†ç±»ã€æ£€ç´¢æ–‡ç« </li>
  <li>å¯¼å‡ºã€å¯¼å‡ºï¼ˆåŒ…æ´»ä»æµè§ˆå™¨ä¸­ï¼‰</li>
  <li>å¯ä»¥ç‚¹èµã€åˆ†äº«ã€è®¨è®º</li>
  <li>æ³¨å†Œã€ç™»å½•ã€ä¸ªäººè´¦æˆ·</li>
  <li>ä¸´æ—¶æ”¶è—ã€æŸ¥çœ‹åˆ«äººæ”¶è—</li>
  <li>å…¶å®ƒâ€¦</li>
</ul>

<p>é¡¹ç›®ä½¿ç”¨æŠ€æœ¯ï¼š</p>

<ul>
  <li>Vue</li>
  <li>Bootstrap</li>
  <li>jQuery</li>
  <li>Thymeleaf</li>
  <li>Spring Data Jpa</li>
  <li>Spring Boot Mail</li>
  <li>WebJars</li>
  <li>Mysql</li>
  <li>Tomcat</li>
  <li><del>Redis</del></li>
</ul>

<blockquote>
  <p>Redis åæœŸå»æ‰æ˜¯ç”±äºæœåŠ¡å™¨èµ„æºæœ‰é™å’Œéƒ¨ç½²éº»çƒ¦</p>
</blockquote>

<h2 id="é¡¹ç›®æ”¹é€ ">é¡¹ç›®æ”¹é€ </h2>

<p><strong>ä¾èµ–ç¯å¢ƒ</strong></p>

<p>å‡†å¤‡ä¸€å°ç³»ç»Ÿä¸º Centos 7 ä»¥ä¸Šçš„æœåŠ¡å™¨ï¼Œç³»ç»Ÿéœ€è¦å®‰è£… Docker å’Œ Docker Compos ç¯å¢ƒï¼Œå®‰è£…æ–¹æ³•å¯ä»¥å‚è€ƒå‰é¢ä¸¤ç¯‡æ–‡ç« ï¼š</p>

<ul>
  <li><a href="http://www.ityouknow.com/docker/2018/03/07/docker-introduction.html">Docker(ä¸€)ï¼šDockerå…¥é—¨æ•™ç¨‹</a></li>
  <li><a href="http://www.ityouknow.com/docker/2018/03/22/docker-compose.html">Docker(å››)ï¼šDocker ä¸‰å‰‘å®¢ä¹‹ Docker Compose</a></li>
</ul>

<p><strong>Docker åŒ–æ”¹é€ </strong></p>

<p>é¡¹ç›®æ”¹é€ åçš„é¡¹ç›®æœºæ„å›¾å¦‚ä¸‹ï¼š</p>

<p><img src="http://favorites.ren/assets/images/2018/springboot/favorites_mulu.png" alt="" /></p>

<p>å› ä¸ºä¸Šä¸€ç¯‡æ–‡ç« <a href="http://www.ityouknow.com/springboot/2018/03/28/dockercompose-springboot-mysql-nginx.html">Spring Boot 2.0(äº”)ï¼šDocker Compose + Spring Boot + Nginx + Mysql å®è·µ</a> å·²ç»ä»‹ç»äº†æ­¤ç±»é¡¹ç›®ç»“æ„å’Œå†…å®¹å«ä¹‰ï¼Œå› æ­¤è¿™é‡Œä¸»è¦æè¿°æ–°å¢å†…å®¹ã€‚</p>

<p><strong><code class="highlighter-rouge">docker-compose.yaml</code> æ–‡ä»¶</strong></p>

<p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹ä¸€ä¸‹<code class="highlighter-rouge">docker-compose.yaml</code>æ–‡ä»¶ï¼š</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: '3'
services:
  nginx:
   container_name: favorites-nginx
   image: nginx:1.13
   restart: always
   ports:
   - 80:80
   - 443:443
   volumes:
     - ./nginx/conf.d:/etc/nginx/conf.d
     - /tmp/logs:/var/log/nginx
     
    
  mysql:
   build: ./mysql
   environment:
     MYSQL_DATABASE: favorites
     MYSQL_ROOT_PASSWORD: root
     MYSQL_ROOT_HOST: '%'
     TZ: Asia/Shanghai
   ports:
   - "3306:3306"
   volumes:
     - ./mysql_data:/var/lib/mysql
   restart: always
      
  app:
    restart: always
    build: ./app
    working_dir: /app
    volumes:
      - ./app:/app
      - ~/.m2:/root/.m2
      - /tmp/logs:/usr/local/logs
    expose:
      - "8080"
    command: mvn clean spring-boot:run -Drun.profiles=docker
    depends_on:
      - nginx
      - mysql
</code></pre></div></div>

<p>ç›¸å¯¹ä¸Šä¸€ç¯‡å†…å®¹æœ¬æ¬¡çš„<code class="highlighter-rouge">docker-compose.yaml</code>æ–‡ä»¶ä¸»è¦æ–°å¢äº†ä¸¤éƒ¨åˆ†çš„å†…å®¹ï¼š</p>

<ul>
  <li>1ã€å°† Nginx å’Œ app çš„æ—¥å¿—æ˜ å°„åˆ°å®¿ä¸»æœºä¸Šï¼Œæ–¹ä¾¿æˆ‘ä»¬æŸ¥çœ‹æ—¥å¿—</li>
  <li>2ã€å°† Mysql çš„æ•°æ®å­˜å‚¨æ˜ å°„åˆ°å®¿ä¸»æœºä¸Šï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯ä¸è‡³äºå°†é›†ç¾¤å…³æ‰ä¹‹åæ•°æ®ä¸¢å¤±</li>
</ul>

<p><code class="highlighter-rouge">docker-compose.yaml</code>æ–‡ä»¶ä¸­ï¼Œæ—¥å¿—éƒ¨åˆ†ï¼š</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: '3'
services:
  nginx:
   volumes:
     - /tmp/logs:/var/log/nginx
  app:
   volumes:
     - /tmp/logs:/usr/local/logs
</code></pre></div></div>

<p>åˆ†åˆ«å°† Nginx å’Œäº‘æ”¶è—é¡¹ç›®æ—¥å¿—æ˜ å°„åˆ°å®¿ä¸»æœºçš„<code class="highlighter-rouge">/tmp/logs</code>ï¼Œæ–¹ä¾¿æˆ‘ä»¬æŸ¥çœ‹é¡¹ç›®æ—¥å¿—ã€‚</p>

<p><strong>å®šåˆ¶ mysql åˆå§‹åŒ–ä¿¡æ¯</strong></p>

<p><code class="highlighter-rouge">docker-compose.yaml</code>æ–‡ä»¶ä¸­ï¼ŒMysql å˜åŒ–å†…å®¹ï¼š</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: '3'
services:
  mysql:
   build: ./mysql
   environment:
     TZ: Asia/Shanghai
   volumes:
     - ./mysql_data:/var/lib/mysql
</code></pre></div></div>

<p>æˆ‘å°†æœ‰å˜åŒ–çš„å†…å®¹éƒ½æ‘˜äº†å‡ºæ¥ï¼Œmysql æ–°å¢äº† TZ ç¯å¢ƒå˜é‡å°†æ—¶åŒºæŒ‡å‘ä¸Šæµ·ï¼Œå¦å¤–æˆ‘ä»¬å°† Mysql é•œåƒå†…å®¹æå‡ºæ¥ï¼Œæ”¾åˆ°é¡¹ç›®çš„ mysql ç›®å½•ä¸‹å•ç‹¬æ„å»ºã€‚mysql ç›®å½•ä¸‹æœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯ Dockerfile å®šä¹‰ Mysql é•œåƒï¼Œä¸€ä¸ªæ˜¯ my.cnf æ–‡ä»¶å®šä¹‰ Mysql ç¼–ç ç­‰ä¿¡æ¯ã€‚</p>

<p>my.cnf æ–‡ä»¶å†…å®¹</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#çœç•¥ä¸€éƒ¨åˆ†</span>
...
<span class="nv">character_set_server</span><span class="o">=</span>utf8
<span class="nv">character_set_filesystem</span><span class="o">=</span>utf8
collation-server<span class="o">=</span>utf8_general_ci
init-connect<span class="o">=</span><span class="s1">'SET NAMES utf8'</span>
<span class="nv">init_connect</span><span class="o">=</span><span class="s1">'SET collation_connection = utf8_general_ci'</span>
skip-character-set-client-handshake
</code></pre></div></div>

<p>æ­¤æ–‡ä»¶ä¸»è¦çš„ä½œç”¨æ˜¯è®© Mysql æ”¯æŒ UTF-8.</p>

<p>Dockerfile æ–‡ä»¶å†…å®¹</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FROM mysql/mysql-server:5.7
COPY my.cnf /etc/my.cnf
</code></pre></div></div>

<p>ä½¿ç”¨ Mysql5.7 ç‰ˆæœ¬ï¼Œå¹¶ä¸”å°†åŒç›®å½•ä¸‹çš„ my.cnf æ‹·è´åˆ°æœåŠ¡å™¨<code class="highlighter-rouge">/etc/my.cnf</code>ä¸­</p>

<p><strong>è¿™æ · Mysql çš„ç›¸å…³ä¿¡æ¯å°±å®šä¹‰å¥½äº†ã€‚</strong></p>

<p><strong>å…¶å®ƒ</strong></p>

<p>å…¶å®ƒå†…å®¹å˜åŒ–ä¸å¤§ï¼Œnginx ç›®å½•ä¸‹å­˜æ”¾ç€ Nginx çš„é…ç½®æ–‡ä»¶ï¼Œé¡¹ç›®æ–°å¢<code class="highlighter-rouge">application-docker.properties</code>æ–‡ä»¶ï¼Œå°†æ•°æ®åº“è¿æ¥éƒ¨åˆ†ä¿®æ”¹å³å¯ã€‚</p>

<p>æ”¹é€ å®Œæˆä¹‹åï¼Œæˆ‘ä»¬åªéœ€è¦å°†é¡¹ç›®æ‹·è´åˆ°éƒ¨ç½²æœåŠ¡å™¨ç„¶åæ‰§è¡Œï¼š<code class="highlighter-rouge">docker-compose up</code>å°±å¯ä»¥å¯åŠ¨ã€‚</p>

<h2 id="éƒ¨ç½²">éƒ¨ç½²</h2>

<p>æˆ‘å·²ç»å°†é¡¹ç›®çš„æ”¹é€ å†…å®¹æäº¤åˆ° github ä¸Šé¢ï¼Œè¿™æ ·å¤§å®¶éƒ¨ç½²çš„æ—¶å€™ä»…éœ€è¦ä¸‰æ­¥ï¼Œå³å¯æˆåŠŸéƒ¨ç½²äº‘æ”¶è—é¡¹ç›®ã€‚</p>

<p>1ã€ä¸‹è½½æºç è§£å‹</p>

<p>ä¸‹è½½æœ€æ–°å‘å¸ƒç‰ˆæœ¬</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://github.com/cloudfavorites/favorites-web/archive/favorites-1.1.1.zip
</code></pre></div></div>

<p>è§£å‹</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>unzip favorites-1.1.1.zip
</code></pre></div></div>

<p>è¿›å…¥ç›®å½•</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>favorites-web-favorites-1.1.1/
</code></pre></div></div>

<p>2ã€ä¿®æ”¹é…ç½®æ–‡ä»¶</p>

<p>ä¿®æ”¹æ–‡ä»¶<code class="highlighter-rouge">application-docker.properties</code></p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vi app/src/main/resources/application-docker.properties
</code></pre></div></div>

<p>ä¿®æ”¹å†…å®¹å¦‚ä¸‹</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>favorites.base.path<span class="o">=</span>http://xx.xxx.xx.xx/ 
</code></pre></div></div>
<blockquote>
  <p>åœ°å€ä¸ºéƒ¨ç½²æœåŠ¡å™¨çš„åœ°å€</p>
</blockquote>

<p>3ã€å¯åŠ¨é¡¹ç›®</p>

<p>é…ç½®å®Œæˆåï¼Œåå°å¯åŠ¨</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@~]# docker-compose up <span class="nt">-d</span>
Creating network <span class="s2">"favoriteswebfavorites111_default"</span> with the default driver
Creating favorites-nginx                  ... <span class="k">done
</span>Creating favoriteswebfavorites111_mysql_1 ... <span class="k">done
</span>Creating favoriteswebfavorites111_app_1   ... <span class="k">done</span>
</code></pre></div></div>

<p>å¯åŠ¨å®Œæˆåï¼Œæµè§ˆå™¨è®¿é—®ä¸Šé¢é…ç½®åœ°å€ï¼š<code class="highlighter-rouge">http://xx.xxx.xx.xx/</code>ï¼Œå°±å¯ä»¥çœ‹åˆ°äº‘æ”¶è—çš„é¦–é¡µäº†ã€‚</p>

<p><strong>è¾…åŠ©å†…å®¹</strong></p>

<p>å¯åŠ¨åæƒ³æŸ¥çœ‹æŸä¸ªå®¹å™¨å†…çš„æœåŠ¡è¿è¡Œæƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›å…¥ï¼š</p>

<p>ä½¿ç”¨<code class="highlighter-rouge">docker ps</code>æŸ¥çœ‹å®¿ä¸»æœºä¸Šé¢è¿è¡Œçš„ Docker å®¹å™¨</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@VM_73_217_centos ~]# docker ps
CONTAINER ID        IMAGE                            COMMAND                  CREATED             STATUS                  PORTS                                      NAMES
a466ce6e58a5        favoriteswebfavorites111_app     <span class="s2">"/usr/local/bin/mv..."</span>   16 hours ago        Up 16 hours             8080/tcp                                   favoriteswebfavorites111_app_1
1b4f1b912de0        nginx:1.13                       <span class="s2">"nginx -g 'daemon ..."</span>   16 hours ago        Up 16 hours             0.0.0.0:80-&gt;80/tcp, 0.0.0.0:443-&gt;443/tcp   favorites-nginx
65b481bb7741        favoriteswebfavorites111_mysql   <span class="s2">"/entrypoint.sh my..."</span>   16 hours ago        Up 16 hours <span class="o">(</span>healthy<span class="o">)</span>   0.0.0.0:3306-&gt;3306/tcp, 33060/tcp          favoriteswebfavorites111_mysql_1
</code></pre></div></div>

<p>æ ¹æ®ä¸Šé¢æŸ¥è¯¢çš„ Docker å®¹å™¨ ID ä¿¡æ¯ï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker <span class="nb">exec</span> <span class="nt">-ti</span> CONTAINER_ID  bash
<span class="c">#æ¯”å¦‚è¿›å…¥é¡¹ç›®å®¹å™¨ä¸­</span>
<span class="o">[</span>root@VM_73_217_centos ~]# docker <span class="nb">exec</span> <span class="nt">-ti</span> a466ce6e58a5 bash
root@a466ce6e58a5:/app# ps <span class="nt">-ef</span>|grep java
...
</code></pre></div></div>

<p>é€€å‡ºå®¹å™¨æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@a466ce6e58a5:/app# <span class="nb">exit
exit</span>
<span class="o">[</span>root@VM_73_217_centos ~]# 
</code></pre></div></div>

<p>è¿™æ ·ä»¥åå¦‚æœæˆ‘ä»¬æƒ³éƒ¨ç½²äº‘æ”¶è—é¡¹ç›®å°±å˜çš„éå¸¸ç®€å•ï¼Œä»…ä»…éœ€è¦ä¸‰æ­¥å¯ä»¥æ„‰å¿«çš„æ­å»ºè‡ªå·±çš„æ”¶è—ç³»ç»Ÿäº†ï¼Œå°ä¼™ä¼´ä»¬èµ¶ç´§åŠ¨èµ·æ‰‹æ¥ã€‚</p>
:ET