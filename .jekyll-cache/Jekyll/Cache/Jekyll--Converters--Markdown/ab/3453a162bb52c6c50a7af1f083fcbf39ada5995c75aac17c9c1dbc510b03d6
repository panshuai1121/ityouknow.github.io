I"6<p>è¿ç”¨jvmè‡ªå¸¦çš„å‘½ä»¤å¯ä»¥æ–¹ä¾¿çš„åœ¨ç”Ÿäº§ç›‘æ§å’Œæ‰“å°å †æ ˆçš„æ—¥å¿—ä¿¡æ¯å¸®å¿™æˆ‘ä»¬æ¥å®šä½é—®é¢˜ï¼è™½ç„¶jvmè°ƒä¼˜æˆç†Ÿçš„å·¥å…·å·²ç»æœ‰å¾ˆå¤šï¼šjconsoleã€å¤§åé¼é¼çš„VisualVMï¼ŒIBMçš„Memory Analyzerç­‰ç­‰ï¼Œä½†æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒå‡ºç°é—®é¢˜çš„æ—¶å€™ï¼Œä¸€æ–¹é¢å·¥å…·çš„ä½¿ç”¨ä¼šæœ‰æ‰€é™åˆ¶ï¼Œå¦ä¸€æ–¹é¢å–œæ¬¢è£…Xçš„æˆ‘ä»¬ï¼Œæ€»å–œæ¬¢åœ¨å‡ºç°é—®é¢˜çš„æ—¶å€™åœ¨ç»ˆç«¯è¾“å…¥ä¸€äº›å‘½ä»¤æ¥è§£å†³ã€‚æ‰€æœ‰çš„å·¥å…·å‡ ä¹éƒ½æ˜¯ä¾èµ–äºjdkçš„æ¥å£å’Œåº•å±‚çš„è¿™äº›å‘½ä»¤ï¼Œç ”ç©¶è¿™äº›å‘½ä»¤çš„ä½¿ç”¨ä¹Ÿè®©æˆ‘ä»¬æ›´èƒ½äº†è§£jvmæ„æˆå’Œç‰¹æ€§ã€‚</p>

<p>Sun JDKç›‘æ§å’Œæ•…éšœå¤„ç†å‘½ä»¤æœ‰jps jstat jmap jhat jstack jinfoä¸‹é¢åšä¸€ä¸€ä»‹ç»</p>

<h2 id="jps">jps</h2>
<p>JVM Process Status Tool,æ˜¾ç¤ºæŒ‡å®šç³»ç»Ÿå†…æ‰€æœ‰çš„HotSpotè™šæ‹Ÿæœºè¿›ç¨‹ã€‚</p>

<h3 id="å‘½ä»¤æ ¼å¼">å‘½ä»¤æ ¼å¼</h3>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jps [options] [hostid]
</code></pre></div></div>

<h3 id="optionå‚æ•°">optionå‚æ•°</h3>
<blockquote>
  <ul>
    <li>-l : è¾“å‡ºä¸»ç±»å…¨åæˆ–jarè·¯å¾„</li>
    <li>-q : åªè¾“å‡ºLVMID</li>
    <li>-m : è¾“å‡ºJVMå¯åŠ¨æ—¶ä¼ é€’ç»™main()çš„å‚æ•°</li>
    <li>-v : è¾“å‡ºJVMå¯åŠ¨æ—¶æ˜¾ç¤ºæŒ‡å®šçš„JVMå‚æ•°</li>
  </ul>
</blockquote>

<p>å…¶ä¸­[option]ã€[hostid]å‚æ•°ä¹Ÿå¯ä»¥ä¸å†™ã€‚</p>

<h3 id="ç¤ºä¾‹">ç¤ºä¾‹</h3>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ jps -l -m
  28920 org.apache.catalina.startup.Bootstrap start
  11589 org.apache.catalina.startup.Bootstrap start
  25816 sun.tools.jps.Jps -l -m
</code></pre></div></div>

<h2 id="jstat">jstat</h2>
<p>jstat(JVM statistics Monitoring)æ˜¯ç”¨äºç›‘è§†è™šæ‹Ÿæœºè¿è¡Œæ—¶çŠ¶æ€ä¿¡æ¯çš„å‘½ä»¤ï¼Œå®ƒå¯ä»¥æ˜¾ç¤ºå‡ºè™šæ‹Ÿæœºè¿›ç¨‹ä¸­çš„ç±»è£…è½½ã€å†…å­˜ã€åƒåœ¾æ”¶é›†ã€JITç¼–è¯‘ç­‰è¿è¡Œæ•°æ®ã€‚</p>

<h3 id="å‘½ä»¤æ ¼å¼-1">å‘½ä»¤æ ¼å¼</h3>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jstat [option] LVMID [interval] [count]
</code></pre></div></div>

<h3 id="å‚æ•°">å‚æ•°</h3>
<blockquote>
  <ul>
    <li>[option] : æ“ä½œå‚æ•°</li>
    <li>LVMID : æœ¬åœ°è™šæ‹Ÿæœºè¿›ç¨‹ID</li>
    <li>[interval] : è¿ç»­è¾“å‡ºçš„æ—¶é—´é—´éš”</li>
    <li>[count] : è¿ç»­è¾“å‡ºçš„æ¬¡æ•°</li>
  </ul>
</blockquote>

<h4 id="option-å‚æ•°æ€»è§ˆ">option å‚æ•°æ€»è§ˆ</h4>

<table>
  <thead>
    <tr>
      <th>Option</th>
      <th>Displaysâ€¦</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>class</td>
      <td>class loaderçš„è¡Œä¸ºç»Ÿè®¡ã€‚Statistics on the behavior of the class loader.</td>
    </tr>
    <tr>
      <td>compiler</td>
      <td>HotSpt JITç¼–è¯‘å™¨è¡Œä¸ºç»Ÿè®¡ã€‚Statistics of the behavior of the HotSpot Just-in-Time compiler.</td>
    </tr>
    <tr>
      <td>gc</td>
      <td>åƒåœ¾å›æ”¶å †çš„è¡Œä¸ºç»Ÿè®¡ã€‚Statistics of the behavior of the garbage collected heap.</td>
    </tr>
    <tr>
      <td>gccapacity</td>
      <td>å„ä¸ªåƒåœ¾å›æ”¶ä»£å®¹é‡(young,old,perm)å’Œä»–ä»¬ç›¸åº”çš„ç©ºé—´ç»Ÿè®¡ã€‚Statistics of the capacities of the generations and their corresponding spaces.</td>
    </tr>
    <tr>
      <td>gcutil</td>
      <td>åƒåœ¾å›æ”¶ç»Ÿè®¡æ¦‚è¿°ã€‚Summary of garbage collection statistics.</td>
    </tr>
    <tr>
      <td>gccause</td>
      <td>åƒåœ¾æ”¶é›†ç»Ÿè®¡æ¦‚è¿°ï¼ˆåŒ-gcutilï¼‰ï¼Œé™„åŠ æœ€è¿‘ä¸¤æ¬¡åƒåœ¾å›æ”¶äº‹ä»¶çš„åŸå› ã€‚Summary of garbage collection statistics (same as -gcutil), with the cause of the last and</td>
    </tr>
    <tr>
      <td>gcnew</td>
      <td>æ–°ç”Ÿä»£è¡Œä¸ºç»Ÿè®¡ã€‚Statistics of the behavior of the new generation.</td>
    </tr>
    <tr>
      <td>gcnewcapacity</td>
      <td>æ–°ç”Ÿä»£ä¸å…¶ç›¸åº”çš„å†…å­˜ç©ºé—´çš„ç»Ÿè®¡ã€‚Statistics of the sizes of the new generations and its corresponding spaces.</td>
    </tr>
    <tr>
      <td>gcold</td>
      <td>å¹´è€ä»£å’Œæ°¸ç”Ÿä»£è¡Œä¸ºç»Ÿè®¡ã€‚Statistics of the behavior of the old and permanent generations.</td>
    </tr>
    <tr>
      <td>gcoldcapacity</td>
      <td>å¹´è€ä»£è¡Œä¸ºç»Ÿè®¡ã€‚Statistics of the sizes of the old generation.</td>
    </tr>
    <tr>
      <td>gcpermcapacity</td>
      <td>æ°¸ç”Ÿä»£è¡Œä¸ºç»Ÿè®¡ã€‚Statistics of the sizes of the permanent generation.</td>
    </tr>
    <tr>
      <td>printcompilation</td>
      <td>HotSpotç¼–è¯‘æ–¹æ³•ç»Ÿè®¡ã€‚HotSpot compilation method statistics.</td>
    </tr>
  </tbody>
</table>

<h4 id="option-å‚æ•°è¯¦è§£">option å‚æ•°è¯¦è§£</h4>

<h5 id="-class">-class</h5>
<p>ç›‘è§†ç±»è£…è½½ã€å¸è½½æ•°é‡ã€æ€»ç©ºé—´ä»¥åŠè€—è´¹çš„æ—¶é—´</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ jstat -class 11589
 Loaded  Bytes  Unloaded  Bytes     Time   
  7035  14506.3     0     0.0       3.67
</code></pre></div></div>

<blockquote>
  <ul>
    <li>Loaded : åŠ è½½classçš„æ•°é‡</li>
    <li>Bytes : classå­—èŠ‚å¤§å°</li>
    <li>Unloaded : æœªåŠ è½½classçš„æ•°é‡</li>
    <li>Bytes : æœªåŠ è½½classçš„å­—èŠ‚å¤§å°</li>
    <li>Time : åŠ è½½æ—¶é—´</li>
  </ul>
</blockquote>

<h5 id="-compiler">-compiler</h5>
<p>è¾“å‡ºJITç¼–è¯‘è¿‡çš„æ–¹æ³•æ•°é‡è€—æ—¶ç­‰</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ jstat -compiler 1262
Compiled Failed Invalid   Time   FailedType FailedMethod
    2573      1       0    47.60          1 org/apache/catalina/loader/WebappClassLoader findResourceInternal  
</code></pre></div></div>

<blockquote>
  <ul>
    <li>Compiled : ç¼–è¯‘æ•°é‡</li>
    <li>Failed : ç¼–è¯‘å¤±è´¥æ•°é‡</li>
    <li>Invalid : æ— æ•ˆæ•°é‡</li>
    <li>Time : ç¼–è¯‘è€—æ—¶</li>
    <li>FailedType : å¤±è´¥ç±»å‹</li>
    <li>FailedMethod : å¤±è´¥æ–¹æ³•çš„å…¨é™å®šå</li>
  </ul>
</blockquote>

<h5 id="-gc">-gc</h5>
<p>åƒåœ¾å›æ”¶å †çš„è¡Œä¸ºç»Ÿè®¡ï¼Œ<strong>å¸¸ç”¨å‘½ä»¤</strong></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ jstat -gc 1262
 S0C    S1C     S0U     S1U   EC       EU        OC         OU        PC       PU         YGC    YGCT    FGC    FGCT     GCT   
26112.0 24064.0 6562.5  0.0   564224.0 76274.5   434176.0   388518.3  524288.0 42724.7    320    6.417   1      0.398    6.815
</code></pre></div></div>

<p><strong>Cå³Capacity æ€»å®¹é‡ï¼ŒUå³Used å·²ä½¿ç”¨çš„å®¹é‡</strong></p>

<blockquote>
  <ul>
    <li>S0C : survivor0åŒºçš„æ€»å®¹é‡</li>
    <li>S1C : survivor1åŒºçš„æ€»å®¹é‡</li>
    <li>S0U : survivor0åŒºå·²ä½¿ç”¨çš„å®¹é‡</li>
    <li>S1U : survivor1åŒºå·²ä½¿ç”¨çš„å®¹é‡</li>
    <li>EC : EdenåŒºçš„æ€»å®¹é‡</li>
    <li>EU : EdenåŒºå·²ä½¿ç”¨çš„å®¹é‡</li>
    <li>OC : OldåŒºçš„æ€»å®¹é‡</li>
    <li>OU : OldåŒºå·²ä½¿ç”¨çš„å®¹é‡</li>
    <li>PC	å½“å‰permçš„å®¹é‡ (KB)</li>
    <li>PU	permçš„ä½¿ç”¨ (KB)</li>
    <li>YGC : æ–°ç”Ÿä»£åƒåœ¾å›æ”¶æ¬¡æ•°</li>
    <li>YGCT : æ–°ç”Ÿä»£åƒåœ¾å›æ”¶æ—¶é—´</li>
    <li>FGC : è€å¹´ä»£åƒåœ¾å›æ”¶æ¬¡æ•°</li>
    <li>FGCT : è€å¹´ä»£åƒåœ¾å›æ”¶æ—¶é—´</li>
    <li>GCT : åƒåœ¾å›æ”¶æ€»æ¶ˆè€—æ—¶é—´</li>
  </ul>
</blockquote>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ jstat -gc 1262 2000 20
</code></pre></div></div>

<p>è¿™ä¸ªå‘½ä»¤æ„æ€å°±æ˜¯æ¯éš”2000msè¾“å‡º1262çš„gcæƒ…å†µï¼Œä¸€å…±è¾“å‡º20æ¬¡</p>

<h5 id="-gccapacity">-gccapacity</h5>
<p>åŒ-gcï¼Œä¸è¿‡è¿˜ä¼šè¾“å‡ºJavaå †å„åŒºåŸŸä½¿ç”¨åˆ°çš„æœ€å¤§ã€æœ€å°ç©ºé—´</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ jstat -gccapacity 1262
 NGCMN    NGCMX     NGC    S0C   S1C       EC         OGCMN      OGCMX      OGC        OC       PGCMN    PGCMX     PGC      PC         YGC    FGC 
614400.0 614400.0 614400.0 26112.0 24064.0 564224.0   434176.0   434176.0   434176.0   434176.0 524288.0 1048576.0 524288.0 524288.0    320     1  
</code></pre></div></div>

<blockquote>
  <ul>
    <li>NGCMN : æ–°ç”Ÿä»£å ç”¨çš„æœ€å°ç©ºé—´</li>
    <li>NGCMX : æ–°ç”Ÿä»£å ç”¨çš„æœ€å¤§ç©ºé—´</li>
    <li>OGCMN : è€å¹´ä»£å ç”¨çš„æœ€å°ç©ºé—´</li>
    <li>OGCMX : è€å¹´ä»£å ç”¨çš„æœ€å¤§ç©ºé—´</li>
    <li>OGCï¼šå½“å‰å¹´è€ä»£çš„å®¹é‡ (KB)</li>
    <li>OCï¼šå½“å‰å¹´è€ä»£çš„ç©ºé—´ (KB)</li>
    <li>PGCMN : permå ç”¨çš„æœ€å°ç©ºé—´</li>
    <li>PGCMX : permå ç”¨çš„æœ€å¤§ç©ºé—´</li>
  </ul>
</blockquote>

<h5 id="-gcutil">-gcutil</h5>
<p>åŒ-gcï¼Œä¸è¿‡è¾“å‡ºçš„æ˜¯å·²ä½¿ç”¨ç©ºé—´å æ€»ç©ºé—´çš„ç™¾åˆ†æ¯”</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ jstat -gcutil 28920
  S0     S1     E      O      P     YGC     YGCT    FGC    FGCT     GCT   
 12.45   0.00  33.85   0.00   4.44  4       0.242     0    0.000    0.242
</code></pre></div></div>

<h5 id="-gccause">-gccause</h5>
<p>åƒåœ¾æ”¶é›†ç»Ÿè®¡æ¦‚è¿°ï¼ˆåŒ-gcutilï¼‰ï¼Œé™„åŠ æœ€è¿‘ä¸¤æ¬¡åƒåœ¾å›æ”¶äº‹ä»¶çš„åŸå› </p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ jstat -gccause 28920
  S0     S1     E      O      P       YGC     YGCT    FGC    FGCT     GCT    LGCC                 GCC                 
 12.45   0.00  33.85   0.00   4.44      4    0.242     0    0.000    0.242   Allocation Failure   No GC  
</code></pre></div></div>

<blockquote>
  <ul>
    <li>LGCCï¼šæœ€è¿‘åƒåœ¾å›æ”¶çš„åŸå› </li>
    <li>GCCï¼šå½“å‰åƒåœ¾å›æ”¶çš„åŸå› </li>
  </ul>
</blockquote>

<h5 id="-gcnew">-gcnew</h5>
<p>ç»Ÿè®¡æ–°ç”Ÿä»£çš„è¡Œä¸º</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ jstat -gcnew 28920
 S0C      S1C      S0U        S1U  TT  MTT  DSS      EC        EU         YGC     YGCT  
 419392.0 419392.0 52231.8    0.0  6   6    209696.0 3355520.0 1172246.0  4       0.242
</code></pre></div></div>

<blockquote>
  <ul>
    <li>TTï¼šTenuring threshold(æå‡é˜ˆå€¼)</li>
    <li>MTTï¼šæœ€å¤§çš„tenuring threshold</li>
    <li>DSSï¼šsurvivoråŒºåŸŸå¤§å° (KB)</li>
  </ul>
</blockquote>

<h5 id="-gcnewcapacity">-gcnewcapacity</h5>
<p>æ–°ç”Ÿä»£ä¸å…¶ç›¸åº”çš„å†…å­˜ç©ºé—´çš„ç»Ÿè®¡</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ jstat -gcnewcapacity 28920
  NGCMN      NGCMX       NGC      S0CMX     S0C     S1CMX     S1C       ECMX        EC        YGC   FGC 
 4194304.0  4194304.0  4194304.0 419392.0 419392.0 419392.0 419392.0  3355520.0  3355520.0     4     0
</code></pre></div></div>

<blockquote>
  <ul>
    <li>NGC:å½“å‰å¹´è½»ä»£çš„å®¹é‡ (KB)</li>
    <li>S0CMX:æœ€å¤§çš„S0ç©ºé—´ (KB)</li>
    <li>S0C:å½“å‰S0ç©ºé—´ (KB)</li>
    <li>ECMX:æœ€å¤§edenç©ºé—´ (KB)</li>
    <li>EC:å½“å‰edenç©ºé—´ (KB)</li>
  </ul>
</blockquote>

<h5 id="-gcold">-gcold</h5>
<p>ç»Ÿè®¡æ—§ç”Ÿä»£çš„è¡Œä¸º</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ jstat -gcold 28920
   PC       PU        OC           OU       YGC    FGC    FGCT     GCT   
1048576.0  46561.7   6291456.0     0.0      4      0      0.000    0.242
</code></pre></div></div>

<h5 id="-gcoldcapacity">-gcoldcapacity</h5>
<p>ç»Ÿè®¡æ—§ç”Ÿä»£çš„å¤§å°å’Œç©ºé—´</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ jstat -gcoldcapacity 28920
   OGCMN       OGCMX        OGC         OC         YGC   FGC    FGCT     GCT   
  6291456.0   6291456.0   6291456.0   6291456.0     4     0    0.000    0.242
</code></pre></div></div>

<h5 id="-gcpermcapacity">-gcpermcapacity</h5>
<p>æ°¸ç”Ÿä»£è¡Œä¸ºç»Ÿè®¡</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ jstat -gcpermcapacity 28920
    PGCMN      PGCMX       PGC         PC      YGC   FGC    FGCT     GCT   
 1048576.0  2097152.0  1048576.0  1048576.0     4     0    0.000    0.242
</code></pre></div></div>

<h5 id="-printcompilation">-printcompilation</h5>
<p>hotspotç¼–è¯‘æ–¹æ³•ç»Ÿè®¡</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ jstat -printcompilation 28920
    Compiled  Size  Type Method
    1291      78     1    java/util/ArrayList indexOf
</code></pre></div></div>

<blockquote>
  <ul>
    <li>Compiledï¼šè¢«æ‰§è¡Œçš„ç¼–è¯‘ä»»åŠ¡çš„æ•°é‡</li>
    <li>Sizeï¼šæ–¹æ³•å­—èŠ‚ç çš„å­—èŠ‚æ•°</li>
    <li>Typeï¼šç¼–è¯‘ç±»å‹</li>
    <li>Methodï¼šç¼–è¯‘æ–¹æ³•çš„ç±»åå’Œæ–¹æ³•åã€‚ç±»åä½¿ç”¨â€/â€ ä»£æ›¿ â€œ.â€ ä½œä¸ºç©ºé—´åˆ†éš”ç¬¦. æ–¹æ³•åæ˜¯ç»™å‡ºç±»çš„æ–¹æ³•å. æ ¼å¼æ˜¯ä¸€è‡´äºHotSpot - XX:+PrintComplation é€‰é¡¹</li>
  </ul>
</blockquote>

<h2 id="jmap">jmap</h2>
<p>jmap(JVM Memory Map)å‘½ä»¤ç”¨äºç”Ÿæˆheap dumpæ–‡ä»¶ï¼Œå¦‚æœä¸ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ï¼Œè¿˜é˜”ä»¥ä½¿ç”¨-XX:+HeapDumpOnOutOfMemoryErrorå‚æ•°æ¥è®©è™šæ‹Ÿæœºå‡ºç°OOMçš„æ—¶å€™Â·è‡ªåŠ¨ç”Ÿæˆdumpæ–‡ä»¶ã€‚
jmapä¸ä»…èƒ½ç”Ÿæˆdumpæ–‡ä»¶ï¼Œè¿˜é˜”ä»¥æŸ¥è¯¢finalizeæ‰§è¡Œé˜Ÿåˆ—ã€Javaå †å’Œæ°¸ä¹…ä»£çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚å½“å‰ä½¿ç”¨ç‡ã€å½“å‰ä½¿ç”¨çš„æ˜¯å“ªç§æ”¶é›†å™¨ç­‰ã€‚</p>

<h3 id="å‘½ä»¤æ ¼å¼-2">å‘½ä»¤æ ¼å¼</h3>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jmap [option] LVMID
</code></pre></div></div>

<h3 id="optionå‚æ•°-1">optionå‚æ•°</h3>
<blockquote>
  <ul>
    <li>dump : ç”Ÿæˆå †è½¬å‚¨å¿«ç…§</li>
    <li>finalizerinfo : æ˜¾ç¤ºåœ¨F-Queueé˜Ÿåˆ—ç­‰å¾…Finalizerçº¿ç¨‹æ‰§è¡Œfinalizeræ–¹æ³•çš„å¯¹è±¡</li>
    <li>heap : æ˜¾ç¤ºJavaå †è¯¦ç»†ä¿¡æ¯</li>
    <li>histo : æ˜¾ç¤ºå †ä¸­å¯¹è±¡çš„ç»Ÿè®¡ä¿¡æ¯</li>
    <li>permstat :  to print permanent generation statistics</li>
    <li>F : å½“-dumpæ²¡æœ‰å“åº”æ—¶ï¼Œå¼ºåˆ¶ç”Ÿæˆdumpå¿«ç…§</li>
  </ul>
</blockquote>

<h3 id="ç¤ºä¾‹-1">ç¤ºä¾‹</h3>

<h5 id="-dump">-dump</h5>
<p>å¸¸ç”¨æ ¼å¼</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-dump::live,format=b,file=<span class="nt">&lt;filename&gt;</span> pid 
</code></pre></div></div>
<p>dumpå †åˆ°æ–‡ä»¶,formatæŒ‡å®šè¾“å‡ºæ ¼å¼ï¼ŒliveæŒ‡æ˜æ˜¯æ´»ç€çš„å¯¹è±¡,fileæŒ‡å®šæ–‡ä»¶å</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ jmap -dump:live,format=b,file=dump.hprof 28920
  Dumping heap to /home/xxx/dump.hprof ...
  Heap dump file created
</code></pre></div></div>

<p>dump.hprofè¿™ä¸ªåç¼€æ˜¯ä¸ºäº†åç»­å¯ä»¥ç›´æ¥ç”¨MAT(Memory Anlysis Tool)æ‰“å¼€ã€‚</p>

<h5 id="-finalizerinfo">-finalizerinfo</h5>
<p>æ‰“å°ç­‰å¾…å›æ”¶å¯¹è±¡çš„ä¿¡æ¯</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ jmap -finalizerinfo 28920
  Attaching to process ID 28920, please wait...
  Debugger attached successfully.
  Server compiler detected.
  JVM version is 24.71-b01
  Number of objects pending for finalization: 0
</code></pre></div></div>
<p>å¯ä»¥çœ‹åˆ°å½“å‰F-QUEUEé˜Ÿåˆ—ä¸­å¹¶æ²¡æœ‰ç­‰å¾…Finalizerçº¿ç¨‹æ‰§è¡Œfinalizeræ–¹æ³•çš„å¯¹è±¡ã€‚</p>

<h5 id="-heap">-heap</h5>
<p>æ‰“å°heapçš„æ¦‚è¦ä¿¡æ¯ï¼ŒGCä½¿ç”¨çš„ç®—æ³•ï¼Œheapçš„é…ç½®åŠwise heapçš„ä½¿ç”¨æƒ…å†µ,å¯ä»¥ç”¨æ­¤æ¥åˆ¤æ–­å†…å­˜ç›®å‰çš„ä½¿ç”¨æƒ…å†µä»¥åŠåƒåœ¾å›æ”¶æƒ…å†µ</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="nx">jmap</span> <span class="o">-</span><span class="nx">heap</span> <span class="mi">28920</span>
  <span class="nx">Attaching</span> <span class="nx">to</span> <span class="nx">process</span> <span class="nx">ID</span> <span class="mi">28920</span><span class="p">,</span> <span class="nx">please</span> <span class="nx">wait</span><span class="p">...</span>
  <span class="nx">Debugger</span> <span class="nx">attached</span> <span class="nx">successfully</span><span class="p">.</span>
  <span class="nx">Server</span> <span class="nx">compiler</span> <span class="nx">detected</span><span class="p">.</span>
  <span class="nx">JVM</span> <span class="nx">version</span> <span class="nx">is</span> <span class="mf">24.71</span><span class="o">-</span><span class="nx">b01</span>  

  <span class="nx">using</span> <span class="nx">thread</span><span class="o">-</span><span class="nx">local</span> <span class="nx">object</span> <span class="nx">allocation</span><span class="p">.</span>
  <span class="nx">Parallel</span> <span class="nx">GC</span> <span class="kd">with</span> <span class="mi">4</span> <span class="nx">thread</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span><span class="c1">//GC æ–¹å¼  </span>

  <span class="nx">Heap</span> <span class="nx">Configuration</span><span class="p">:</span> <span class="c1">//å †å†…å­˜åˆå§‹åŒ–é…ç½®</span>
     <span class="nx">MinHeapFreeRatio</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">//å¯¹åº”jvmå¯åŠ¨å‚æ•°-XX:MinHeapFreeRatioè®¾ç½®JVMå †æœ€å°ç©ºé—²æ¯”ç‡(default 40)</span>
     <span class="nx">MaxHeapFreeRatio</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1">//å¯¹åº”jvmå¯åŠ¨å‚æ•° -XX:MaxHeapFreeRatioè®¾ç½®JVMå †æœ€å¤§ç©ºé—²æ¯”ç‡(default 70)</span>
     <span class="nx">MaxHeapSize</span>      <span class="o">=</span> <span class="mi">2082471936</span> <span class="p">(</span><span class="mf">1986.0</span><span class="nx">MB</span><span class="p">)</span> <span class="c1">//å¯¹åº”jvmå¯åŠ¨å‚æ•°-XX:MaxHeapSize=è®¾ç½®JVMå †çš„æœ€å¤§å¤§å°</span>
     <span class="nx">NewSize</span>          <span class="o">=</span> <span class="mi">1310720</span> <span class="p">(</span><span class="mf">1.25</span><span class="nx">MB</span><span class="p">)</span><span class="c1">//å¯¹åº”jvmå¯åŠ¨å‚æ•°-XX:NewSize=è®¾ç½®JVMå †çš„â€˜æ–°ç”Ÿä»£â€™çš„é»˜è®¤å¤§å°</span>
     <span class="nx">MaxNewSize</span>       <span class="o">=</span> <span class="mi">17592186044415</span> <span class="nx">MB</span><span class="c1">//å¯¹åº”jvmå¯åŠ¨å‚æ•°-XX:MaxNewSize=è®¾ç½®JVMå †çš„â€˜æ–°ç”Ÿä»£â€™çš„æœ€å¤§å¤§å°</span>
     <span class="nx">OldSize</span>          <span class="o">=</span> <span class="mi">5439488</span> <span class="p">(</span><span class="mf">5.1875</span><span class="nx">MB</span><span class="p">)</span><span class="c1">//å¯¹åº”jvmå¯åŠ¨å‚æ•°-XX:OldSize=&lt;value&gt;:è®¾ç½®JVMå †çš„â€˜è€ç”Ÿä»£â€™çš„å¤§å°</span>
     <span class="nx">NewRatio</span>         <span class="o">=</span> <span class="mi">2</span> <span class="c1">//å¯¹åº”jvmå¯åŠ¨å‚æ•°-XX:NewRatio=:â€˜æ–°ç”Ÿä»£â€™å’Œâ€˜è€ç”Ÿä»£â€™çš„å¤§å°æ¯”ç‡</span>
     <span class="nx">SurvivorRatio</span>    <span class="o">=</span> <span class="mi">8</span> <span class="c1">//å¯¹åº”jvmå¯åŠ¨å‚æ•°-XX:SurvivorRatio=è®¾ç½®å¹´è½»ä»£ä¸­EdenåŒºä¸SurvivoråŒºçš„å¤§å°æ¯”å€¼ </span>
     <span class="nx">PermSize</span>         <span class="o">=</span> <span class="mi">21757952</span> <span class="p">(</span><span class="mf">20.75</span><span class="nx">MB</span><span class="p">)</span>  <span class="c1">//å¯¹åº”jvmå¯åŠ¨å‚æ•°-XX:PermSize=&lt;value&gt;:è®¾ç½®JVMå †çš„â€˜æ°¸ç”Ÿä»£â€™çš„åˆå§‹å¤§å°</span>
     <span class="nx">MaxPermSize</span>      <span class="o">=</span> <span class="mi">85983232</span> <span class="p">(</span><span class="mf">82.0</span><span class="nx">MB</span><span class="p">)</span><span class="c1">//å¯¹åº”jvmå¯åŠ¨å‚æ•°-XX:MaxPermSize=&lt;value&gt;:è®¾ç½®JVMå †çš„â€˜æ°¸ç”Ÿä»£â€™çš„æœ€å¤§å¤§å°</span>
     <span class="nx">G1HeapRegionSize</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">(</span><span class="mf">0.0</span><span class="nx">MB</span><span class="p">)</span>  

  <span class="nx">Heap</span> <span class="nx">Usage</span><span class="p">:</span><span class="c1">//å †å†…å­˜ä½¿ç”¨æƒ…å†µ</span>
  <span class="nx">PS</span> <span class="nx">Young</span> <span class="nx">Generation</span>
  <span class="nx">Eden</span> <span class="nx">Space</span><span class="p">:</span><span class="c1">//EdenåŒºå†…å­˜åˆ†å¸ƒ</span>
     <span class="nx">capacity</span> <span class="o">=</span> <span class="mi">33030144</span> <span class="p">(</span><span class="mf">31.5</span><span class="nx">MB</span><span class="p">)</span><span class="c1">//EdenåŒºæ€»å®¹é‡</span>
     <span class="nx">used</span>     <span class="o">=</span> <span class="mi">1524040</span> <span class="p">(</span><span class="mf">1.4534378051757812</span><span class="nx">MB</span><span class="p">)</span>  <span class="c1">//EdenåŒºå·²ä½¿ç”¨</span>
     <span class="nx">free</span>     <span class="o">=</span> <span class="mi">31506104</span> <span class="p">(</span><span class="mf">30.04656219482422</span><span class="nx">MB</span><span class="p">)</span>  <span class="c1">//EdenåŒºå‰©ä½™å®¹é‡</span>
     <span class="mf">4.614088270399305</span><span class="o">%</span> <span class="nx">used</span> <span class="c1">//EdenåŒºä½¿ç”¨æ¯”ç‡</span>
  <span class="nx">From</span> <span class="nx">Space</span><span class="p">:</span>  <span class="c1">//å…¶ä¸­ä¸€ä¸ªSurvivoråŒºçš„å†…å­˜åˆ†å¸ƒ</span>
     <span class="nx">capacity</span> <span class="o">=</span> <span class="mi">5242880</span> <span class="p">(</span><span class="mf">5.0</span><span class="nx">MB</span><span class="p">)</span>
     <span class="nx">used</span>     <span class="o">=</span> <span class="mi">0</span> <span class="p">(</span><span class="mf">0.0</span><span class="nx">MB</span><span class="p">)</span>
     <span class="nx">free</span>     <span class="o">=</span> <span class="mi">5242880</span> <span class="p">(</span><span class="mf">5.0</span><span class="nx">MB</span><span class="p">)</span>
     <span class="mf">0.0</span><span class="o">%</span> <span class="nx">used</span>
  <span class="nx">To</span> <span class="nx">Space</span><span class="p">:</span>  <span class="c1">//å¦ä¸€ä¸ªSurvivoråŒºçš„å†…å­˜åˆ†å¸ƒ</span>
     <span class="nx">capacity</span> <span class="o">=</span> <span class="mi">5242880</span> <span class="p">(</span><span class="mf">5.0</span><span class="nx">MB</span><span class="p">)</span>
     <span class="nx">used</span>     <span class="o">=</span> <span class="mi">0</span> <span class="p">(</span><span class="mf">0.0</span><span class="nx">MB</span><span class="p">)</span>
     <span class="nx">free</span>     <span class="o">=</span> <span class="mi">5242880</span> <span class="p">(</span><span class="mf">5.0</span><span class="nx">MB</span><span class="p">)</span>
     <span class="mf">0.0</span><span class="o">%</span> <span class="nx">used</span>
  <span class="nx">PS</span> <span class="nx">Old</span> <span class="nx">Generation</span> <span class="c1">//å½“å‰çš„OldåŒºå†…å­˜åˆ†å¸ƒ</span>
     <span class="nx">capacity</span> <span class="o">=</span> <span class="mi">86507520</span> <span class="p">(</span><span class="mf">82.5</span><span class="nx">MB</span><span class="p">)</span>
     <span class="nx">used</span>     <span class="o">=</span> <span class="mi">0</span> <span class="p">(</span><span class="mf">0.0</span><span class="nx">MB</span><span class="p">)</span>
     <span class="nx">free</span>     <span class="o">=</span> <span class="mi">86507520</span> <span class="p">(</span><span class="mf">82.5</span><span class="nx">MB</span><span class="p">)</span>
     <span class="mf">0.0</span><span class="o">%</span> <span class="nx">used</span>
  <span class="nx">PS</span> <span class="nx">Perm</span> <span class="nx">Generation</span><span class="c1">//å½“å‰çš„ â€œæ°¸ç”Ÿä»£â€ å†…å­˜åˆ†å¸ƒ</span>
     <span class="nx">capacity</span> <span class="o">=</span> <span class="mi">22020096</span> <span class="p">(</span><span class="mf">21.0</span><span class="nx">MB</span><span class="p">)</span>
     <span class="nx">used</span>     <span class="o">=</span> <span class="mi">2496528</span> <span class="p">(</span><span class="mf">2.3808746337890625</span><span class="nx">MB</span><span class="p">)</span>
     <span class="nx">free</span>     <span class="o">=</span> <span class="mi">19523568</span> <span class="p">(</span><span class="mf">18.619125366210938</span><span class="nx">MB</span><span class="p">)</span>
     <span class="mf">11.337498256138392</span><span class="o">%</span> <span class="nx">used</span>  

  <span class="mi">670</span> <span class="nx">interned</span> <span class="nx">Strings</span> <span class="nx">occupying</span> <span class="mi">43720</span> <span class="nx">bytes</span><span class="p">.</span>
</code></pre></div></div>

<p>å¯ä»¥å¾ˆæ¸…æ¥šçš„çœ‹åˆ°Javaå †ä¸­å„ä¸ªåŒºåŸŸç›®å‰çš„æƒ…å†µã€‚</p>

<h5 id="-histo">-histo</h5>
<p>æ‰“å°å †çš„å¯¹è±¡ç»Ÿè®¡ï¼ŒåŒ…æ‹¬å¯¹è±¡æ•°ã€å†…å­˜å¤§å°ç­‰ç­‰ ï¼ˆå› ä¸ºåœ¨dump:liveå‰ä¼šè¿›è¡Œfull gcï¼Œå¦‚æœå¸¦ä¸Šliveåˆ™åªç»Ÿè®¡æ´»å¯¹è±¡ï¼Œå› æ­¤ä¸åŠ liveçš„å †å¤§å°è¦å¤§äºåŠ liveå †çš„å¤§å° ï¼‰</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ jmap -histo:live 28920 | more
 num     #instances         #bytes  class name
----------------------------------------------
   1:         83613       12012248  <span class="nt">&lt;constMethodKlass&gt;</span>
   2:         23868       11450280  [B
   3:         83613       10716064  <span class="nt">&lt;methodKlass&gt;</span>
   4:         76287       10412128  [C
   5:          8227        9021176  <span class="nt">&lt;constantPoolKlass&gt;</span>
   6:          8227        5830256  <span class="nt">&lt;instanceKlassKlass&gt;</span>
   7:          7031        5156480  <span class="nt">&lt;constantPoolCacheKlass&gt;</span>
   8:         73627        1767048  java.lang.String
   9:          2260        1348848  <span class="nt">&lt;methodDataKlass&gt;</span>
  10:          8856         849296  java.lang.Class
  ....
</code></pre></div></div>

<p>ä»…ä»…æ‰“å°äº†å‰10è¡Œ</p>

<p><code class="highlighter-rouge">xml class name</code>æ˜¯å¯¹è±¡ç±»å‹ï¼Œè¯´æ˜å¦‚ä¸‹ï¼š</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>B  byte
C  char
D  double
F  float
I  int
J  long
Z  boolean
[  æ•°ç»„ï¼Œå¦‚[Iè¡¨ç¤ºint[]
[L+ç±»å å…¶ä»–å¯¹è±¡
</code></pre></div></div>

<h5 id="-permstat">-permstat</h5>
<p>æ‰“å°Javaå †å†…å­˜çš„æ°¸ä¹…ä¿å­˜åŒºåŸŸçš„ç±»åŠ è½½å™¨çš„æ™ºèƒ½ç»Ÿè®¡ä¿¡æ¯ã€‚å¯¹äºæ¯ä¸ªç±»åŠ è½½å™¨è€Œè¨€ï¼Œå®ƒçš„åç§°ã€æ´»è·ƒåº¦ã€åœ°å€ã€çˆ¶ç±»åŠ è½½å™¨ã€å®ƒæ‰€åŠ è½½çš„ç±»çš„æ•°é‡å’Œå¤§å°éƒ½ä¼šè¢«æ‰“å°ã€‚æ­¤å¤–ï¼ŒåŒ…å«çš„å­—ç¬¦ä¸²æ•°é‡å’Œå¤§å°ä¹Ÿä¼šè¢«æ‰“å°ã€‚</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ jmap -permstat 28920
  Attaching to process ID 28920, please wait...
  Debugger attached successfully.
  Server compiler detected.
  JVM version is 24.71-b01
  finding class loader instances ..done.
  computing per loader stat ..done.
  please wait.. computing liveness.liveness analysis may be inaccurate ...
  
  class_loader            classes bytes   parent_loader           alive?  type  
  <span class="nt">&lt;bootstrap&gt;</span>             3111    18154296          null          live    <span class="nt">&lt;internal&gt;</span>
  0x0000000600905cf8      1       1888    0x0000000600087f08      dead    sun/reflect/DelegatingClassLoader@0x00000007800500a0
  0x00000006008fcb48      1       1888    0x0000000600087f08      dead    sun/reflect/DelegatingClassLoader@0x00000007800500a0
  0x00000006016db798      0       0       0x00000006008d3fc0      dead    java/util/ResourceBundle$RBClassLoader@0x0000000780626ec0
  0x00000006008d6810      1       3056      null          dead    sun/reflect/DelegatingClassLoader@0x00000007800500a0
</code></pre></div></div>

<h5 id="-f">-F</h5>
<p>å¼ºåˆ¶æ¨¡å¼ã€‚å¦‚æœæŒ‡å®šçš„pidæ²¡æœ‰å“åº”ï¼Œè¯·ä½¿ç”¨jmap -dumpæˆ–jmap -histoé€‰é¡¹ã€‚æ­¤æ¨¡å¼ä¸‹ï¼Œä¸æ”¯æŒliveå­é€‰é¡¹ã€‚</p>

<h2 id="jhat">jhat</h2>
<p>jhat(JVM Heap Analysis Tool)å‘½ä»¤æ˜¯ä¸jmapæ­é…ä½¿ç”¨ï¼Œç”¨æ¥åˆ†æjmapç”Ÿæˆçš„dumpï¼Œjhatå†…ç½®äº†ä¸€ä¸ªå¾®å‹çš„HTTP/HTMLæœåŠ¡å™¨ï¼Œç”Ÿæˆdumpçš„åˆ†æç»“æœåï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ã€‚åœ¨æ­¤è¦æ³¨æ„ï¼Œä¸€èˆ¬ä¸ä¼šç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šè¿›è¡Œåˆ†æï¼Œå› ä¸ºjhatæ˜¯ä¸€ä¸ªè€—æ—¶å¹¶ä¸”è€—è´¹ç¡¬ä»¶èµ„æºçš„è¿‡ç¨‹ï¼Œä¸€èˆ¬æŠŠæœåŠ¡å™¨ç”Ÿæˆçš„dumpæ–‡ä»¶å¤åˆ¶åˆ°æœ¬åœ°æˆ–å…¶ä»–æœºå™¨ä¸Šè¿›è¡Œåˆ†æã€‚</p>

<h3 id="å‘½ä»¤æ ¼å¼-3">å‘½ä»¤æ ¼å¼</h3>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jhat [dumpfile]
</code></pre></div></div>

<h3 id="å‚æ•°-1">å‚æ•°</h3>

<blockquote>
  <ul>
    <li>-stack false|true
å…³é—­å¯¹è±¡åˆ†é…è°ƒç”¨æ ˆè·Ÿè¸ª(tracking object allocation call stack)ã€‚ å¦‚æœåˆ†é…ä½ç½®ä¿¡æ¯åœ¨å †è½¬å‚¨ä¸­ä¸å¯ç”¨. åˆ™å¿…é¡»å°†æ­¤æ ‡å¿—è®¾ç½®ä¸º false. é»˜è®¤å€¼ä¸º true.&gt;</li>
    <li>-refs false|true
å…³é—­å¯¹è±¡å¼•ç”¨è·Ÿè¸ª(tracking of references to objects)ã€‚ é»˜è®¤å€¼ä¸º true. é»˜è®¤æƒ…å†µä¸‹, è¿”å›çš„æŒ‡é’ˆæ˜¯æŒ‡å‘å…¶ä»–ç‰¹å®šå¯¹è±¡çš„å¯¹è±¡,å¦‚åå‘é“¾æ¥æˆ–è¾“å…¥å¼•ç”¨(referrers or incoming references), ä¼šç»Ÿè®¡/è®¡ç®—å †ä¸­çš„æ‰€æœ‰å¯¹è±¡ã€‚&gt;</li>
    <li>-port port-number
è®¾ç½® jhat HTTP server çš„ç«¯å£å·. é»˜è®¤å€¼ 7000.&gt;</li>
    <li>-exclude exclude-file
æŒ‡å®šå¯¹è±¡æŸ¥è¯¢æ—¶éœ€è¦æ’é™¤çš„æ•°æ®æˆå‘˜åˆ—è¡¨æ–‡ä»¶(a file that lists data members that should be excluded from the reachable objects query)ã€‚ ä¾‹å¦‚, å¦‚æœæ–‡ä»¶åˆ—åˆ—å‡ºäº† java.lang.String.value , é‚£ä¹ˆå½“ä»æŸä¸ªç‰¹å®šå¯¹è±¡ Object o è®¡ç®—å¯è¾¾çš„å¯¹è±¡åˆ—è¡¨æ—¶, å¼•ç”¨è·¯å¾„æ¶‰åŠ java.lang.String.value çš„éƒ½ä¼šè¢«æ’é™¤ã€‚&gt;</li>
    <li>-baseline exclude-file
æŒ‡å®šä¸€ä¸ªåŸºå‡†å †è½¬å‚¨(baseline heap dump)ã€‚ åœ¨ä¸¤ä¸ª heap dumps ä¸­æœ‰ç›¸åŒ object ID çš„å¯¹è±¡ä¼šè¢«æ ‡è®°ä¸ºä¸æ˜¯æ–°çš„(marked as not being new). å…¶ä»–å¯¹è±¡è¢«æ ‡è®°ä¸ºæ–°çš„(new). åœ¨æ¯”è¾ƒä¸¤ä¸ªä¸åŒçš„å †è½¬å‚¨æ—¶å¾ˆæœ‰ç”¨.&gt;</li>
    <li>-debug int
è®¾ç½® debug çº§åˆ«. 0 è¡¨ç¤ºä¸è¾“å‡ºè°ƒè¯•ä¿¡æ¯ã€‚ å€¼è¶Šå¤§åˆ™è¡¨ç¤ºè¾“å‡ºæ›´è¯¦ç»†çš„ debug ä¿¡æ¯.&gt;</li>
    <li>-version
å¯åŠ¨ååªæ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯å°±é€€å‡º&gt;</li>
    <li>-J&lt; flag &gt;
å› ä¸º jhat å‘½ä»¤å®é™…ä¸Šä¼šå¯åŠ¨ä¸€ä¸ªJVMæ¥æ‰§è¡Œ, é€šè¿‡ -J å¯ä»¥åœ¨å¯åŠ¨JVMæ—¶ä¼ å…¥ä¸€äº›å¯åŠ¨å‚æ•°. ä¾‹å¦‚, -J-Xmx512m åˆ™æŒ‡å®šè¿è¡Œ jhat çš„Javaè™šæ‹Ÿæœºä½¿ç”¨çš„æœ€å¤§å †å†…å­˜ä¸º 512 MB. å¦‚æœéœ€è¦ä½¿ç”¨å¤šä¸ªJVMå¯åŠ¨å‚æ•°,åˆ™ä¼ å…¥å¤šä¸ª -Jxxxxxx.</li>
  </ul>
</blockquote>

<h3 id="ç¤ºä¾‹-2">ç¤ºä¾‹</h3>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ jhat -J-Xmx512m dump.hprof
  eading from dump.hprof...
  Dump file created Fri Mar 11 17:13:42 CST 2016
  Snapshot read, resolving...
  Resolving 271678 objects...
  Chasing references, expect 54 dots......................................................
  Eliminating duplicate references......................................................
  Snapshot resolved.
  Started HTTP server on port 7000
  Server is ready.
</code></pre></div></div>

<p>ä¸­é—´çš„-J-Xmx512mæ˜¯åœ¨dumpå¿«ç…§å¾ˆå¤§çš„æƒ…å†µä¸‹åˆ†é…512Må†…å­˜å»å¯åŠ¨HTTPæœåŠ¡å™¨ï¼Œè¿è¡Œå®Œä¹‹åå°±å¯åœ¨æµè§ˆå™¨æ‰“å¼€Http://localhost:7000è¿›è¡Œå¿«ç…§åˆ†æ
å †å¿«ç…§åˆ†æä¸»è¦åœ¨æœ€åé¢çš„Heap Histogramé‡Œï¼Œé‡Œé¢æ ¹æ®classåˆ—å‡ºäº†dumpçš„æ—¶å€™æ‰€æœ‰å­˜æ´»å¯¹è±¡ã€‚</p>

<p><strong>åˆ†æåŒæ ·ä¸€ä¸ªdumpå¿«ç…§ï¼ŒMATéœ€è¦çš„é¢å¤–å†…å­˜æ¯”jhatè¦å°çš„å¤šçš„å¤šï¼Œæ‰€ä»¥å»ºè®®ä½¿ç”¨MATæ¥è¿›è¡Œåˆ†æï¼Œå½“ç„¶ä¹Ÿçœ‹ä¸ªäººåå¥½ã€‚</strong></p>

<h3 id="åˆ†æ">åˆ†æ</h3>
<p>æ‰“å¼€æµè§ˆå™¨Http://localhost:7000ï¼Œè¯¥é¡µé¢æä¾›äº†å‡ ä¸ªæŸ¥è¯¢åŠŸèƒ½å¯ä¾›ä½¿ç”¨ï¼š</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>All classes including platform
Show all members of the rootset
Show instance counts for all classes (including platform)
Show instance counts for all classes (excluding platform)
Show heap histogram
Show finalizer summary
Execute Object Query Language (OQL) query
</code></pre></div></div>

<p>ä¸€èˆ¬æŸ¥çœ‹å †å¼‚å¸¸æƒ…å†µä¸»è¦çœ‹è¿™ä¸ªä¸¤ä¸ªéƒ¨åˆ†ï¼š
Show instance counts for all classes (excluding platform)ï¼Œå¹³å°å¤–çš„æ‰€æœ‰å¯¹è±¡ä¿¡æ¯ã€‚å¦‚ä¸‹å›¾ï¼š
<img src="http://ityouknow.com/assets/images/2016/jvm-jhat-excluding-paltform.png" alt="" /> <br />
Show heap histogram ä»¥æ ‘çŠ¶å›¾å½¢å¼å±•ç¤ºå †æƒ…å†µã€‚å¦‚ä¸‹å›¾ï¼š
<img src="http://ityouknow.com/assets/images/2016/jvm-jhat-heap-histogram.png" alt="" /> <br />
å…·ä½“æ’æŸ¥æ—¶éœ€è¦ç»“åˆä»£ç ï¼Œè§‚å¯Ÿæ˜¯å¦å¤§é‡åº”è¯¥è¢«å›æ”¶çš„å¯¹è±¡åœ¨ä¸€ç›´è¢«å¼•ç”¨æˆ–è€…æ˜¯å¦æœ‰å ç”¨å†…å­˜ç‰¹åˆ«å¤§çš„å¯¹è±¡æ— æ³•è¢«å›æ”¶ã€‚<br />
<strong>ä¸€èˆ¬æƒ…å†µï¼Œä¼šdownåˆ°å®¢æˆ·ç«¯ç”¨å·¥å…·æ¥åˆ†æ</strong></p>

<h2 id="jstack">jstack</h2>
<p>jstackç”¨äºç”Ÿæˆjavaè™šæ‹Ÿæœºå½“å‰æ—¶åˆ»çš„çº¿ç¨‹å¿«ç…§ã€‚çº¿ç¨‹å¿«ç…§æ˜¯å½“å‰javaè™šæ‹Ÿæœºå†…æ¯ä¸€æ¡çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•å †æ ˆçš„é›†åˆï¼Œç”Ÿæˆçº¿ç¨‹å¿«ç…§çš„ä¸»è¦ç›®çš„æ˜¯å®šä½çº¿ç¨‹å‡ºç°é•¿æ—¶é—´åœé¡¿çš„åŸå› ï¼Œå¦‚çº¿ç¨‹é—´æ­»é”ã€æ­»å¾ªç¯ã€è¯·æ±‚å¤–éƒ¨èµ„æºå¯¼è‡´çš„é•¿æ—¶é—´ç­‰å¾…ç­‰ã€‚ çº¿ç¨‹å‡ºç°åœé¡¿çš„æ—¶å€™é€šè¿‡jstackæ¥æŸ¥çœ‹å„ä¸ªçº¿ç¨‹çš„è°ƒç”¨å †æ ˆï¼Œå°±å¯ä»¥çŸ¥é“æ²¡æœ‰å“åº”çš„çº¿ç¨‹åˆ°åº•åœ¨åå°åšä»€ä¹ˆäº‹æƒ…ï¼Œæˆ–è€…ç­‰å¾…ä»€ä¹ˆèµ„æºã€‚ å¦‚æœjavaç¨‹åºå´©æºƒç”Ÿæˆcoreæ–‡ä»¶ï¼Œjstackå·¥å…·å¯ä»¥ç”¨æ¥è·å¾—coreæ–‡ä»¶çš„java stackå’Œnative stackçš„ä¿¡æ¯ï¼Œä»è€Œå¯ä»¥è½»æ¾åœ°çŸ¥é“javaç¨‹åºæ˜¯å¦‚ä½•å´©æºƒå’Œåœ¨ç¨‹åºä½•å¤„å‘ç”Ÿé—®é¢˜ã€‚å¦å¤–ï¼Œjstackå·¥å…·è¿˜å¯ä»¥é™„å±åˆ°æ­£åœ¨è¿è¡Œçš„javaç¨‹åºä¸­ï¼Œçœ‹åˆ°å½“æ—¶è¿è¡Œçš„javaç¨‹åºçš„java stackå’Œnative stackçš„ä¿¡æ¯, å¦‚æœç°åœ¨è¿è¡Œçš„javaç¨‹åºå‘ˆç°hungçš„çŠ¶æ€ï¼Œjstackæ˜¯éå¸¸æœ‰ç”¨çš„ã€‚</p>

<h3 id="å‘½ä»¤æ ¼å¼-4">å‘½ä»¤æ ¼å¼</h3>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jstack [option] LVMID
</code></pre></div></div>

<h3 id="optionå‚æ•°-2">optionå‚æ•°</h3>

<blockquote>
  <ul>
    <li>-F : å½“æ­£å¸¸è¾“å‡ºè¯·æ±‚ä¸è¢«å“åº”æ—¶ï¼Œå¼ºåˆ¶è¾“å‡ºçº¿ç¨‹å †æ ˆ</li>
    <li>-l : é™¤å †æ ˆå¤–ï¼Œæ˜¾ç¤ºå…³äºé”çš„é™„åŠ ä¿¡æ¯</li>
    <li>-m : å¦‚æœè°ƒç”¨åˆ°æœ¬åœ°æ–¹æ³•çš„è¯ï¼Œå¯ä»¥æ˜¾ç¤ºC/C++çš„å †æ ˆ</li>
  </ul>
</blockquote>

<h3 id="ç¤ºä¾‹-3">ç¤ºä¾‹</h3>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ jstack -l 11494|more
2016-07-28 13:40:04
Full thread dump Java HotSpot(TM) 64-Bit Server VM (24.71-b01 mixed mode):

"Attach Listener" daemon prio=10 tid=0x00007febb0002000 nid=0x6b6f waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

   Locked ownable synchronizers:
        - None

"http-bio-8005-exec-2" daemon prio=10 tid=0x00007feb94028000 nid=0x7b8c waiting on condition [0x00007fea8f56e000]
   java.lang.Thread.State: WAITING (parking)
        at sun.misc.Unsafe.park(Native Method)
        - parking to wait for  <span class="err">&lt;</span>0x00000000cae09b80&gt; (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)
        at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)
        at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2043)
        at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:442)
        at org.apache.tomcat.util.threads.TaskQueue.take(TaskQueue.java:104)
        at org.apache.tomcat.util.threads.TaskQueue.take(TaskQueue.java:32)
        at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1068)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1130)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
        at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
        at java.lang.Thread.run(Thread.java:745)

   Locked ownable synchronizers:
        - None
      .....
</code></pre></div></div>

<h3 id="åˆ†æ-1">åˆ†æ</h3>

<p>è¿™é‡Œæœ‰ä¸€ç¯‡æ–‡ç« è§£é‡Šçš„å¾ˆå¥½
<a href="http://www.hollischuang.com/archives/110">åˆ†ææ‰“å°å‡ºçš„æ–‡ä»¶å†…å®¹</a></p>

<h2 id="jinfo">jinfo</h2>
<p>jinfo(JVM Configuration info)è¿™ä¸ªå‘½ä»¤ä½œç”¨æ˜¯å®æ—¶æŸ¥çœ‹å’Œè°ƒæ•´è™šæ‹Ÿæœºè¿è¡Œå‚æ•°ã€‚
ä¹‹å‰çš„jps -vå£ä»¤åªèƒ½æŸ¥çœ‹åˆ°æ˜¾ç¤ºæŒ‡å®šçš„å‚æ•°ï¼Œå¦‚æœæƒ³è¦æŸ¥çœ‹æœªè¢«æ˜¾ç¤ºæŒ‡å®šçš„å‚æ•°çš„å€¼å°±è¦ä½¿ç”¨jinfoå£ä»¤</p>

<h3 id="å‘½ä»¤æ ¼å¼-5">å‘½ä»¤æ ¼å¼</h3>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jinfo [option] [args] LVMID
</code></pre></div></div>

<h3 id="optionå‚æ•°-3">optionå‚æ•°</h3>

<blockquote>
  <ul>
    <li>-flag : è¾“å‡ºæŒ‡å®šargså‚æ•°çš„å€¼</li>
    <li>-flags : ä¸éœ€è¦argså‚æ•°ï¼Œè¾“å‡ºæ‰€æœ‰JVMå‚æ•°çš„å€¼</li>
    <li>-sysprops : è¾“å‡ºç³»ç»Ÿå±æ€§ï¼Œç­‰åŒäºSystem.getProperties()</li>
  </ul>
</blockquote>

<h3 id="ç¤ºä¾‹-4">ç¤ºä¾‹</h3>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ jinfo -flags 11494
-XX:CMSInitiatingOccupancyFraction=80
</code></pre></div></div>
:ET