I"„<p>MongoDB æ˜¯æœ€æ—©çƒ­é—¨éå…³ç³»æ•°æ®åº“çš„ä¹‹ä¸€ï¼Œä½¿ç”¨ä¹Ÿæ¯”è¾ƒæ™®éï¼Œä¸€èˆ¬ä¼šç”¨åšç¦»çº¿æ•°æ®åˆ†ææ¥ä½¿ç”¨ï¼Œæ”¾åˆ°å†…ç½‘çš„å±…å¤šã€‚ç”±äºå¾ˆå¤šå…¬å¸ä½¿ç”¨äº†äº‘æœåŠ¡ï¼ŒæœåŠ¡å™¨é»˜è®¤éƒ½å¼€æ”¾äº†å¤–ç½‘åœ°å€ï¼Œå¯¼è‡´å‰ä¸€é˜µå­å¤§æ‰¹ MongoDB å› é…ç½®æ¼æ´è¢«æ”»å‡»ï¼Œæ•°æ®è¢«åˆ ï¼Œå¼•èµ·äº†äººä»¬çš„æ³¨æ„ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="http://www.freebuf.com/articles/database/125127.html">åœºå± æˆ®MongoDBçš„ç››å®´åæ€ï¼šè¶…33000ä¸ªæ•°æ®åº“é­é‡å…¥ä¾µå‹’ç´¢</a>ï¼ŒåŒæ—¶ä¹Ÿè¯´æ˜äº†å¾ˆå¤šå…¬å¸ç”Ÿäº§ä¸­å¤§é‡ä½¿ç”¨mongodbã€‚</p>

<h2 id="mongodb-ç®€ä»‹">MongoDB ç®€ä»‹</h2>

<p>MongoDBï¼ˆæ¥è‡ªäºè‹±æ–‡å•è¯â€œHumongousâ€ï¼Œä¸­æ–‡å«ä¹‰ä¸ºâ€œåºå¤§â€ï¼‰æ˜¯å¯ä»¥åº”ç”¨äºå„ç§è§„æ¨¡çš„ä¼ä¸šã€å„ä¸ªè¡Œä¸šä»¥åŠå„ç±»åº”ç”¨ç¨‹åºçš„å¼€æºæ•°æ®åº“ã€‚åŸºäºåˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨çš„æ•°æ®åº“ã€‚ç”±C++è¯­è¨€ç¼–å†™ã€‚æ—¨åœ¨ä¸º WEB åº”ç”¨æä¾›å¯æ‰©å±•çš„é«˜æ€§èƒ½æ•°æ®å­˜å‚¨è§£å†³æ–¹æ¡ˆã€‚MongoDB æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ï¼Œå¼€æºï¼Œæ— æ¨¡å¼çš„æ–‡æ¡£å‹æ•°æ®åº“ï¼Œæ˜¯å½“å‰ NoSql æ•°æ®åº“ä¸­æ¯”è¾ƒçƒ­é—¨çš„ä¸€ç§ã€‚</p>

<p>MongoDB æ˜¯ä¸€ä¸ªä»‹äºå…³ç³»æ•°æ®åº“å’Œéå…³ç³»æ•°æ®åº“ä¹‹é—´çš„äº§å“ï¼Œæ˜¯éå…³ç³»æ•°æ®åº“å½“ä¸­åŠŸèƒ½æœ€ä¸°å¯Œï¼Œæœ€åƒå…³ç³»æ•°æ®åº“çš„ã€‚ä»–æ”¯æŒçš„æ•°æ®ç»“æ„éå¸¸æ¾æ•£ï¼Œæ˜¯ç±»ä¼¼ json çš„ bjson æ ¼å¼ï¼Œå› æ­¤å¯ä»¥å­˜å‚¨æ¯”è¾ƒå¤æ‚çš„æ•°æ®ç±»å‹ã€‚MongoDB æœ€å¤§çš„ç‰¹ç‚¹æ˜¯ä»–æ”¯æŒçš„æŸ¥è¯¢è¯­è¨€éå¸¸å¼ºå¤§ï¼Œå…¶è¯­æ³•æœ‰ç‚¹ç±»ä¼¼äºé¢å‘å¯¹è±¡çš„æŸ¥è¯¢è¯­è¨€ï¼Œå‡ ä¹å¯ä»¥å®ç°ç±»ä¼¼å…³ç³»æ•°æ®åº“å•è¡¨æŸ¥è¯¢çš„ç»å¤§éƒ¨åˆ†åŠŸèƒ½ï¼Œè€Œä¸”è¿˜æ”¯æŒå¯¹æ•°æ®å»ºç«‹ç´¢å¼•ã€‚</p>

<p>ä¼ ç»Ÿçš„å…³ç³»æ•°æ®åº“ä¸€èˆ¬ç”±æ•°æ®åº“ï¼ˆdatabaseï¼‰ã€è¡¨ï¼ˆtableï¼‰ã€è®°å½•ï¼ˆrecordï¼‰ä¸‰ä¸ªå±‚æ¬¡æ¦‚å¿µç»„æˆï¼ŒMongoDB æ˜¯ç”±æ•°æ®åº“ï¼ˆdatabaseï¼‰ã€é›†åˆï¼ˆcollectionï¼‰ã€æ–‡æ¡£å¯¹è±¡ï¼ˆdocumentï¼‰ä¸‰ä¸ªå±‚æ¬¡ç»„æˆã€‚MongoDB å¯¹äºå…³ç³»å‹æ•°æ®åº“é‡Œçš„è¡¨ï¼Œä½†æ˜¯é›†åˆä¸­æ²¡æœ‰åˆ—ã€è¡Œå’Œå…³ç³»æ¦‚å¿µï¼Œè¿™ä½“ç°äº†æ¨¡å¼è‡ªç”±çš„ç‰¹ç‚¹ã€‚</p>

<p>MongoDB ä¸­çš„ä¸€æ¡è®°å½•å°±æ˜¯ä¸€ä¸ªæ–‡æ¡£ï¼Œæ˜¯ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œç”±å­—æ®µå’Œå€¼å¯¹ç»„æˆã€‚MongoDB æ–‡æ¡£ä¸ JSON å¯¹è±¡ç±»ä¼¼ã€‚å­—æ®µçš„å€¼æœ‰å¯èƒ½åŒ…æ‹¬å…¶å®ƒæ–‡æ¡£ã€æ•°ç»„ä»¥åŠæ–‡æ¡£æ•°ç»„ã€‚MongoDB æ”¯æŒ OS Xã€Linux åŠ Windows ç­‰æ“ä½œç³»ç»Ÿï¼Œå¹¶æä¾›äº† Pythonï¼ŒPHPï¼ŒRubyï¼ŒJavaåŠ C++ è¯­è¨€çš„é©±åŠ¨ç¨‹åºï¼Œç¤¾åŒºä¸­ä¹Ÿæä¾›äº†å¯¹ Erlang åŠ .NET ç­‰å¹³å°çš„é©±åŠ¨ç¨‹åºã€‚</p>

<p>MongoDB çš„é€‚åˆå¯¹å¤§é‡æˆ–è€…æ— å›ºå®šæ ¼å¼çš„æ•°æ®è¿›è¡Œå­˜å‚¨ï¼Œæ¯”å¦‚ï¼šæ—¥å¿—ã€ç¼“å­˜ç­‰ã€‚å¯¹äº‹ç‰©æ”¯æŒè¾ƒå¼±ï¼Œä¸é€‚ç”¨å¤æ‚çš„å¤šæ–‡æ¡£ï¼ˆå¤šè¡¨ï¼‰çš„çº§è”æŸ¥è¯¢ã€‚æ–‡ä¸­æ¼”ç¤º Mongodb ç‰ˆæœ¬ä¸º 3.5ã€‚</p>

<h2 id="mongodb-çš„å¢åˆ æ”¹æŸ¥">MongoDB çš„å¢åˆ æ”¹æŸ¥</h2>

<p>Spring Boot å¯¹å„ç§æµè¡Œçš„æ•°æ®æºéƒ½è¿›è¡Œäº†å°è£…ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬äº† Mongodb,ä¸‹é¢ç»™å¤§å®¶ä»‹ç»å¦‚ä½•åœ¨ Spring Boot ä¸­ä½¿ç”¨ Mongodbï¼š</p>

<h3 id="1pom-åŒ…é…ç½®">1ã€pom åŒ…é…ç½®</h3>

<p>pom åŒ…é‡Œé¢æ·»åŠ  <code class="highlighter-rouge">spring-boot-starter-data-mongodb</code> åŒ…å¼•ç”¨</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependencies&gt;</span>
	<span class="nt">&lt;dependency&gt;</span> 
	    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
	    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-data-mongodb<span class="nt">&lt;/artifactId&gt;</span>
	<span class="nt">&lt;/dependency&gt;</span> 
<span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div></div>

<h3 id="2åœ¨-applicationproperties-ä¸­æ·»åŠ é…ç½®">2ã€åœ¨ application.properties ä¸­æ·»åŠ é…ç½®</h3>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">spring.data.mongodb.uri</span><span class="p">=</span><span class="s">mongodb://name:pass@localhost:27017/test</span>
</code></pre></div></div>

<p>å¤šä¸ª IP é›†ç¾¤å¯ä»¥é‡‡ç”¨ä»¥ä¸‹é…ç½®ï¼š</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">spring.data.mongodb.uri</span><span class="p">=</span><span class="s">mongodb://user:pwd@ip1:port1,ip2:port2/database</span>
</code></pre></div></div>

<h3 id="2åˆ›å»ºæ•°æ®å®ä½“">2ã€åˆ›å»ºæ•°æ®å®ä½“</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3258839839160856613L</span><span class="o">;</span>
        <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
        <span class="kd">private</span> <span class="nc">String</span> <span class="n">userName</span><span class="o">;</span>
        <span class="kd">private</span> <span class="nc">String</span> <span class="n">passWord</span><span class="o">;</span>

      <span class="c1">//getterã€setterçœç•¥</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="3åˆ›å»ºå®ä½“çš„å¢åˆ æ”¹æŸ¥æ“ä½œ">3ã€åˆ›å»ºå®ä½“çš„å¢åˆ æ”¹æŸ¥æ“ä½œ</h3>

<p>Repository å±‚å®ç°äº† User å¯¹è±¡çš„å¢åˆ æ”¹æŸ¥</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserRepositoryImpl</span> <span class="kd">implements</span> <span class="nc">UserRepository</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">MongoTemplate</span> <span class="n">mongoTemplate</span><span class="o">;</span>

    <span class="cm">/**
     * åˆ›å»ºå¯¹è±¡
     * @param user
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">saveUser</span><span class="o">(</span><span class="nc">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">mongoTemplate</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
     * æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢å¯¹è±¡
     * @param userName
     * @return
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">User</span> <span class="nf">findUserByUserName</span><span class="o">(</span><span class="nc">String</span> <span class="n">userName</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Query</span> <span class="n">query</span><span class="o">=</span><span class="k">new</span> <span class="nc">Query</span><span class="o">(</span><span class="nc">Criteria</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="s">"userName"</span><span class="o">).</span><span class="na">is</span><span class="o">(</span><span class="n">userName</span><span class="o">));</span>
        <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span>  <span class="n">mongoTemplate</span><span class="o">.</span><span class="na">findOne</span><span class="o">(</span><span class="n">query</span> <span class="o">,</span> <span class="nc">User</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">user</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
     * æ›´æ–°å¯¹è±¡
     * @param user
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">updateUser</span><span class="o">(</span><span class="nc">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Query</span> <span class="n">query</span><span class="o">=</span><span class="k">new</span> <span class="nc">Query</span><span class="o">(</span><span class="nc">Criteria</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="s">"id"</span><span class="o">).</span><span class="na">is</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">()));</span>
        <span class="nc">Update</span> <span class="n">update</span><span class="o">=</span> <span class="k">new</span> <span class="nc">Update</span><span class="o">().</span><span class="na">set</span><span class="o">(</span><span class="s">"userName"</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">getUserName</span><span class="o">()).</span><span class="na">set</span><span class="o">(</span><span class="s">"passWord"</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">getPassWord</span><span class="o">());</span>
        <span class="c1">//æ›´æ–°æŸ¥è¯¢è¿”å›ç»“æœé›†çš„ç¬¬ä¸€æ¡</span>
        <span class="nc">UpdateResult</span> <span class="n">result</span> <span class="o">=</span><span class="n">mongoTemplate</span><span class="o">.</span><span class="na">updateFirst</span><span class="o">(</span><span class="n">query</span><span class="o">,</span><span class="n">update</span><span class="o">,</span><span class="nc">User</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="c1">//æ›´æ–°æŸ¥è¯¢è¿”å›ç»“æœé›†çš„æ‰€æœ‰</span>
        <span class="c1">// mongoTemplate.updateMulti(query,update,UserEntity.class);</span>
        <span class="k">if</span><span class="o">(</span><span class="n">result</span><span class="o">!=</span><span class="kc">null</span><span class="o">)</span>
            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="na">getMatchedCount</span><span class="o">();</span>
        <span class="k">else</span>
            <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
     * åˆ é™¤å¯¹è±¡
     * @param id
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteUserById</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Query</span> <span class="n">query</span><span class="o">=</span><span class="k">new</span> <span class="nc">Query</span><span class="o">(</span><span class="nc">Criteria</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="s">"id"</span><span class="o">).</span><span class="na">is</span><span class="o">(</span><span class="n">id</span><span class="o">));</span>
        <span class="n">mongoTemplate</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">query</span><span class="o">,</span><span class="nc">User</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="4å¼€å‘å¯¹åº”çš„æµ‹è¯•æ–¹æ³•">4ã€å¼€å‘å¯¹åº”çš„æµ‹è¯•æ–¹æ³•</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RunWith</span><span class="o">(</span><span class="nc">SpringRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@SpringBootTest</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserDaoTest</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">UserDao</span> <span class="n">userDao</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testSaveUser</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">UserEntity</span> <span class="n">user</span><span class="o">=</span><span class="k">new</span> <span class="nc">UserEntity</span><span class="o">();</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">2</span><span class="n">l</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setUserName</span><span class="o">(</span><span class="s">"å°æ˜"</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setPassWord</span><span class="o">(</span><span class="s">"fffooo123"</span><span class="o">);</span>
        <span class="n">userDao</span><span class="o">.</span><span class="na">saveUser</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">findUserByUserName</span><span class="o">(){</span>
       <span class="nc">UserEntity</span> <span class="n">user</span><span class="o">=</span> <span class="n">userDao</span><span class="o">.</span><span class="na">findUserByUserName</span><span class="o">(</span><span class="s">"å°æ˜"</span><span class="o">);</span>
       <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"user is "</span><span class="o">+</span><span class="n">user</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateUser</span><span class="o">(){</span>
        <span class="nc">UserEntity</span> <span class="n">user</span><span class="o">=</span><span class="k">new</span> <span class="nc">UserEntity</span><span class="o">();</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">2</span><span class="n">l</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setUserName</span><span class="o">(</span><span class="s">"å¤©ç©º"</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setPassWord</span><span class="o">(</span><span class="s">"fffxxxx"</span><span class="o">);</span>
        <span class="n">userDao</span><span class="o">.</span><span class="na">updateUser</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteUserById</span><span class="o">(){</span>
        <span class="n">userDao</span><span class="o">.</span><span class="na">deleteUserById</span><span class="o">(</span><span class="mi">1</span><span class="n">l</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<h3 id="5æŸ¥çœ‹éªŒè¯ç»“æœ">5ã€æŸ¥çœ‹éªŒè¯ç»“æœ</h3>

<p>å¯ä»¥ä½¿ç”¨å·¥å…· MongoVUE å·¥å…·æ¥è¿æ¥åç›´æ¥å›¾å½¢åŒ–å±•ç¤ºæŸ¥çœ‹ï¼Œä¹Ÿå¯ä»¥ç™»å½•æœåŠ¡å™¨ç”¨å‘½ä»¤æ¥æŸ¥çœ‹</p>

<p>1.ç™»å½• mongos</p>
<blockquote>
  <p>bin/mongo -host localhost -port 20000</p>
</blockquote>

<p>2ã€åˆ‡æ¢åˆ° test åº“</p>
<blockquote>
  <p>use test</p>
</blockquote>

<p>3ã€æŸ¥è¯¢ user é›†åˆæ•°æ®</p>
<blockquote>
  <p>db.user.find()</p>
</blockquote>

<p>æ ¹æ®3æŸ¥è¯¢çš„ç»“æœæ¥è§‚å¯Ÿæµ‹è¯•ç”¨ä¾‹çš„æ‰§è¡Œæ˜¯å¦æ­£ç¡®ã€‚</p>

<p>åˆ°æ­¤ Spring Boot å¯¹åº” MongoDB çš„å¢åˆ æ”¹æŸ¥åŠŸèƒ½å·²ç»å…¨éƒ¨å®ç°ã€‚</p>

<h2 id="å¤šæ•°æ®æº-mongodb-çš„ä½¿ç”¨">å¤šæ•°æ®æº MongoDB çš„ä½¿ç”¨</h2>

<p>æ¥ä¸‹æ¥å®ç° MongoDB å¤šæ•°æ®æºçš„ä½¿ç”¨</p>

<h3 id="1pom-åŒ…é…ç½®-1">1ã€pom åŒ…é…ç½®</h3>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-data-mongodb<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div></div>

<h3 id="2é…ç½®ä¸¤æ¡æ•°æ®æºå¦‚ä¸‹">2ã€é…ç½®ä¸¤æ¡æ•°æ®æºï¼Œå¦‚ä¸‹ï¼š</h3>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">mongodb.primary.uri</span><span class="p">=</span><span class="s">mongodb://192.168.0.75:20000</span>
<span class="py">mongodb.primary.database</span><span class="p">=</span><span class="s">primary</span>
<span class="py">mongodb.secondary.uri</span><span class="p">=</span><span class="s">mongodb://192.168.0.75:20000</span>
<span class="py">mongodb.secondary.database</span><span class="p">=</span><span class="s">secondary</span>
</code></pre></div></div>

<h3 id="3é…ç½®ä¸¤ä¸ªåº“çš„æ•°æ®æº">3ã€é…ç½®ä¸¤ä¸ªåº“çš„æ•°æ®æº</h3>

<p>å°è£…è¯»å–ä»¥ Mongodb å¼€å¤´çš„ä¸¤ä¸ªé…ç½®æ–‡ä»¶</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Data</span>
<span class="nd">@ConfigurationProperties</span><span class="o">(</span><span class="n">prefix</span> <span class="o">=</span> <span class="s">"mongodb"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MultipleMongoProperties</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="nc">MongoProperties</span> <span class="n">primary</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MongoProperties</span><span class="o">();</span>
	<span class="kd">private</span> <span class="nc">MongoProperties</span> <span class="n">secondary</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MongoProperties</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>é…ç½®ä¸åŒåŒ…è·¯å¾„ä¸‹ä½¿ç”¨ä¸åŒçš„æ•°æ®æº</p>

<p>ç¬¬ä¸€ä¸ªåº“çš„å°è£…</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="nd">@EnableMongoRepositories</span><span class="o">(</span><span class="n">basePackages</span> <span class="o">=</span> <span class="s">"com.neo.model.repository.primary"</span><span class="o">,</span>
		<span class="n">mongoTemplateRef</span> <span class="o">=</span> <span class="nc">PrimaryMongoConfig</span><span class="o">.</span><span class="na">MONGO_TEMPLATE</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PrimaryMongoConfig</span> <span class="o">{</span>

	<span class="kd">protected</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">MONGO_TEMPLATE</span> <span class="o">=</span> <span class="s">"primaryMongoTemplate"</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ç¬¬äºŒä¸ªåº“çš„å°è£…</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="nd">@EnableMongoRepositories</span><span class="o">(</span><span class="n">basePackages</span> <span class="o">=</span> <span class="s">"com.neo.model.repository.secondary"</span><span class="o">,</span>
		<span class="n">mongoTemplateRef</span> <span class="o">=</span> <span class="nc">SecondaryMongoConfig</span><span class="o">.</span><span class="na">MONGO_TEMPLATE</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecondaryMongoConfig</span> <span class="o">{</span>

	<span class="kd">protected</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">MONGO_TEMPLATE</span> <span class="o">=</span> <span class="s">"secondaryMongoTemplate"</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>è¯»å–å¯¹åº”çš„é…ç½®ä¿¡æ¯å¹¶ä¸”æ„é€ å¯¹åº”çš„ MongoTemplate</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MultipleMongoConfig</span> <span class="o">{</span>

	<span class="nd">@Autowired</span>
	<span class="kd">private</span> <span class="nc">MultipleMongoProperties</span> <span class="n">mongoProperties</span><span class="o">;</span>

	<span class="nd">@Primary</span>
	<span class="nd">@Bean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="nc">PrimaryMongoConfig</span><span class="o">.</span><span class="na">MONGO_TEMPLATE</span><span class="o">)</span>
	<span class="kd">public</span> <span class="nc">MongoTemplate</span> <span class="nf">primaryMongoTemplate</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
		<span class="k">return</span> <span class="k">new</span> <span class="nf">MongoTemplate</span><span class="o">(</span><span class="n">primaryFactory</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">mongoProperties</span><span class="o">.</span><span class="na">getPrimary</span><span class="o">()));</span>
	<span class="o">}</span>

	<span class="nd">@Bean</span>
	<span class="nd">@Qualifier</span><span class="o">(</span><span class="nc">SecondaryMongoConfig</span><span class="o">.</span><span class="na">MONGO_TEMPLATE</span><span class="o">)</span>
	<span class="kd">public</span> <span class="nc">MongoTemplate</span> <span class="nf">secondaryMongoTemplate</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">MongoTemplate</span><span class="o">(</span><span class="n">secondaryFactory</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">mongoProperties</span><span class="o">.</span><span class="na">getSecondary</span><span class="o">()));</span>
	<span class="o">}</span>

	<span class="nd">@Bean</span>
    <span class="nd">@Primary</span>
	<span class="kd">public</span> <span class="nc">MongoDbFactory</span> <span class="nf">primaryFactory</span><span class="o">(</span><span class="nc">MongoProperties</span> <span class="n">mongo</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
		<span class="k">return</span> <span class="k">new</span> <span class="nf">SimpleMongoDbFactory</span><span class="o">(</span><span class="k">new</span> <span class="nc">MongoClient</span><span class="o">(</span><span class="n">mongo</span><span class="o">.</span><span class="na">getHost</span><span class="o">(),</span> <span class="n">mongo</span><span class="o">.</span><span class="na">getPort</span><span class="o">()),</span>
				<span class="n">mongo</span><span class="o">.</span><span class="na">getDatabase</span><span class="o">());</span>
	<span class="o">}</span>

	<span class="nd">@Bean</span>
	<span class="kd">public</span> <span class="nc">MongoDbFactory</span> <span class="nf">secondaryFactory</span><span class="o">(</span><span class="nc">MongoProperties</span> <span class="n">mongo</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
		<span class="k">return</span> <span class="k">new</span> <span class="nf">SimpleMongoDbFactory</span><span class="o">(</span><span class="k">new</span> <span class="nc">MongoClient</span><span class="o">(</span><span class="n">mongo</span><span class="o">.</span><span class="na">getHost</span><span class="o">(),</span> <span class="n">mongo</span><span class="o">.</span><span class="na">getPort</span><span class="o">()),</span>
				<span class="n">mongo</span><span class="o">.</span><span class="na">getDatabase</span><span class="o">());</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ä¸¤ä¸ªåº“çš„é…ç½®ä¿¡æ¯å·²ç»å®Œæˆã€‚</p>

<h3 id="4åˆ›å»ºä¸¤ä¸ªåº“åˆ†åˆ«å¯¹åº”çš„å¯¹è±¡å’Œ-repository">4ã€åˆ›å»ºä¸¤ä¸ªåº“åˆ†åˆ«å¯¹åº”çš„å¯¹è±¡å’Œ Repository</h3>

<p>å¯¹åº”å¯ä»¥å…±ç”¨</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3258839839160856613L</span><span class="o">;</span>
        <span class="kd">private</span> <span class="nc">String</span>  <span class="n">id</span><span class="o">;</span>
        <span class="kd">private</span> <span class="nc">String</span> <span class="n">userName</span><span class="o">;</span>
        <span class="kd">private</span> <span class="nc">String</span> <span class="n">passWord</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">User</span><span class="o">(</span><span class="nc">String</span> <span class="n">userName</span><span class="o">,</span> <span class="nc">String</span> <span class="n">passWord</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">userName</span> <span class="o">=</span> <span class="n">userName</span><span class="o">;</span>
                <span class="k">this</span><span class="o">.</span><span class="na">passWord</span> <span class="o">=</span> <span class="n">passWord</span><span class="o">;</span>
        <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>å¯¹åº”çš„ Repository</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">PrimaryRepository</span> <span class="kd">extends</span> <span class="nc">MongoRepository</span><span class="o">&lt;</span><span class="nc">PrimaryMongoObject</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="o">{</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ç»§æ‰¿äº† MongoRepository ä¼šé»˜è®¤å®ç°å¾ˆå¤šåŸºæœ¬çš„å¢åˆ æ”¹æŸ¥ï¼Œçœäº†å¾ˆå¤šè‡ªå·±å†™ Repository å±‚çš„ä»£ç </p>

<p>Secondary å’Œä¸Šé¢çš„ä»£ç ç±»ä¼¼å°±ä¸è´´å‡ºæ¥äº†</p>

<h2 id="5æœ€åæµ‹è¯•">5ã€æœ€åæµ‹è¯•</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RunWith</span><span class="o">(</span><span class="nc">SpringRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@SpringBootTest</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MuliDatabaseTest</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">PrimaryRepository</span> <span class="n">primaryRepository</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">SecondaryRepository</span> <span class="n">secondaryRepository</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">TestSave</span><span class="o">()</span> <span class="o">{</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"************************************************************"</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"æµ‹è¯•å¼€å§‹"</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"************************************************************"</span><span class="o">);</span>

        <span class="k">this</span><span class="o">.</span><span class="na">primaryRepository</span>
                <span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="k">new</span> <span class="nc">PrimaryMongoObject</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="s">"ç¬¬ä¸€ä¸ªåº“çš„å¯¹è±¡"</span><span class="o">));</span>

        <span class="k">this</span><span class="o">.</span><span class="na">secondaryRepository</span>
                <span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="k">new</span> <span class="nc">SecondaryMongoObject</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="s">"ç¬¬äºŒä¸ªåº“çš„å¯¹è±¡"</span><span class="o">));</span>

        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">PrimaryMongoObject</span><span class="o">&gt;</span> <span class="n">primaries</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">primaryRepository</span><span class="o">.</span><span class="na">findAll</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">PrimaryMongoObject</span> <span class="n">primary</span> <span class="o">:</span> <span class="n">primaries</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">primary</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
        <span class="o">}</span>

        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">SecondaryMongoObject</span><span class="o">&gt;</span> <span class="n">secondaries</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">secondaryRepository</span><span class="o">.</span><span class="na">findAll</span><span class="o">();</span>

        <span class="k">for</span> <span class="o">(</span><span class="nc">SecondaryMongoObject</span> <span class="n">secondary</span> <span class="o">:</span> <span class="n">secondaries</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">secondary</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
        <span class="o">}</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"************************************************************"</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"æµ‹è¯•å®Œæˆ"</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"************************************************************"</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>åˆ°æ­¤ï¼ŒMongoDB å¤šæ•°æ®æºçš„ä½¿ç”¨å·²ç»å®Œæˆã€‚</p>

<blockquote>
  <p>æ–‡ç« å†…å®¹å·²ç»å‡çº§åˆ° Spring Boot 2.x</p>
</blockquote>

<p><strong><a href="https://github.com/ityouknow/spring-boot-examples/tree/master/spring-boot-mongodb">ç¤ºä¾‹ä»£ç -github</a></strong></p>

<p><strong><a href="https://gitee.com/ityouknow/spring-boot-examples/tree/master/spring-boot-mongodb">ç¤ºä¾‹ä»£ç -ç äº‘</a></strong></p>

:ET