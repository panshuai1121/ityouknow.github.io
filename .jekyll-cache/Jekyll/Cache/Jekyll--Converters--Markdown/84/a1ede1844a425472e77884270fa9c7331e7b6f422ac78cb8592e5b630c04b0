I";†<p>è¿™ç¯‡æ–‡ç« ä»‹ç»å¦‚ä½•æ­å»ºFastDFS é›†ç¾¤</p>

<p>FastDFSæ˜¯ä¸€ä¸ªå¼€æºçš„è½»é‡çº§åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒå¯¹æ–‡ä»¶è¿›è¡Œç®¡ç†ï¼ŒåŠŸèƒ½åŒ…æ‹¬ï¼šæ–‡ä»¶å­˜å‚¨ã€æ–‡ä»¶åŒæ­¥ã€æ–‡ä»¶è®¿é—®ï¼ˆæ–‡ä»¶ä¸Šä¼ ã€æ–‡ä»¶ä¸‹è½½ï¼‰ç­‰ï¼Œè§£å†³äº†å¤§å®¹é‡å­˜å‚¨å’Œè´Ÿè½½å‡è¡¡çš„é—®é¢˜ã€‚ç‰¹åˆ«é€‚åˆä»¥æ–‡ä»¶ä¸ºè½½ä½“çš„åœ¨çº¿æœåŠ¡ï¼Œå¦‚ç›¸å†Œç½‘ç«™ã€è§†é¢‘ç½‘ç«™ç­‰ç­‰ã€‚</p>

<p>FastDFSä¸ºäº’è”ç½‘é‡èº«å®šåˆ¶ï¼Œå……åˆ†è€ƒè™‘äº†å†—ä½™å¤‡ä»½ã€è´Ÿè½½å‡è¡¡ã€çº¿æ€§æ‰©å®¹ç­‰æœºåˆ¶ï¼Œå¹¶æ³¨é‡é«˜å¯ç”¨ã€é«˜æ€§èƒ½ç­‰æŒ‡æ ‡ï¼Œä½¿ç”¨FastDFSå¾ˆå®¹æ˜“æ­å»ºä¸€å¥—é«˜æ€§èƒ½çš„æ–‡ä»¶æœåŠ¡å™¨é›†ç¾¤æä¾›æ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ç­‰æœåŠ¡ã€‚</p>

<h2 id="ç¯å¢ƒå‡†å¤‡">ç¯å¢ƒå‡†å¤‡</h2>

<p>ç³»ç»Ÿç³»ç»Ÿ centos6.5      <br />
å…­å°æœåŠ¡å™¨ï¼š192.168.53.85/86/90
            192.168.54.73/74/75<br />
å®‰è£…åŒ…ï¼š</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fastdfs-5.05.tar.gz
libfastcommon-1.0.36.zip
nginx-1.7.9.tar.gz
</code></pre></div></div>

<p>æœåŠ¡å™¨è§„åˆ’</p>

<p>trackeræœåŠ¡å™¨ï¼š192.168.53.85/86 
storageæœåŠ¡å™¨ï¼š192.168.53.90
               192.168.54.73/74/75</p>

<h2 id="å®‰è£…fastdfså…¨éƒ¨">å®‰è£…Fastdfs(å…¨éƒ¨)</h2>

<p>å®‰è£…ä¾èµ–åŒ…</p>

<blockquote>
  <p>æ³¨æ„ï¼šFastDFS 5.x å–æ¶ˆäº†å¯¹ libevent çš„ä¾èµ–ï¼Œæ·»åŠ äº†å¯¹ libfastcommon çš„ä¾èµ–ã€‚</p>
</blockquote>

<ul>
  <li>åœ¨å®‰è£…FastDFSå’ŒNginxä¹‹å‰ï¼Œéœ€ç¡®ä¿gccã€gcc-c++ã€ libstdc++-develã€makeç­‰ä¾èµ–åº“å’Œå·¥å…·å·²ç»å®‰è£…</li>
</ul>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#å®‰è£…ä¾èµ–è½¯ä»¶</span>
yum <span class="nt">-y</span> <span class="nb">install </span>gcc gcc-c++ libstdc++-devel pcre-devel zlib-devel wget make
yum <span class="nt">-y</span> groupinstall <span class="s1">'Development Tools'</span> 
</code></pre></div></div>

<p>å®‰è£…libfastcommonç±»åº“</p>

<p>å®‰è£…FastDFSå¿…é¡»å…ˆå®‰è£…libfastcommonç±»åº“ï¼Œå¦åˆ™ä¼šå¯¼è‡´æŠ¥é”™ï¼Œå®‰è£…ç›´æ¥æ ¹æ®å¦‚ä¸‹å‡ ä¸ªæ­¥éª¤å³å¯~</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>unzip libfastcommon-1.0.36.zip  <span class="nt">-d</span> /usr/local

<span class="nb">cd</span> /usr/local/libfastcommon-1.0.36
./make.sh
./make.sh <span class="nb">install</span>
</code></pre></div></div>

<p>å®‰è£…FastDFS</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">tar</span> <span class="nt">-xvzf</span> fastdfs-5.05.tar.gz <span class="nt">-C</span> /usr/local

<span class="nb">cd</span> /usr/local/fastdfs-5.05
./make.sh
./make.sh <span class="nb">install</span>
</code></pre></div></div>

<p>å®‰è£…å¥½ä¹‹åï¼Œåœ¨/usr/binç›®å½•ä¸‹ï¼Œå¯ä»¥çœ‹fdfså¼€å¤´çš„å‘½ä»¤å·¥å…·</p>

<blockquote>
  <p>FastDFSå®‰è£…å®Œæˆä¹‹åï¼Œæ‰€æœ‰é…ç½®æ–‡ä»¶åœ¨/etc/fdfsç›®å½•ä¸‹ï¼Œtrackeréœ€è¦tracker.confé…ç½®æ–‡ä»¶ï¼Œstorageéœ€è¦storage.confé…ç½®æ–‡ä»¶ã€‚</p>
</blockquote>

<h2 id="å®‰è£…tracker8586">å®‰è£…trackerï¼ˆ85/86ï¼‰</h2>

<p>å°†tracker.conf.sampleæ–‡ä»¶é‡å‘½åä¸ºtracker.confï¼Œç„¶åä¿®æ”¹é…ç½®æ–‡ä»¶/etc/fdfs/tracker.conf</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># å­˜å‚¨æ—¥å¿—å’Œæ•°æ®çš„æ ¹ç›®å½•</span>
<span class="nb">mkdir</span> /root/fastdfs

<span class="nb">cd</span> /etc/fdfs
<span class="nb">cp </span>tracker.conf.sample tracker.conf
</code></pre></div></div>

<p>åªéœ€è¦ä¿®æ”¹ base_pashè·¯å¾„ï¼ˆæ–‡ä»¶å­˜å‚¨è·¯å¾„ï¼‰</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vi tracker.conf
<span class="nv">base_path</span><span class="o">=</span>/root/fastdfs
</code></pre></div></div>

<p>é…ç½®æ–‡ä»¶ä¸­æœ‰è¿™å‡ ä¸ªå‚æ•°éœ€è¦æ³¨æ„ï¼š</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#å¯ç”¨é…ç½®æ–‡ä»¶</span>
<span class="nv">disabled</span><span class="o">=</span><span class="nb">false</span>
<span class="c">#è®¾ç½®trackerçš„ç«¯å£å·</span>
<span class="nv">port</span><span class="o">=</span>22122
<span class="c">#è®¾ç½®trackerçš„æ•°æ®æ–‡ä»¶å’Œæ—¥å¿—ç›®å½•ï¼ˆéœ€æ‰‹åŠ¨åˆ›å»ºï¼‰</span>
<span class="nv">base_path</span><span class="o">=</span>/root/fastdfs
<span class="c">#è®¾ç½®httpç«¯å£å·</span>
http.server_port<span class="o">=</span>9090
</code></pre></div></div>

<p>ä½¿ç”¨<code class="highlighter-rouge">/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf start</code>å°è¯•å¯åŠ¨tracker</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@localhost ~]# fdfs_trackerd /etc/fdfs/tracker.conf restart
<span class="o">[</span>root@localhost ~]# 
</code></pre></div></div>

<p>æ²¡æœ‰æŠ¥é”™ï¼ŒæŸ¥çœ‹ç«¯å£22122æ˜¯å¦å¼€å§‹ç›‘å¬ï¼Œç¡®è®¤å¯åŠ¨æ˜¯å¦æˆåŠŸã€‚</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@localhost ~]# ps <span class="nt">-ef</span>|grep fdfs
root      6078     1  0 11:59 ?        00:00:00 /usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf start
root      6101  6054  0 12:01 pts/2    00:00:00 <span class="nb">grep </span>fdfs
<span class="o">[</span>root@localhost ~]# netstat <span class="nt">-unltp</span> | <span class="nb">grep </span>fdfs
tcp        0      0 0.0.0.0:22122               0.0.0.0:<span class="k">*</span>                   LISTEN      6078/fdfs_trackerd  
</code></pre></div></div>

<p>ä¹Ÿå¯ä»¥æŸ¥çœ‹trackerçš„æ—¥å¿—æ˜¯å¦å¯åŠ¨æˆåŠŸ</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@localhost ~]# <span class="nb">cat</span> /root/fastdfs/logs/trackerd.log 
<span class="o">[</span>2017-10-09 11:59:12] INFO - FastDFS v5.05, <span class="nv">base_path</span><span class="o">=</span>/root/fastdfs, run_by ...
</code></pre></div></div>

<p>è‡³æ­¤ï¼Œä¸€ä¸ªç®€å•çš„çš„trackeré…ç½®å°±å®Œæˆäº†ï¼ŒTrackerä¹ŸæˆåŠŸå¯åŠ¨~ï¼Œ æ¥ä¸‹æ¥è¦åšçš„å°±æ˜¯å®ŒæˆStorageçš„é…ç½®~</p>

<h2 id="å®‰è£…storage90737475">å®‰è£…storageï¼ˆ90/73/74/75ï¼‰</h2>

<p>å°†å­˜å‚¨èŠ‚ç‚¹åˆ†ä¸ºä¸¤ä¸ªç»„ï¼Œå…¶ä¸­group1 ï¼ˆ72ã€73ï¼‰ã€group2 ï¼ˆ74ã€75ï¼‰ã€‚</p>

<p>åˆ›å»ºå­˜å‚¨ç›®å½•å’Œé…ç½®æ–‡ä»¶</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> /root/fastdfs

<span class="nb">cd</span> /etc/fdfs
<span class="nb">cp </span>storage.conf.sample storage.conf
</code></pre></div></div>

<p>ä¿®æ”¹é…ç½®</p>

<p>storageä¸»è¦å®Œæˆbase_pathï¼Œstore_pathä»¥åŠtrackerçš„è¿æ¥åœ°å€ä»¥åŠstorageçš„httpæœåŠ¡ç«¯å£é…ç½®ç­‰ã€‚</p>

<p>ä¸»è¦æœ‰å¦‚ä¸‹å‡ ä¸ªå‚æ•°ï¼š</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vi /etc/fdfs/storage.conf
<span class="c"># å†…å®¹</span>
<span class="nv">group_name</span><span class="o">=</span>group1                   <span class="c"># ç»„åï¼ˆç¬¬ä¸€ç»„ä¸ºgroup1ï¼Œç¬¬äºŒç»„ä¸ºgroup2ï¼Œä¾æ¬¡ç±»æ¨...ï¼‰</span>
<span class="nv">base_path</span><span class="o">=</span>/root/fastdfs             <span class="c"># æ•°æ®å’Œæ—¥å¿—æ–‡ä»¶å­˜å‚¨æ ¹ç›®å½•</span>
<span class="nv">store_path0</span><span class="o">=</span>/root/fastdfs           <span class="c">#ç¬¬ä¸€ä¸ªå­˜å‚¨ç›®å½•ï¼Œç¬¬äºŒä¸ªå­˜å‚¨ç›®å½•èµ·åä¸ºï¼šstore_path1=xxxï¼Œå…¶å®ƒå­˜å‚¨ç›®å½•åä¾æ¬¡ç±»æ¨...</span>
<span class="nv">store_path_count</span><span class="o">=</span>1                  <span class="c"># å­˜å‚¨è·¯å¾„ä¸ªæ•°ï¼Œéœ€è¦å’Œstore_pathä¸ªæ•°åŒ¹é…</span>
<span class="nv">tracker_server</span><span class="o">=</span>192.168.53.85:22122          <span class="c"># trackeræœåŠ¡å™¨IPå’Œç«¯å£</span>
<span class="nv">tracker_server</span><span class="o">=</span>192.168.53.86:22122          <span class="c"># trackeræœåŠ¡å™¨IPå’Œç«¯å£</span>
</code></pre></div></div>

<p>å¯åŠ¨Storage</p>

<blockquote>
  <p>å¯åŠ¨storageï¼Œä¼šæ ¹æ®é…ç½®æ–‡ä»¶çš„è®¾ç½®è‡ªåŠ¨åˆ›å»ºå¤šçº§å­˜å‚¨ç›®å½•ï¼ŒæŸ¥çœ‹ç«¯å£23000æ˜¯å¦å¼€å§‹ç›‘å¬ï¼Œç¡®è®¤å¯åŠ¨æ˜¯å¦æˆåŠŸã€‚</p>
</blockquote>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@localhost fdfs]# fdfs_storaged /etc/fdfs/storage.conf restart
<span class="o">[</span>root@localhost fdfs]# netstat <span class="nt">-unltp</span> | <span class="nb">grep </span>fdfs
tcp        0      0 0.0.0.0:23000               0.0.0.0:<span class="k">*</span>                   LISTEN      5551/fdfs_storaged  
</code></pre></div></div>

<p>ä¹Ÿå¯ä»¥æŸ¥çœ‹storageçš„æ—¥å¿—æ˜¯å¦å¯åŠ¨æˆåŠŸã€‚</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@localhost logs]# <span class="nb">cat</span> /root/fastdfs/logs/storaged.log 
<span class="o">[</span>2017-10-09 15:39:12] INFO - FastDFS v5.05, <span class="nv">base_path</span><span class="o">=</span>/root/fastdfs, <span class="nv">store_path_count</span><span class="o">=</span>1 ...
</code></pre></div></div>

<p>éªŒè¯storageæ˜¯å¦ç™»è®°åˆ°trackeræœåŠ¡å™¨</p>

<p>ä½¿ç”¨<code class="highlighter-rouge">fdfs_monitor /etc/fdfs/storage.conf</code>ï¼Œè¿è¡Œfdfs_monitoræŸ¥çœ‹storageæœåŠ¡å™¨æ˜¯å¦å·²ç»ç™»è®°åˆ°trackeræœåŠ¡å™¨ã€‚</p>

<blockquote>
  <p>å¯ä»¥åœ¨ä»»ä¸€å­˜å‚¨èŠ‚ç‚¹ä¸Šä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹é›†ç¾¤çš„çŠ¶æ€ä¿¡æ¯</p>
</blockquote>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fdfs_monitor /etc/fdfs/storage.conf
</code></pre></div></div>

<p>å¦‚æœå‡ºç°ip_addr = <IP> Active, åˆ™è¡¨æ˜storageæœåŠ¡å™¨å·²ç»ç™»è®°åˆ°trackeræœåŠ¡å™¨ï¼Œå¦‚ä¸‹ï¼š</IP></p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Storage 1:
        <span class="nb">id</span> <span class="o">=</span> 192.168.53.90
        ip_addr <span class="o">=</span> 192.168.53.90 <span class="o">(</span>localhost<span class="o">)</span>  ACTIVE
</code></pre></div></div>

<p>è‡³æ­¤ï¼Œtrackerã€storageç­‰é…ç½®éƒ½å®Œæˆå¹¶æˆåŠŸå¯åŠ¨</p>

<p>æ¥ä¸‹æ¥ï¼Œç»§ç»­å®ŒæˆNginxå’Œfastdfs-nginx-moduleçš„å®‰è£…å’Œé…ç½®</p>

<h2 id="åœ¨storageä¸Šå®‰è£…nginx">åœ¨storageä¸Šå®‰è£…nginx</h2>

<blockquote>
  <p>æ³¨æ„ï¼šfastdfs-nginx-moduleæ¨¡å—åªéœ€è¦å®‰è£…åˆ°storageä¸Šã€‚</p>
</blockquote>

<h3 id="å®‰è£…">å®‰è£…</h3>

<p>è§£å‹å®‰è£…åŒ…</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">tar</span> <span class="nt">-xvzf</span> fastdfs-nginx-module_v1.16.tar.gz <span class="nt">-C</span> /usr/local
<span class="nb">tar</span> <span class="nt">-zvxf</span> nginx-1.7.9.tar.gz  <span class="nt">-C</span> /usr/local
</code></pre></div></div>

<p>éœ€è¦å…ˆé…ç½®è½¯é“¾æ¥:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ln</span> <span class="nt">-sv</span> /usr/include/fastcommon /usr/local/include/fastcommon 
<span class="nb">ln</span> <span class="nt">-sv</span> /usr/include/fastdfs /usr/local/include/fastdfs 
<span class="nb">ln</span> <span class="nt">-sv</span> /usr/lib64/libfastcommon.so /usr/local/lib/libfastcommon.so
</code></pre></div></div>

<blockquote>
  <p>å®‰è£…nginxçš„æ—¶å€™ï¼Œæ·»åŠ  fastdfs-nginx-module-masteræ¨¡å—ï¼Œå¦‚ï¼š
<code class="highlighter-rouge">./configure --add-module=../fastdfs-nginx-module/src/</code></p>
</blockquote>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /usr/local/nginx-1.7.9
./configure <span class="nt">--prefix</span><span class="o">=</span>/usr/local/nginx <span class="nt">--add-module</span><span class="o">=</span>/usr/local/fastdfs-nginx-module/src
</code></pre></div></div>

<p>configure æˆåŠŸè¾“å‡ºç»“æœï¼š</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>checking <span class="k">for </span>OS
 + Linux 2.6.32-431.el6.x86_64 x86_64
checking <span class="k">for </span>C compiler ... found
 + using GNU C compiler
 + gcc version: 4.4.7 20120313 <span class="o">(</span>Red Hat 4.4.7-18<span class="o">)</span> <span class="o">(</span>GCC<span class="o">)</span> 
checking <span class="k">for </span>gcc <span class="nt">-pipe</span> switch ... found

......

nginx http access log file: <span class="s2">"/usr/local/nginx/logs/access.log"</span>
nginx http client request body temporary files: <span class="s2">"client_body_temp"</span>
nginx http proxy temporary files: <span class="s2">"proxy_temp"</span>
nginx http fastcgi temporary files: <span class="s2">"fastcgi_temp"</span>
nginx http uwsgi temporary files: <span class="s2">"uwsgi_temp"</span>
nginx http scgi temporary files: <span class="s2">"scgi_temp"</span> 
</code></pre></div></div>
<p>configureæˆåŠŸäº†</p>

<p>æ¥ä¸‹æ¥æ‰§è¡Œmakeå’Œmake install</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make
</code></pre></div></div>

<p>ç¡®å®šç¼–è¯‘æ²¡æœ‰å‡ºé”™ï¼Œå†è¿›è¡Œinstall</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make <span class="nb">install</span> 
</code></pre></div></div>

<p>å®‰è£…æˆåŠŸï¼ŒæŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/usr/local/nginx/sbin/nginx <span class="nt">-V</span>
</code></pre></div></div>

<h3 id="é…ç½®">é…ç½®</h3>

<p><strong>é…ç½®fastdfs-nginx-module</strong></p>

<p>è¿›å…¥fastdfs-nginx-moduleçš„srcç›®å½•ï¼Œå°†md_fastdfs.confé…ç½®æ–‡ä»¶æ‹·è´åˆ°/etc/fdfs/ç›®å½•ä¸­</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /usr/local/fastdfs-nginx-module/src
<span class="nb">cp </span>mod_fastdfs.conf /etc/fdfs/
</code></pre></div></div>

<p>é…ç½® mod_fastdfs.conf</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim /etc/fdfs/mod_fastdfs.conf
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ä¸€èˆ¬åªéœ€æ”¹åŠ¨ä»¥ä¸‹å‡ ä¸ªå‚æ•°å³å¯ï¼š
<span class="nv">base_path</span><span class="o">=</span>/root/fastdfs           <span class="c">#ä¿å­˜æ—¥å¿—ç›®å½•</span>
<span class="nv">tracker_server</span><span class="o">=</span>192.168.53.85:22122
<span class="nv">tracker_server</span><span class="o">=</span>192.168.53.86:22122 
<span class="nv">storage_server_port</span><span class="o">=</span>23000         <span class="c">#storageæœåŠ¡å™¨çš„ç«¯å£å·</span>
<span class="nv">group_name</span><span class="o">=</span>group1                 <span class="c">#å½“å‰æœåŠ¡å™¨çš„groupå</span>
url_have_group_name <span class="o">=</span> <span class="nb">true</span>        <span class="c">#æ–‡ä»¶urlä¸­æ˜¯å¦æœ‰groupå</span>
<span class="nv">store_path_count</span><span class="o">=</span>1                <span class="c">#å­˜å‚¨è·¯å¾„ä¸ªæ•°ï¼Œéœ€è¦å’Œstore_pathä¸ªæ•°åŒ¹é…</span>
<span class="nv">store_path0</span><span class="o">=</span>/root/fastdfs         <span class="c">#å­˜å‚¨è·¯å¾„</span>
group_count <span class="o">=</span> 2                   <span class="c">#è®¾ç½®ç»„çš„ä¸ªæ•°</span>
</code></pre></div></div>

<p>åœ¨æœ«å°¾å¢åŠ 3ä¸ªç»„çš„å…·ä½“ä¿¡æ¯ï¼š</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>group1]
<span class="nv">group_name</span><span class="o">=</span>group1
<span class="nv">storage_server_port</span><span class="o">=</span>23000
<span class="nv">store_path_count</span><span class="o">=</span>1
<span class="nv">store_path0</span><span class="o">=</span>/root/fastdfs

<span class="o">[</span>group2]
<span class="nv">group_name</span><span class="o">=</span>group2
<span class="nv">storage_server_port</span><span class="o">=</span>23000
<span class="nv">store_path_count</span><span class="o">=</span>1
<span class="nv">store_path0</span><span class="o">=</span>/root/fastdfs
</code></pre></div></div>

<p>å»ºç«‹M00è‡³å­˜å‚¨ç›®å½•çš„ç¬¦å·è¿æ¥ã€‚</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ln</span> <span class="nt">-s</span> /root/fastdfs/data /root/fastdfs/data/M00
ll /root/fastdfs/data/M00
</code></pre></div></div>

<p><strong>é…ç½®nginx</strong></p>

<p>ç¼–è¾‘<code class="highlighter-rouge">/usr/local/nginx/conf</code>é…ç½®æ–‡ä»¶ç›®å½•ä¸‹çš„nginx.confï¼Œè®¾ç½®æ·»åŠ storageä¿¡æ¯å¹¶ä¿å­˜ã€‚</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim /usr/local/nginx/conf/nginx.conf
</code></pre></div></div>

<p>å°†serveræ®µä¸­çš„listenç«¯å£å·æ”¹ä¸º8080ï¼Œå¯åŠ¨ç”¨æˆ·ä½¿ç”¨rootã€‚</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>user root
listen       8080<span class="p">;</span>
</code></pre></div></div>

<p>åœ¨serveræ®µä¸­æ·»åŠ ï¼š</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>location ~/group[1-2]/M00 <span class="o">{</span>
    root /root/fastdfs/data<span class="p">;</span>
    ngx_fastdfs_module<span class="p">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>å¤åˆ¶fastdfsä¸­çš„http.confã€mime.typesæ–‡ä»¶åˆ°/etc/fdfs</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cp</span> /usr/local/fastdfs-5.05/conf/http.conf /usr/local/fastdfs-5.05/conf/mime.types  /etc/fdfs
</code></pre></div></div>

<p>è‡³æ­¤ï¼Œnginxä»¥åŠFastDFSæ’ä»¶æ¨¡å—è®¾ç½®å®Œæˆã€‚</p>

<h3 id="è¿è¡Œ">è¿è¡Œ</h3>

<p>è¿è¡Œnginxä¹‹å‰ï¼Œå…ˆè¦æŠŠé˜²ç«å¢™ä¸­å¯¹åº”çš„ç«¯å£æ‰“å¼€ï¼ˆæœ¬ä¾‹ä¸­ä¸º8080ï¼‰ã€‚</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>iptables <span class="nt">-I</span> INPUT <span class="nt">-p</span> tcp <span class="nt">-m</span> state <span class="nt">--state</span> NEW <span class="nt">-m</span> tcp <span class="nt">--dport</span> 8080 <span class="nt">-j</span> ACCEPT
/etc/init.d/iptables save
</code></pre></div></div>

<p>å¯åŠ¨nginxï¼Œç¡®è®¤å¯åŠ¨æ˜¯å¦æˆåŠŸã€‚ï¼ˆæŸ¥çœ‹æ˜¯å¦å¯¹åº”ç«¯å£8080æ˜¯å¦å¼€å§‹ç›‘å¬ï¼‰</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@localhost ~]# /usr/local/nginx/sbin/nginx
ngx_http_fastdfs_set <span class="nv">pid</span><span class="o">=</span>12768
<span class="o">[</span>root@localhost ~]# netstat <span class="nt">-unltp</span> | <span class="nb">grep </span>nginx
tcp        0      0 0.0.0.0:8080                0.0.0.0:<span class="k">*</span>                   LISTEN      12769/nginx  
</code></pre></div></div>

<p>ä¹Ÿå¯æŸ¥çœ‹nginxçš„æ—¥å¿—æ˜¯å¦å¯åŠ¨æˆåŠŸæˆ–æ˜¯å¦æœ‰é”™è¯¯ã€‚</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat</span> /usr/local/nginx/logs/error.log
</code></pre></div></div>

<p>åœ¨error.logä¸­æ²¡æœ‰é”™è¯¯ï¼Œæ—¢å¯åŠ¨æˆåŠŸã€‚å¯ä»¥æ‰“å¼€æµè§ˆå™¨ï¼Œç›´æ¥è®¿é—®http://192.168.53.90:8080ï¼ŒæŸ¥çœ‹æ˜¯å¦å¼¹å‡ºnginxæ¬¢è¿é¡µé¢ã€‚</p>

<p>æŸ¥çœ‹åˆ°æ¬¢è¿é¡µåˆ™è¯´æ˜ï¼Œnginxè¿è¡ŒæˆåŠŸã€‚ä¹‹åä¾æ¬¡åœ¨å…¶å®ƒstorageä¸Šå…¨éƒ¨å®‰è£…ä¸Šnginxå¹¶ç¡®è®¤è¿è¡Œæ­£å¸¸ã€‚</p>

<p>å°†nginxè®¾ç½®ä¸ºå¼€æœºå¯åŠ¨ï¼š</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim /etc/rc.d/rc.local
</code></pre></div></div>

<p>å°†è¿è¡Œå‘½ä»¤è¡Œæ·»åŠ è¿›æ–‡ä»¶ï¼š<code class="highlighter-rouge">/usr/local/nginx/sbin/nginx</code></p>

<h2 id="åœ¨trackerä¸Šå®‰è£…nginx">åœ¨trackerä¸Šå®‰è£…nginx</h2>

<p>åœ¨trackerä¸Šå®‰è£…çš„nginxä¸»è¦ä¸ºäº†æä¾›httpè®¿é—®çš„åå‘ä»£ç†ã€è´Ÿè½½å‡è¡¡ä»¥åŠç¼“å­˜æœåŠ¡ã€‚</p>

<h3 id="å®‰è£…-1">å®‰è£…</h3>

<p>è§£å‹</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">tar</span> <span class="nt">-zvxf</span> nginx-1.7.9.tar.gz  <span class="nt">-C</span> /usr/local
</code></pre></div></div>

<p>è¿è¡Œ./configureè¿›è¡Œå®‰è£…å‰çš„è®¾ç½®ï¼Œä¸»è¦è®¾ç½®å®‰è£…è·¯å¾„</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /usr/local/nginx-1.7.9
./configure <span class="nt">--prefix</span><span class="o">=</span>/usr/local/nginx
</code></pre></div></div>

<p>è¿è¡Œmakeè¿›è¡Œç¼–è¯‘ï¼Œç¡®ä¿ç¼–è¯‘æˆåŠŸã€‚</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make
</code></pre></div></div>

<p>è¿è¡Œmake installè¿›è¡Œå®‰è£…ã€‚</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make <span class="nb">install</span>
</code></pre></div></div>

<h3 id="é…ç½®-1">é…ç½®</h3>

<p>ç¼–è¾‘/usr/local/nginx/confé…ç½®æ–‡ä»¶ç›®å½•ä¸‹çš„nginx.confï¼Œè®¾ç½®è´Ÿè½½å‡è¡¡</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim /usr/local/nginx/conf/nginx.conf
</code></pre></div></div>

<p>é…ç½®ä¿¡æ¯</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>worker_processes  4<span class="p">;</span>                  <span class="c">#æ ¹æ®CPUæ ¸å¿ƒæ•°è€Œå®š</span>
events <span class="o">{</span>
    worker_connections  65535<span class="p">;</span>        <span class="c">#æœ€å¤§é“¾æ¥æ•°</span>
    use epoll<span class="p">;</span>                        <span class="c">#æ–°ç‰ˆæœ¬çš„Linuxå¯ä½¿ç”¨epollåŠ å¿«å¤„ç†æ€§èƒ½</span>
<span class="o">}</span>
http <span class="o">{</span>
    <span class="c">#è®¾ç½®group1çš„æœåŠ¡å™¨</span>
    upstream fdfs_group1 <span class="o">{</span>
        server 192.168.53.90:8080 <span class="nv">weight</span><span class="o">=</span>1 <span class="nv">max_fails</span><span class="o">=</span>2 <span class="nv">fail_timeout</span><span class="o">=</span>30s<span class="p">;</span>
        server 192.168.54.229:8080 <span class="nv">weight</span><span class="o">=</span>1 <span class="nv">max_fails</span><span class="o">=</span>2 <span class="nv">fail_timeout</span><span class="o">=</span>30s<span class="p">;</span>
    <span class="o">}</span>
    <span class="c">#è®¾ç½®group2çš„æœåŠ¡å™¨</span>
    upstream fdfs_group2 <span class="o">{</span>
        server 192.168.54.233:8080 <span class="nv">weight</span><span class="o">=</span>1 <span class="nv">max_fails</span><span class="o">=</span>2 <span class="nv">fail_timeout</span><span class="o">=</span>30s<span class="p">;</span>
        server 192.168.54.234:8080 <span class="nv">weight</span><span class="o">=</span>1 <span class="nv">max_fails</span><span class="o">=</span>2 <span class="nv">fail_timeout</span><span class="o">=</span>30s<span class="p">;</span>
    <span class="o">}</span>

   server <span class="o">{</span>
       <span class="c">#è®¾ç½®æœåŠ¡å™¨ç«¯å£</span>
        listen       8080<span class="p">;</span>
       <span class="c">#è®¾ç½®group1çš„è´Ÿè½½å‡è¡¡å‚æ•°</span>
        location /group1/M00 <span class="o">{</span>
            proxy_pass http://fdfs_group1<span class="p">;</span>
        <span class="o">}</span>
        <span class="c">#è®¾ç½®group2çš„è´Ÿè½½å‡è¡¡å‚æ•°</span>
        location /group2/M00 <span class="o">{</span>
            proxy_pass http://fdfs_group2<span class="p">;</span>
        <span class="o">}</span>
      <span class="o">}</span>

    <span class="o">}</span>
</code></pre></div></div>

<p>è‡³æ­¤ï¼Œnginxè®¾ç½®å®Œæˆã€‚</p>

<h3 id="è¿è¡Œ-1">è¿è¡Œ</h3>

<p>è¿è¡Œnginxä¹‹å‰ï¼Œå…ˆè¦æŠŠé˜²ç«å¢™ä¸­å¯¹åº”çš„ç«¯å£æ‰“å¼€ï¼ˆæœ¬ä¾‹ä¸­ä¸º8080ï¼‰</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>iptables <span class="nt">-I</span> INPUT <span class="nt">-p</span> tcp <span class="nt">-m</span> state <span class="nt">--state</span> NEW <span class="nt">-m</span> tcp <span class="nt">--dport</span> 8080 <span class="nt">-j</span> ACCEPT
/etc/init.d/iptables save
</code></pre></div></div>

<p>å¯åŠ¨nginxï¼Œç¡®è®¤å¯åŠ¨æ˜¯å¦æˆåŠŸã€‚ï¼ˆæŸ¥çœ‹æ˜¯å¦å¯¹åº”ç«¯å£8080æ˜¯å¦å¼€å§‹ç›‘å¬ï¼‰</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@localhost ~]# /usr/local/nginx/sbin/nginx
ngx_http_fastdfs_set <span class="nv">pid</span><span class="o">=</span>12768
<span class="o">[</span>root@localhost ~]# netstat <span class="nt">-unltp</span> | <span class="nb">grep </span>nginx
tcp        0      0 0.0.0.0:8080                0.0.0.0:<span class="k">*</span>                   LISTEN      12769/nginx  
</code></pre></div></div>

<p>ä¹Ÿå¯æŸ¥çœ‹nginxçš„æ—¥å¿—æ˜¯å¦å¯åŠ¨æˆåŠŸæˆ–æ˜¯å¦æœ‰é”™è¯¯ã€‚</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat</span> /usr/local/nginx/logs/error.log
</code></pre></div></div>

<p>å°è¯•ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶åˆ°FastDFSï¼Œç„¶åè®¿é—®è¯•è¯•ã€‚å…ˆé…ç½®client.confæ–‡ä»¶ã€‚</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cp </span>client.conf.sample  client.conf
vim /etc/fdfs/client.conf
</code></pre></div></div>

<p>ä¿®æ”¹ä»¥ä¸‹å‚æ•°ï¼š</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">base_path</span><span class="o">=</span>/root/fastdfs                   <span class="c">#æ—¥å¿—å­˜æ”¾è·¯å¾„</span>
<span class="nv">tracker_server</span><span class="o">=</span>192.168.53.85:22122         
<span class="nv">tracker_server</span><span class="o">=</span>192.168.53.86:22122 
http.tracker_server_port<span class="o">=</span>8080
</code></pre></div></div>

<p>ä½¿ç”¨/usr/local/bin/fdfs_upload_fileä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼Œç¨‹åºä¼šè‡ªåŠ¨è¿”å›æ–‡ä»¶çš„URLã€‚</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@localhost fdfs]# fdfs_upload_file /etc/fdfs/client.conf /root/test.jpg
group2/M00/00/00/wKg26VncfamAEqZ0AAu-4Kcs3QI677.jpg
</code></pre></div></div>

<p>ç„¶åä½¿ç”¨æµè§ˆå™¨è®¿é—®:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://192.168.53.85:8080/group2/M00/00/00/wKg26VncfamAEqZ0AAu-4Kcs3QI677.jpg
</code></pre></div></div>

<p>çœ‹æœ‰æŸ¥çœ‹åˆ°å›¾ç‰‡,è¯´æ˜é›†ç¾¤æ­å»ºæˆåŠŸï¼</p>

<p><img src="http://favorites.ren/assets/images/neo.jpg" alt="" /></p>

<blockquote>
  <p>ç”Ÿäº§ä¸­å¯ä»¥å°†ï¼š<code class="highlighter-rouge">/root/fastdfs</code> æ›¿æ¢ä¸ºï¼š<code class="highlighter-rouge">/fdfs/storage</code></p>
</blockquote>

<h2 id="æŠ¥é”™">æŠ¥é”™</h2>

<h3 id="ç¼–è¯‘nginxçš„æ—¶å€™æŠ¥é”™">ç¼–è¯‘nginxçš„æ—¶å€™æŠ¥é”™</h3>

<p>åœ¨nginxç›®å½•ä¸‹ï¼Œæ‰§è¡Œconfigureä¹‹åï¼Œè¿›è¡Œmakeç¼–è¯‘æŠ¥é”™ï¼ŒæŠ¥é”™å†…å®¹å¦‚ä¸‹ï¼š</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>s <span class="nt">-I</span> src/mail <span class="se">\</span>
                <span class="nt">-o</span> objs/addon/src/ngx_http_fastdfs_module.o <span class="se">\</span>
                /usr/local/fastdfs-nginx-module/src/ngx_http_fastdfs_module.c
In file included from /usr/local/fastdfs-nginx-module/src/ngx_http_fastdfs_module.c:6:
/usr/local/fastdfs-nginx-module/src/common.c:21:25: error: fdfs_define.h: No such file or directory

......

/usr/local/fastdfs-nginx-module/src/ngx_http_fastdfs_module.c:933: error: â€˜trueâ€™ undeclared <span class="o">(</span>first use <span class="k">in </span>this <span class="k">function</span><span class="o">)</span>
make[1]: <span class="k">***</span> <span class="o">[</span>objs/addon/src/ngx_http_fastdfs_module.o] Error 1
make[1]: Leaving directory <span class="sb">`</span>/usr/local/nginx-1.7.9<span class="s1">'
make: *** [build] Error 2
</span></code></pre></div></div>

<p>åšä»¥ä¸‹ä¿®æ”¹</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim /usr/local/fastdfs-nginx-module/src/config
</code></pre></div></div>

<p>å°†ã€</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">CORE_INCS</span><span class="o">=</span><span class="s2">"</span><span class="nv">$CORE_INCS</span><span class="s2"> /usr/local/include/fastdfs /usr/local/include/fastcommon/"</span>
</code></pre></div></div>

<p>ä¿®æ”¹ä¸ºï¼š</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">CORE_INCS</span><span class="o">=</span><span class="s2">"</span><span class="nv">$CORE_INCS</span><span class="s2"> /usr/include/fastdfs /usr/local/include/fastcommon/"</span>
</code></pre></div></div>

<p>å…¶å®å°±æ˜¯æ”¹åŠ¨äº†fastdfsçš„è·¯å¾„ï¼Œæ²¡æ”¹ä¹‹å‰ç›´æ¥è®¿é—®<code class="highlighter-rouge">cd /usr/local/include/fastdfs</code>ä¸ºç©ºç›®å½•ã€‚</p>

<p>æˆ–è€…è®¾ç½®å¯¹åº”çš„è½¯è¿æ¥ä¹Ÿå¯ä»¥ã€‚</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ln</span> <span class="nt">-sv</span> /usr/include/fastcommon /usr/local/include/fastcommon 
<span class="nb">ln</span> <span class="nt">-sv</span> /usr/include/fastdfs /usr/local/include/fastdfs 
<span class="nb">ln</span> <span class="nt">-sv</span> /usr/lib64/libfastcommon.so /usr/local/lib/libfastcommon.so
</code></pre></div></div>

<p>ä¿®æ”¹å®Œæˆä¹‹ååœ¨nginxç›®å½•ï¼Œé‡æ–°configureå’Œmakeå°±å¥½äº†ã€‚</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./configure <span class="nt">--prefix</span><span class="o">=</span>/usr/local/nginx <span class="nt">--add-module</span><span class="o">=</span>/usr/local/fastdfs-nginx-module/src
make
</code></pre></div></div>

<h3 id="å¯åŠ¨nginxæŠ¥é”™">å¯åŠ¨nginxæŠ¥é”™</h3>

<p>åœ¨åœ¨storageä¸Šé…ç½®nginxç›¸å…³ä¿¡æ¯åå¯åŠ¨nginxï¼ŒæŸ¥çœ‹æ—¥å¿—å‘ç°æŠ¥é”™ï¼š</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat</span> /usr/local/nginx/logs/error.log
ngx_http_fastdfs_process_init <span class="nv">pid</span><span class="o">=</span>12770
<span class="o">[</span>2017-10-10 13:41:44] ERROR - file: ini_file_reader.c, line: 631, include file <span class="s2">"http.conf"</span> not exists, line: <span class="s2">"#include http.conf"</span>
<span class="o">[</span>2017-10-10 13:41:44] ERROR - file: /usr/local/fastdfs-nginx-module/src/common.c, line: 155, load conf file <span class="s2">"/etc/fdfs/mod_fastdfs.conf"</span> fail, ret code: 2
2017/10/10 13:41:44 <span class="o">[</span>alert] 12769#0: worker process 12770 exited with fatal code 2 and cannot be respawned
</code></pre></div></div>

<p>è§£å†³æ–¹æ¡ˆï¼š</p>

<p>å¤åˆ¶fastdfsä¸­çš„http.confã€mime.typesæ–‡ä»¶åˆ°/etc/fdfs</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cp</span> /usr/local/fastdfs-5.05/conf/http.conf /usr/local/fastdfs-5.05/conf/mime.types  /etc/fdfs
</code></pre></div></div>

<p>ç„¶åé‡å¯nginx</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>killall nginx
/usr/local/nginx/sbin/nginx
</code></pre></div></div>

<p>æŸ¥çœ‹æ—¥å¿—ï¼Œè¿˜æŠ¥é”™ï¼š</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@localhost logs]# <span class="nb">cat</span> /usr/local/nginx/logs/error.log
ngx_http_fastdfs_process_init <span class="nv">pid</span><span class="o">=</span>12813
<span class="o">[</span>2017-10-10 14:05:33] ERROR - file: /usr/local/fastdfs-nginx-module/src/common.c, line: 180, config file: /etc/fdfs/mod_fastdfs.conf, you must <span class="nb">set </span>url_have_group_name to <span class="nb">true </span>to support multi-group!
2017/10/10 14:05:33 <span class="o">[</span>alert] 12812#0: worker process 12813 exited with fatal code 2 and cannot be respawned
</code></pre></div></div>

<p>è§£å†³æ–¹æ¡ˆï¼š</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim  /etc/fdfs/mod_fastdfs.conf
</code></pre></div></div>

<p>å°†</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">url_have_group_name</span><span class="o">=</span><span class="nb">false</span>
</code></pre></div></div>
<p>æ”¹ä¸º</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">url_have_group_name</span><span class="o">=</span><span class="nb">true</span> 
</code></pre></div></div>

<p>é‡å¯æ­£å¸¸</p>

<h3 id="æµ‹è¯•å›¾ç‰‡æ— æ³•è®¿é—®">æµ‹è¯•å›¾ç‰‡æ— æ³•è®¿é—®</h3>

<p>æ­å»ºå®Œæˆä¹‹åï¼Œè®¿é—®<code class="highlighter-rouge">http://192.168.53.85:8080/group2/M00/00/00/wKg26VncfamAEqZ0AAu-4Kcs3QI677.jpg</code>
åœ°å€å›¾ç‰‡æ€»æ˜¯æŠ¥404æ— æ³•æ‰¾åˆ°ï¼Œè·Ÿè¸ªåˆ°storageæœåŠ¡å™¨ï¼ŒæŸ¥çœ‹nginxçš„erroræ—¥å¿—å‘ç°å¦‚ä¸‹ï¼›</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ERROR - file: /usr/local/fastdfs-nginx-module/src/common.c, line: 877, <span class="nb">stat </span>file: /root/fastdfs/data/00/00/wKg1Wlnchn2AOo0kAAu-4Kcs3QI239.jpg fail, errno: 13, error info: Permission denied
</code></pre></div></div>

<p>åŸå› æ˜¯nginxå¯åŠ¨çš„æ—¶å€™é»˜è®¤ä¼šä»¥nobodyç”¨æˆ·æ¥å¯åŠ¨ï¼Œè¿™æ ·çš„è¯å°±æƒé™è®¿é—®<code class="highlighter-rouge">/root/fastdfs/data</code>çš„æƒé™</p>

<p>ä¿®æ”¹è¿™ä¸ªé—®é¢˜æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œç¬¬ä¸€ä¸ªæ–¹æ¡ˆè®¾ç½®nginxä»¥rootèº«ä»½å¯åŠ¨ï¼Œæˆ–è€…è®¾ç½®nobodyç”¨æˆ·æƒé™å¯ä»¥è®¿é—®<code class="highlighter-rouge">/root/fastdfs/data</code>åœ°å€ã€‚è¿™é‡Œåªå±•ç¤ºç¬¬ä¸€ç§æ–¹æ¡ˆçš„ä¿®æ”¹</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim /usr/local/nginx/conf/nginx.conf
<span class="c"># ä¿®æ”¹nobodyä¸ºroot</span>
user root
</code></pre></div></div>

<p>é‡å¯nginxåé—®é¢˜è§£å†³</p>

<p><strong>è¿™é‡Œæœ‰ä¸€ä¸ªç½‘å‹æ•´ç†çš„wordç‰ˆæœ¬çš„å®‰è£…é…ç½®æ–‡æ¡£ï¼ŒåŒ…æ‹¬ç¼“å­˜å„æ–¹é¢çš„å†…å®¹æ¯”è¾ƒå…¨é¢ï¼Œéœ€è¦çš„æœ‹å‹åœ¨å…¬ä¼—å·å›å¤ï¼šâ€œfastdfsâ€</strong></p>

<p>å‚è€ƒï¼š</p>

<p><a href="https://my.oschina.net/wangmengjun/blog/1142982">CentOSä¸Šå®‰è£…åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸFastDFS &amp; é…ç½®å’Œé—®é¢˜</a></p>
:ET