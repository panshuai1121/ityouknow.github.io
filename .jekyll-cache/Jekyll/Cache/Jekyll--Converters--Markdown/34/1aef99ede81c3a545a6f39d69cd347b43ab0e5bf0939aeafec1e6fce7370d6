I"æ8<p>Hystrix-dashboardæ˜¯ä¸€æ¬¾é’ˆå¯¹Hystrixè¿›è¡Œå®æ—¶ç›‘æ§çš„å·¥å…·ï¼Œé€šè¿‡Hystrix Dashboardæˆ‘ä»¬å¯ä»¥åœ¨ç›´è§‚åœ°çœ‹åˆ°å„Hystrix Commandçš„è¯·æ±‚å“åº”æ—¶é—´, è¯·æ±‚æˆåŠŸç‡ç­‰æ•°æ®ã€‚ä½†æ˜¯åªä½¿ç”¨Hystrix Dashboardçš„è¯, ä½ åªèƒ½çœ‹åˆ°å•ä¸ªåº”ç”¨å†…çš„æœåŠ¡ä¿¡æ¯, è¿™æ˜æ˜¾ä¸å¤Ÿ. æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå·¥å…·èƒ½è®©æˆ‘ä»¬æ±‡æ€»ç³»ç»Ÿå†…å¤šä¸ªæœåŠ¡çš„æ•°æ®å¹¶æ˜¾ç¤ºåˆ°Hystrix Dashboardä¸Š, è¿™ä¸ªå·¥å…·å°±æ˜¯Turbine.</p>

<h2 id="hystrix-dashboard">Hystrix Dashboard</h2>

<p>æˆ‘ä»¬åœ¨ç†”æ–­ç¤ºä¾‹é¡¹ç›®spring-cloud-consumer-hystrixçš„åŸºç¡€ä¸Šæ›´æ”¹ï¼Œé‡æ–°å‘½åä¸ºï¼šspring-cloud-consumer-hystrix-dashboardã€‚</p>

<h3 id="1æ·»åŠ ä¾èµ–">1ã€æ·»åŠ ä¾èµ–</h3>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
	<span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
	<span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-hystrix<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
	<span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
	<span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-hystrix-dashboard<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
	<span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
	<span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<p>è¿™ä¸‰ä¸ªåŒ…å¿…é¡»æ·»åŠ </p>

<h3 id="2å¯åŠ¨ç±»">2ã€å¯åŠ¨ç±»</h3>

<p>å¯åŠ¨ç±»æ·»åŠ å¯ç”¨Hystrix Dashboardå’Œç†”æ–­å™¨</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableDiscoveryClient</span>
<span class="nd">@EnableFeignClients</span>
<span class="nd">@EnableHystrixDashboard</span>
<span class="nd">@EnableCircuitBreaker</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConsumerApplication</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">ConsumerApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="3æµ‹è¯•">3ã€æµ‹è¯•</h3>

<p>å¯åŠ¨å·¥ç¨‹åè®¿é—® http://localhost:9001/hystrixï¼Œå°†ä¼šçœ‹åˆ°å¦‚ä¸‹ç•Œé¢ï¼š</p>

<p><img src="http://favorites.ren/assets/images/2017/springcloud/hystrix-dashboard-1.jpg" alt="" /></p>

<p>å›¾ä¸­ä¼šæœ‰ä¸€äº›æç¤ºï¼š</p>

<blockquote>
  <p>Cluster via Turbine (default cluster): http://turbine-hostname:port/turbine.stream <br />
Cluster via Turbine (custom cluster): http://turbine-hostname:port/turbine.stream?cluster=[clusterName]<br />
Single Hystrix App: http://hystrix-app:port/hystrix.stream</p>
</blockquote>

<p>å¤§æ¦‚æ„æ€å°±æ˜¯å¦‚æœæŸ¥çœ‹é»˜è®¤é›†ç¾¤ä½¿ç”¨ç¬¬ä¸€ä¸ªurl,æŸ¥çœ‹æŒ‡å®šé›†ç¾¤ä½¿ç”¨ç¬¬äºŒä¸ªurl,å•ä¸ªåº”ç”¨çš„ç›‘æ§ä½¿ç”¨æœ€åä¸€ä¸ªï¼Œæˆ‘ä»¬æš‚æ—¶åªæ¼”ç¤ºå•ä¸ªåº”ç”¨çš„æ‰€ä»¥åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥ï¼š
http://localhost:9001/hystrix.stream ï¼Œè¾“å…¥ä¹‹åç‚¹å‡» monitorï¼Œè¿›å…¥é¡µé¢ã€‚</p>

<p>å¦‚æœæ²¡æœ‰è¯·æ±‚ä¼šå…ˆæ˜¾ç¤º<code class="highlighter-rouge">Loading ...</code>ï¼Œè®¿é—®http://localhost:9001/hystrix.stream ä¹Ÿä¼šä¸æ–­çš„æ˜¾ç¤ºpingã€‚</p>

<p>è¯·æ±‚æœåŠ¡http://localhost:9001/hello/neoï¼Œå°±å¯ä»¥çœ‹åˆ°ç›‘æ§çš„æ•ˆæœäº†ï¼Œé¦–å…ˆè®¿é—®http://localhost:9001/hystrix.streamï¼Œæ˜¾ç¤ºå¦‚ä¸‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ping: 

data: {"type":...}

data: {"type":...}
</code></pre></div></div>

<p>è¯´æ˜å·²ç»è¿”å›äº†ç›‘æ§çš„å„é¡¹ç»“æœ</p>

<p>åˆ°ç›‘æ§é¡µé¢å°±ä¼šæ˜¾ç¤ºå¦‚ä¸‹å›¾ï¼š</p>

<p><img src="http://favorites.ren/assets/images/2017/springcloud/hystrix-dashboard-2.jpg" alt="" /></p>

<p>å…¶å®å°±æ˜¯http://localhost:9001/hystrix.streamè¿”å›ç»“æœçš„å›¾å½¢åŒ–æ˜¾ç¤ºï¼ŒHystrix Dashboard Wikiä¸Šè¯¦ç»†è¯´æ˜äº†å›¾ä¸Šæ¯ä¸ªæŒ‡æ ‡çš„å«ä¹‰ï¼Œå¦‚ä¸‹å›¾ï¼š</p>

<p><img src="http://favorites.ren/assets/images/2017/springcloud/hystrix-dashboard-3.png" alt="" /></p>

<p>åˆ°æ­¤å•ä¸ªåº”ç”¨çš„ç†”æ–­ç›‘æ§å·²ç»å®Œæˆã€‚</p>

<h2 id="turbine">Turbine</h2>

<p>åœ¨å¤æ‚çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç›¸åŒæœåŠ¡çš„èŠ‚ç‚¹ç»å¸¸éœ€è¦éƒ¨ç½²ä¸Šç™¾ç”šè‡³ä¸Šåƒä¸ªï¼Œå¾ˆå¤šæ—¶å€™ï¼Œè¿ç»´äººå‘˜å¸Œæœ›èƒ½å¤ŸæŠŠç›¸åŒæœåŠ¡çš„èŠ‚ç‚¹çŠ¶æ€ä»¥ä¸€ä¸ªæ•´ä½“é›†ç¾¤çš„å½¢å¼å±•ç°å‡ºæ¥ï¼Œè¿™æ ·å¯ä»¥æ›´å¥½çš„æŠŠæ¡æ•´ä¸ªç³»ç»Ÿçš„çŠ¶æ€ã€‚ ä¸ºæ­¤ï¼ŒNetflixæä¾›äº†ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼ˆTurbineï¼‰æ¥æä¾›æŠŠå¤šä¸ªhystrix.streamçš„å†…å®¹èšåˆä¸ºä¸€ä¸ªæ•°æ®æºä¾›Dashboardå±•ç¤ºã€‚</p>

<h3 id="1æ·»åŠ ä¾èµ–-1">1ã€æ·»åŠ ä¾èµ–</h3>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependencies&gt;</span>
	<span class="nt">&lt;dependency&gt;</span>
		<span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
		<span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-turbine<span class="nt">&lt;/artifactId&gt;</span>
	<span class="nt">&lt;/dependency&gt;</span>
	<span class="nt">&lt;dependency&gt;</span>
		<span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
		<span class="nt">&lt;artifactId&gt;</span>spring-cloud-netflix-turbine<span class="nt">&lt;/artifactId&gt;</span>
	<span class="nt">&lt;/dependency&gt;</span>
	<span class="nt">&lt;dependency&gt;</span>
		<span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
		<span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
	<span class="nt">&lt;/dependency&gt;</span>
	<span class="nt">&lt;dependency&gt;</span>
		<span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
		<span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-hystrix-dashboard<span class="nt">&lt;/artifactId&gt;</span>
	<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div></div>

<h3 id="2é…ç½®æ–‡ä»¶">2ã€é…ç½®æ–‡ä»¶</h3>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">spring.application.name</span><span class="p">=</span><span class="s">hystrix-dashboard-turbine</span>
<span class="py">server.port</span><span class="p">=</span><span class="s">8001</span>
<span class="py">turbine.appConfig</span><span class="p">=</span><span class="s">node01,node02</span>
<span class="py">turbine.aggregator.clusterConfig</span><span class="p">=</span> <span class="s">default</span>
<span class="py">turbine.clusterNameExpression</span><span class="p">=</span> <span class="s">new String("default")</span>

<span class="py">eureka.client.serviceUrl.defaultZone</span><span class="p">=</span><span class="s">http://localhost:8000/eureka/</span>
</code></pre></div></div>

<ul>
  <li><code class="highlighter-rouge">turbine.appConfig</code> ï¼šé…ç½®Eurekaä¸­çš„serviceIdåˆ—è¡¨ï¼Œè¡¨æ˜ç›‘æ§å“ªäº›æœåŠ¡</li>
  <li><code class="highlighter-rouge">turbine.aggregator.clusterConfig</code> ï¼šæŒ‡å®šèšåˆå“ªäº›é›†ç¾¤ï¼Œå¤šä¸ªä½¿ç”¨â€,â€åˆ†å‰²ï¼Œé»˜è®¤ä¸ºdefaultã€‚å¯ä½¿ç”¨<code class="highlighter-rouge">http://.../turbine.stream?cluster={clusterConfigä¹‹ä¸€}</code>è®¿é—®</li>
  <li><code class="highlighter-rouge">turbine.clusterNameExpression</code> ï¼š 1. clusterNameExpressionæŒ‡å®šé›†ç¾¤åç§°ï¼Œé»˜è®¤è¡¨è¾¾å¼appNameï¼›æ­¤æ—¶ï¼š<code class="highlighter-rouge">turbine.aggregator.clusterConfig</code>éœ€è¦é…ç½®æƒ³è¦ç›‘æ§çš„åº”ç”¨åç§°ï¼›2. å½“clusterNameExpression: defaultæ—¶ï¼Œ<code class="highlighter-rouge">turbine.aggregator.clusterConfig</code>å¯ä»¥ä¸å†™ï¼Œå› ä¸ºé»˜è®¤å°±æ˜¯defaultï¼›3. å½“clusterNameExpression: metadata[â€˜clusterâ€™]æ—¶ï¼Œå‡è®¾æƒ³è¦ç›‘æ§çš„åº”ç”¨é…ç½®äº†<code class="highlighter-rouge">eureka.instance.metadata-map.cluster: ABC</code>ï¼Œåˆ™éœ€è¦é…ç½®ï¼ŒåŒæ—¶<code class="highlighter-rouge">turbine.aggregator.clusterConfig: ABC</code></li>
</ul>

<h3 id="3å¯åŠ¨ç±»">3ã€å¯åŠ¨ç±»</h3>

<p>å¯åŠ¨ç±»æ·»åŠ <code class="highlighter-rouge">@EnableTurbine</code>ï¼Œæ¿€æ´»å¯¹Turbineçš„æ”¯æŒ</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableHystrixDashboard</span>
<span class="nd">@EnableTurbine</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DashboardApplication</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">DashboardApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
	<span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>åˆ°æ­¤Turbineï¼ˆhystrix-dashboard-turbineï¼‰é…ç½®å®Œæˆ</p>

<h3 id="4æµ‹è¯•">4ã€æµ‹è¯•</h3>

<p>åœ¨ç¤ºä¾‹é¡¹ç›®spring-cloud-consumer-hystrixåŸºç¡€ä¸Šä¿®æ”¹ä¸ºä¸¤ä¸ªæœåŠ¡çš„è°ƒç”¨è€…spring-cloud-consumer-node1å’Œspring-cloud-consumer-node2</p>

<p>spring-cloud-consumer-node1é¡¹ç›®æ”¹åŠ¨å¦‚ä¸‹ï¼š
application.propertiesæ–‡ä»¶å†…å®¹</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">spring.application.name</span><span class="p">=</span><span class="s">node01</span>
<span class="py">server.port</span><span class="p">=</span><span class="s">9001</span>
<span class="py">feign.hystrix.enabled</span><span class="p">=</span><span class="s">true</span>

<span class="py">eureka.client.serviceUrl.defaultZone</span><span class="p">=</span><span class="s">http://localhost:8000/eureka/</span>
</code></pre></div></div>

<p>spring-cloud-consumer-node2é¡¹ç›®æ”¹åŠ¨å¦‚ä¸‹ï¼š
application.propertiesæ–‡ä»¶å†…å®¹</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">spring.application.name</span><span class="p">=</span><span class="s">node02</span>
<span class="py">server.port</span><span class="p">=</span><span class="s">9002</span>
<span class="py">feign.hystrix.enabled</span><span class="p">=</span><span class="s">true</span>

<span class="py">eureka.client.serviceUrl.defaultZone</span><span class="p">=</span><span class="s">http://localhost:8000/eureka/</span>

</code></pre></div></div>

<p>HelloRemoteç±»ä¿®æ”¹ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@FeignClient</span><span class="o">(</span><span class="n">name</span><span class="o">=</span> <span class="s">"spring-cloud-producer2"</span><span class="o">,</span> <span class="n">fallback</span> <span class="o">=</span> <span class="nc">HelloRemoteHystrix</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">HelloRemote</span> <span class="o">{</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/hello"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">hello2</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"name"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">name</span><span class="o">);</span>

<span class="o">}</span>
</code></pre></div></div>

<p>å¯¹åº”çš„<code class="highlighter-rouge">HelloRemoteHystrix</code>å’Œ<code class="highlighter-rouge">ConsumerController</code>ç±»è·Ÿéšä¿®æ”¹ï¼Œå…·ä½“æŸ¥çœ‹ä»£ç </p>

<p>ä¿®æ”¹å®Œæ¯•åï¼Œä¾æ¬¡å¯åŠ¨spring-cloud-eurekaã€spring-cloud-consumer-node1ã€spring-cloud-consumer-node1ã€hystrix-dashboard-turbineï¼ˆTurbineï¼‰</p>

<p>æ‰“å¼€eurekaåå°å¯ä»¥çœ‹åˆ°æ³¨å†Œäº†ä¸‰ä¸ªæœåŠ¡ï¼š</p>

<p><img src="http://favorites.ren/assets/images/2017/springcloud/turbine-01.jpg" alt="" /></p>

<p>è®¿é—® http://localhost:8001/turbine.stream</p>

<p>è¿”å›ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>: ping
data: {"reportingHostsLast10Seconds":1,"name":"meta","type":"meta","timestamp":1494921985839}
</code></pre></div></div>

<p>å¹¶ä¸”ä¼šä¸æ–­åˆ·æ–°ä»¥è·å–å®æ—¶çš„ç›‘æ§æ•°æ®ï¼Œè¯´æ˜å’Œå•ä¸ªçš„ç›‘æ§ç±»ä¼¼ï¼Œè¿”å›ç›‘æ§é¡¹ç›®çš„ä¿¡æ¯ã€‚è¿›è¡Œå›¾å½¢åŒ–ç›‘æ§æŸ¥çœ‹ï¼Œè¾“å…¥ï¼šhttp://localhost:8001/hystrixï¼Œè¿”å›é…·é…·çš„å°ç†Šç•Œé¢ï¼Œè¾“å…¥ï¼š http://localhost:8001/turbine.streamï¼Œç„¶åç‚¹å‡» Monitor Stream ,å¯ä»¥çœ‹åˆ°å‡ºç°äº†ä¿©ä¸ªç›‘æ§åˆ—è¡¨</p>

<p><img src="http://favorites.ren/assets/images/2017/springcloud/turbine-02.jpg" alt="" /></p>

<p><strong><a href="https://github.com/ityouknow/spring-cloud-examples">ç¤ºä¾‹ä»£ç -github</a></strong></p>

<p><strong><a href="https://gitee.com/ityouknow/spring-cloud-examples">ç¤ºä¾‹ä»£ç -ç äº‘</a></strong></p>

<p>å‚è€ƒï¼š</p>

<p><a href="https://www.gitbook.com/book/eacdy/spring-cloud-book/details">ä½¿ç”¨Spring Cloudä¸Dockerå®æˆ˜å¾®æœåŠ¡</a></p>

<hr />
<p><strong>ä½œè€…ï¼šçº¯æ´çš„å¾®ç¬‘</strong><br />
<strong>å‡ºå¤„ï¼š<a href="http://www.ityouknow.com/springcloud/2017/05/18/hystrix-dashboard-turbine.html">http://www.ityouknow.com/</a></strong>    <br />
<strong>ç‰ˆæƒå½’ä½œè€…æ‰€æœ‰ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„</strong></p>
:ET