I"‘9<p>ä¸Šä¸€ç¯‡æ–‡ç« æˆ‘ä»¬ä»‹ç»äº†eurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒçš„æ­å»ºï¼Œè¿™ç¯‡æ–‡ç« ä»‹ç»ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨eurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œæ­å»ºä¸€ä¸ªç®€å•çš„æœåŠ¡ç«¯æ³¨å†ŒæœåŠ¡ï¼Œå®¢æˆ·ç«¯å»è°ƒç”¨æœåŠ¡ä½¿ç”¨çš„æ¡ˆä¾‹ã€‚</p>

<p>æ¡ˆä¾‹ä¸­æœ‰ä¸‰ä¸ªè§’è‰²ï¼šæœåŠ¡æ³¨å†Œä¸­å¿ƒã€æœåŠ¡æä¾›è€…ã€æœåŠ¡æ¶ˆè´¹è€…ï¼Œå…¶ä¸­æœåŠ¡æ³¨å†Œä¸­å¿ƒå°±æ˜¯æˆ‘ä»¬ä¸Šä¸€ç¯‡çš„eurekaå•æœºç‰ˆå¯åŠ¨æ—¢å¯ï¼Œæµç¨‹æ˜¯é¦–å…ˆå¯åŠ¨æ³¨å†Œä¸­å¿ƒï¼ŒæœåŠ¡æä¾›è€…ç”Ÿäº§æœåŠ¡å¹¶æ³¨å†Œåˆ°æœåŠ¡ä¸­å¿ƒä¸­ï¼Œæ¶ˆè´¹è€…ä»æœåŠ¡ä¸­å¿ƒä¸­è·å–æœåŠ¡å¹¶æ‰§è¡Œã€‚</p>

<h2 id="æœåŠ¡æä¾›">æœåŠ¡æä¾›</h2>

<p>æˆ‘ä»¬å‡è®¾æœåŠ¡æä¾›è€…æœ‰ä¸€ä¸ªhelloæ–¹æ³•ï¼Œå¯ä»¥æ ¹æ®ä¼ å…¥çš„å‚æ•°ï¼Œæä¾›è¾“å‡ºâ€œhello  xxxï¼Œthis is first messgeâ€çš„æœåŠ¡</p>

<h3 id="1pomåŒ…é…ç½®">1ã€pomåŒ…é…ç½®</h3>

<p>åˆ›å»ºä¸€ä¸ªspringbooté¡¹ç›®ï¼Œpom.xmlä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependencies&gt;</span>
	<span class="nt">&lt;dependency&gt;</span>
		<span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
		<span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-eureka<span class="nt">&lt;/artifactId&gt;</span>
	<span class="nt">&lt;/dependency&gt;</span>
	<span class="nt">&lt;dependency&gt;</span>
		<span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
		<span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
		<span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
	<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div></div>

<h3 id="2é…ç½®æ–‡ä»¶">2ã€é…ç½®æ–‡ä»¶</h3>

<p>application.propertiesé…ç½®å¦‚ä¸‹ï¼š</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">spring.application.name</span><span class="p">=</span><span class="s">spring-cloud-producer</span>
<span class="py">server.port</span><span class="p">=</span><span class="s">9000</span>
<span class="py">eureka.client.serviceUrl.defaultZone</span><span class="p">=</span><span class="s">http://localhost:8000/eureka/</span>
</code></pre></div></div>

<p>å‚æ•°åœ¨ä¸Šä¸€ç¯‡éƒ½å·²ç»è§£é‡Šè¿‡ï¼Œè¿™é‡Œä¸å¤šè¯´ã€‚</p>

<h3 id="3å¯åŠ¨ç±»">3ã€å¯åŠ¨ç±»</h3>

<p>å¯åŠ¨ç±»ä¸­æ·»åŠ <code class="highlighter-rouge">@EnableDiscoveryClient</code>æ³¨è§£</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableDiscoveryClient</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProducerApplication</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">ProducerApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="4controller">4ã€controller</h3>

<p>æä¾›helloæœåŠ¡</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloController</span> <span class="o">{</span>
	
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/hello"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">index</span><span class="o">(</span><span class="nd">@RequestParam</span> <span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"hello "</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s">"ï¼Œthis is first messge"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>æ·»åŠ <code class="highlighter-rouge">@EnableDiscoveryClient</code>æ³¨è§£åï¼Œé¡¹ç›®å°±å…·æœ‰äº†æœåŠ¡æ³¨å†Œçš„åŠŸèƒ½ã€‚å¯åŠ¨å·¥ç¨‹åï¼Œå°±å¯ä»¥åœ¨æ³¨å†Œä¸­å¿ƒçš„é¡µé¢çœ‹åˆ°SPRING-CLOUD-PRODUCERæœåŠ¡ã€‚</p>

<p><img src="http://favorites.ren/assets/images/2017/springcloud/eureka_server.png" alt="" /></p>

<p>åˆ°æ­¤æœåŠ¡æä¾›è€…é…ç½®å°±å®Œæˆäº†ã€‚</p>

<h2 id="æœåŠ¡è°ƒç”¨">æœåŠ¡è°ƒç”¨</h2>

<h3 id="1pomåŒ…é…ç½®-1">1ã€pomåŒ…é…ç½®</h3>

<p>å’ŒæœåŠ¡æä¾›è€…ä¸€è‡´</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependencies&gt;</span>
	<span class="nt">&lt;dependency&gt;</span>
		<span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
		<span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-eureka<span class="nt">&lt;/artifactId&gt;</span>
	<span class="nt">&lt;/dependency&gt;</span>
	<span class="nt">&lt;dependency&gt;</span>
		<span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
		<span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
		<span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
	<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div></div>

<h3 id="2é…ç½®æ–‡ä»¶-1">2ã€é…ç½®æ–‡ä»¶</h3>

<p>application.propertiesé…ç½®å¦‚ä¸‹ï¼š</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">spring.application.name</span><span class="p">=</span><span class="s">spring-cloud-consumer</span>
<span class="py">server.port</span><span class="p">=</span><span class="s">9001</span>
<span class="py">eureka.client.serviceUrl.defaultZone</span><span class="p">=</span><span class="s">http://localhost:8000/eureka/</span>
</code></pre></div></div>

<h3 id="3å¯åŠ¨ç±»-1">3ã€å¯åŠ¨ç±»</h3>

<p>å¯åŠ¨ç±»æ·»åŠ <code class="highlighter-rouge">@EnableDiscoveryClient</code>å’Œ<code class="highlighter-rouge">@EnableFeignClients</code>æ³¨è§£ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableDiscoveryClient</span>
<span class="nd">@EnableFeignClients</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConsumerApplication</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">ConsumerApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
	<span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li><code class="highlighter-rouge">@EnableDiscoveryClient</code> :å¯ç”¨æœåŠ¡æ³¨å†Œä¸å‘ç°</li>
  <li><code class="highlighter-rouge">@EnableFeignClients</code>ï¼šå¯ç”¨feignè¿›è¡Œè¿œç¨‹è°ƒç”¨</li>
</ul>

<blockquote>
  <p>Feignæ˜¯ä¸€ä¸ªå£°æ˜å¼Web Serviceå®¢æˆ·ç«¯ã€‚ä½¿ç”¨Feignèƒ½è®©ç¼–å†™Web Serviceå®¢æˆ·ç«¯æ›´åŠ ç®€å•, å®ƒçš„ä½¿ç”¨æ–¹æ³•æ˜¯å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œç„¶ååœ¨ä¸Šé¢æ·»åŠ æ³¨è§£ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒJAX-RSæ ‡å‡†çš„æ³¨è§£ã€‚Feignä¹Ÿæ”¯æŒå¯æ‹”æ’å¼çš„ç¼–ç å™¨å’Œè§£ç å™¨ã€‚Spring Cloudå¯¹Feignè¿›è¡Œäº†å°è£…ï¼Œä½¿å…¶æ”¯æŒäº†Spring MVCæ ‡å‡†æ³¨è§£å’ŒHttpMessageConvertersã€‚Feignå¯ä»¥ä¸Eurekaå’ŒRibbonç»„åˆä½¿ç”¨ä»¥æ”¯æŒè´Ÿè½½å‡è¡¡ã€‚</p>
</blockquote>

<h3 id="4feignè°ƒç”¨å®ç°">4ã€feignè°ƒç”¨å®ç°</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@FeignClient</span><span class="o">(</span><span class="n">name</span><span class="o">=</span> <span class="s">"spring-cloud-producer"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">HelloRemote</span> <span class="o">{</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/hello"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">hello</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"name"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">name</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>name:è¿œç¨‹æœåŠ¡åï¼ŒåŠspring.application.nameé…ç½®çš„åç§°</li>
</ul>

<p>æ­¤ç±»ä¸­çš„æ–¹æ³•å’Œè¿œç¨‹æœåŠ¡ä¸­contollerä¸­çš„æ–¹æ³•åå’Œå‚æ•°éœ€ä¿æŒä¸€è‡´ã€‚</p>

<h3 id="5webå±‚è°ƒç”¨è¿œç¨‹æœåŠ¡">5ã€webå±‚è°ƒç”¨è¿œç¨‹æœåŠ¡</h3>

<p>å°†HelloRemoteæ³¨å…¥åˆ°controllerå±‚ï¼Œåƒæ™®é€šæ–¹æ³•ä¸€æ ·å»è°ƒç”¨å³å¯ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConsumerController</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="nc">HelloRemote</span> <span class="nc">HelloRemote</span><span class="o">;</span>
	
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/hello/{name}"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">index</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">HelloRemote</span><span class="o">.</span><span class="na">hello</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>åˆ°æ­¤ï¼Œæœ€ç®€å•çš„ä¸€ä¸ªæœåŠ¡æ³¨å†Œä¸è°ƒç”¨çš„ä¾‹å­å°±å®Œæˆäº†ã€‚</p>

<h2 id="æµ‹è¯•">æµ‹è¯•</h2>

<h3 id="ç®€å•è°ƒç”¨">ç®€å•è°ƒç”¨</h3>
<p>ä¾æ¬¡å¯åŠ¨spring-cloud-eurekaã€spring-cloud-producerã€spring-cloud-consumerä¸‰ä¸ªé¡¹ç›®</p>

<p>å…ˆè¾“å…¥ï¼š<code class="highlighter-rouge">http://localhost:9000/hello?name=neo</code> æ£€æŸ¥spring-cloud-produceræœåŠ¡æ˜¯å¦æ­£å¸¸</p>

<p>è¿”å›ï¼š<code class="highlighter-rouge">hello neoï¼Œthis is first messge</code></p>

<p>è¯´æ˜spring-cloud-produceræ­£å¸¸å¯åŠ¨ï¼Œæä¾›çš„æœåŠ¡ä¹Ÿæ­£å¸¸ã€‚</p>

<p>æµè§ˆå™¨ä¸­è¾“å…¥ï¼š<code class="highlighter-rouge">http://localhost:9001/hello/neo</code></p>

<p>è¿”å›ï¼š<code class="highlighter-rouge">hello neoï¼Œthis is first messge</code></p>

<p>è¯´æ˜å®¢æˆ·ç«¯å·²ç»æˆåŠŸçš„é€šè¿‡feignè°ƒç”¨äº†è¿œç¨‹æœåŠ¡helloï¼Œå¹¶ä¸”å°†ç»“æœè¿”å›åˆ°äº†æµè§ˆå™¨ã€‚</p>

<h3 id="è´Ÿè½½å‡è¡¡">è´Ÿè½½å‡è¡¡</h3>

<p>ä»¥ä¸Šé¢spring-cloud-producerä¸ºä¾‹å­ä¿®æ”¹ï¼Œå°†å…¶ä¸­çš„controlleræ”¹åŠ¨å¦‚ä¸‹ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloController</span> <span class="o">{</span>
	
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/hello"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">index</span><span class="o">(</span><span class="nd">@RequestParam</span> <span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"hello "</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s">"ï¼Œthis is producer 2  send first messge"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>åœ¨é…ç½®æ–‡ä»¶ä¸­æ”¹åŠ¨ç«¯å£ï¼š</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">spring.application.name</span><span class="p">=</span><span class="s">spring-cloud-producer</span>
<span class="py">server.port</span><span class="p">=</span><span class="s">9003</span>
<span class="py">eureka.client.serviceUrl.defaultZone</span><span class="p">=</span><span class="s">http://localhost:8000/eureka/</span>
</code></pre></div></div>

<p>æ‰“åŒ…å¯åŠ¨åï¼Œåœ¨eurekaå°±ä¼šå‘ç°ä¸¤ä¸ªæœåŠ¡æä¾›è€…ï¼Œå¦‚ä¸‹å›¾ï¼š</p>

<p><img src="http://favorites.ren/assets/images/2017/springcloud/eureka_server2.png" alt="" /></p>

<p>ç„¶ååœ¨æµè§ˆå™¨å†æ¬¡è¾“å…¥ï¼š<code class="highlighter-rouge">http://localhost:9001/hello/neo</code>  è¿›è¡Œæµ‹è¯•ï¼š</p>

<p>ç¬¬ä¸€æ¬¡è¿”å›ç»“æœï¼š<code class="highlighter-rouge">hello neoï¼Œthis is first messge</code></p>

<p>ç¬¬äºŒæ¬¡è¿”å›ç»“æœï¼š<code class="highlighter-rouge">hello neoï¼Œthis is producer 2  send first messge</code></p>

<p>ä¸æ–­çš„è¿›è¡Œæµ‹è¯•ä¸‹å»ä¼šå‘ç°ä¸¤ç§ç»“æœäº¤æ›¿å‡ºç°ï¼Œè¯´æ˜ä¸¤ä¸ªæœåŠ¡ä¸­å¿ƒè‡ªåŠ¨æä¾›äº†æœåŠ¡å‡è¡¡è´Ÿè½½çš„åŠŸèƒ½ã€‚å¦‚æœæˆ‘ä»¬å°†æœåŠ¡æä¾›è€…çš„æ•°é‡åœ¨æé«˜ä¸ºNä¸ªï¼Œæµ‹è¯•ç»“æœä¸€æ ·ï¼Œè¯·æ±‚ä¼šè‡ªåŠ¨è½®è¯¢åˆ°æ¯ä¸ªæœåŠ¡ç«¯æ¥å¤„ç†ã€‚</p>

<p><strong><a href="https://github.com/ityouknow/spring-cloud-examples">ç¤ºä¾‹ä»£ç -github</a></strong></p>

<p><strong><a href="https://gitee.com/ityouknow/spring-cloud-examples">ç¤ºä¾‹ä»£ç -ç äº‘</a></strong></p>

<hr />

<p><strong>ä½œè€…ï¼šçº¯æ´çš„å¾®ç¬‘</strong><br />
<strong>å‡ºå¤„ï¼š<a href="http://www.ityouknow.com/springcloud/2017/05/12/eureka-provider-constomer.html">http://www.ityouknow.com/</a></strong>    <br />
<strong>ç‰ˆæƒå½’ä½œè€…æ‰€æœ‰ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„</strong></p>

:ET