I"Ä7<p>by æŸæŸç™½ç±³é¥­</p>

<h2 id="eventäº‹ä»¶">Event(äº‹ä»¶)</h2>

<p>Event æ˜¯ä¸€ä¸ªäº‹åŠ¡å¤„ç†çš„æœºåˆ¶ï¼Œç”¨äºé€šçŸ¥å¤šä¸ªå¼‚æ­¥ä»»åŠ¡æŸä¸ªäº‹ä»¶å·²ç»å‘ç”Ÿäº†ã€‚æ¯”å¦‚åœ¨äº¤é€šçº¢ç»¿ç¯ä¸­å¤šè¾†åœ¨è¡Œé©¶ä¸­çš„æ±½è½¦å¯ä»¥è¡¨ç¤ºæˆç¨‹åºä¸­çš„å¤šä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œçº¢ç»¿ç¯çš„äº®èµ·å¯ä»¥è¡¨ç¤ºæˆä¸€ä¸ªé€šçŸ¥ï¼Œçº¢ç¯é€šçŸ¥è¿™ä¸ªæ±½è½¦çš„è¡Œé©¶ä»»åŠ¡å¿…é¡»åœæ­¢äº†ï¼Œç»¿ç¯é€šçŸ¥è¿™ä¸ªæ±½è½¦çš„è¡Œé©¶ä»»åŠ¡å¯ä»¥ç»§ç»­é©¾é©¶äº†ã€‚
<!--more--></p>

<p>Event ç®¡ç†ç€ä¸€ä¸ªå…¨å±€çš„å†…éƒ¨æ ‡å¿— flagï¼Œè¯¥ flag é»˜è®¤ä¸º Falseï¼Œå½“ flag ç­‰äº False çš„æ—¶å€™ï¼Œè°ƒç”¨ wait() å‡½æ•°åç¨‹åºå°±ä¼šè¢«é˜»å¡ï¼Œåªæœ‰å½“ flag ç­‰äº True çš„æ—¶å€™ç¨‹åºæ‰ä¼šç»§ç»­æ‰§è¡Œã€‚åœ¨çº¢ç»¿ç¯ä¸­çº¢ç¯ç›¸å½“äº flag ç­‰äº False çš„æ—¶å€™è°ƒç”¨äº† wait() å‡½æ•°ï¼Œç»¿ç¯ç›¸å½“äº flag è¢«è®¾ç½®ä¸ºäº† Trueï¼Œæ±½è½¦å…è®¸é€šè¡Œï¼Œç¨‹åºè¢«å…è®¸æ‰§è¡Œ wait()ä¹‹åçš„ä»£ç ã€‚</p>

<h3 id="eventäº‹ä»¶å¯¹è±¡">Eventäº‹ä»¶å¯¹è±¡</h3>

<p>Event é€šè¿‡ threading æ¨¡å—çš„ Event() ç±»åˆ›å»ºå¯¹è±¡</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">event</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="n">Event</span><span class="p">()</span>
</code></pre></div></div>

<p>Event æ˜¯ä¸€ä¸ªä½é…ç‰ˆçš„ Conditionï¼Œåœ¨æºä»£ç  <strong>init</strong> å‡½æ•°ä¸­åˆ›å»ºäº† Condition å¯¹è±¡ï¼Œå¹¶å°† flag è®¾ç½®ä¸º False</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">_cond</span> <span class="o">=</span> <span class="n">Condition</span><span class="p">(</span><span class="n">Lock</span><span class="p">())</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">_flag</span> <span class="o">=</span> <span class="bp">False</span>
</code></pre></div></div>

<h3 id="å‡½æ•°">å‡½æ•°</h3>

<p>Event äº‹ä»¶ä¸­åªæœ‰4ä¸ªå‡½æ•°ï¼š</p>

<ol>
  <li>set(): å°† flag è®¾ä¸º Trueï¼Œé€šçŸ¥æ‰€æœ‰å¤„äºé˜»å¡çŠ¶æ€çš„çº¿ç¨‹æ¢å¤è¿è¡ŒçŠ¶æ€ã€‚</li>
  <li>clear(): å°† flag è®¾ä¸º Falseã€‚</li>
  <li>wait(timeout): å¦‚æœ flag ä¸º True å°†ç«‹å³è¿”å›ï¼Œå¦åˆ™çº¿ç¨‹å°†å¤„äºé˜»å¡çŠ¶æ€ï¼Œç­‰å¾…å…¶ä»–çº¿ç¨‹å°† flag è®¾ç½®ä¸º True</li>
  <li>isSet(): è·å– flag çš„çŠ¶æ€ï¼Œè¿”å› True æˆ– Falseã€‚</li>
</ol>

<h3 id="å®ä¾‹1">å®ä¾‹1</h3>

<p>ç”¨è¡Œé©¶ä¸­çš„æ±½è½¦ç¢°åˆ°çº¢ç»¿ç¯åšä¸€ä¸ªå®ä¾‹ï¼Œçº¢ç¯äº‹ä»¶æ±½è½¦åœæ­¢ä¸å…è®¸é€šè¡Œå¤„äºç­‰å¾…é˜»å¡çŠ¶æ€ï¼Œç»¿ç¯äº‹ä»¶æ±½è½¦è¿è¡Œé€šè¡Œå¤„äºæ¢å¤è¿è¡ŒçŠ¶æ€ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">event</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="n">Event</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">drive</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">print</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s">"æ­£åœ¨è¡Œé©¶ä¸­ï¼Œè¡Œé©¶äº†"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span> <span class="o">+</span> <span class="s">"Km"</span><span class="p">)</span>
        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">event</span><span class="p">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s">"é€šè¿‡äº†çº¢ç¯"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">sign</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"ç»¿ç¯åˆå§‹åŒ–"</span><span class="p">)</span>
    <span class="n">event</span><span class="p">.</span><span class="nb">set</span><span class="p">()</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="c1"># çº¢ç»¿ç¯åˆ‡æ¢æ—¶é—´ä¸º3ç§’
</span>        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">isSet</span><span class="p">():</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"çº¢ç¯äº®èµ·ï¼Œæ‰€æœ‰è¡Œé©¶ä¸­çš„è½¦è¾†ä¸å…è®¸é€šè¿‡"</span><span class="p">)</span>
            <span class="n">event</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"ç»¿ç¯äº®èµ·ï¼Œæ‰€æœ‰è¡Œé©¶ä¸­çš„è½¦è¾†å¿…é¡»é€šè¿‡"</span><span class="p">)</span>
            <span class="n">event</span><span class="p">.</span><span class="nb">set</span><span class="p">()</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>

    <span class="c1"># è®¾ç½®å…¬è·¯çº¿ç¨‹ç»„
</span>    <span class="n">highwayThreads</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># åˆ›å»ºæ±½è½¦æ–°çº¿ç¨‹
</span>    <span class="n">bmwCar</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span> <span class="o">=</span> <span class="n">drive</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="s">"BMWCar"</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">vwCar</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span> <span class="o">=</span> <span class="n">drive</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="s">"VWCar"</span><span class="p">,</span> <span class="p">))</span>

    <span class="c1"># å°†æ±½è½¦çº¿ç¨‹æ·»åŠ åˆ°å…¬è·¯çº¿ç¨‹ç»„
</span>    <span class="n">highwayThreads</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">bmwCar</span><span class="p">)</span>
    <span class="n">highwayThreads</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">vwCar</span><span class="p">)</span>

    <span class="c1"># æ±½è½¦å¯åŠ¨
</span>    <span class="k">for</span> <span class="n">thread</span> <span class="ow">in</span> <span class="n">highwayThreads</span><span class="p">:</span>
        <span class="n">thread</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>

    <span class="c1"># çº¢ç»¿ç¯å‘é€äº‹ä»¶é€šçŸ¥
</span>    <span class="n">sign</span><span class="p">()</span>
</code></pre></div></div>

<p>è¿è¡Œç»“æœï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ç»¿ç¯åˆå§‹åŒ–
BMWCaræ­£åœ¨è¡Œé©¶ä¸­ï¼Œè¡Œé©¶äº†60Km
VWCaræ­£åœ¨è¡Œé©¶ä¸­ï¼Œè¡Œé©¶äº†60Km
BMWCaré€šè¿‡äº†çº¢ç¯
BMWCaræ­£åœ¨è¡Œé©¶ä¸­ï¼Œè¡Œé©¶äº†120Km
VWCaré€šè¿‡äº†çº¢ç¯
VWCaræ­£åœ¨è¡Œé©¶ä¸­ï¼Œè¡Œé©¶äº†120Km
BMWCaré€šè¿‡äº†çº¢ç¯
BMWCaræ­£åœ¨è¡Œé©¶ä¸­ï¼Œè¡Œé©¶äº†180Km
VWCaré€šè¿‡äº†çº¢ç¯
VWCaræ­£åœ¨è¡Œé©¶ä¸­ï¼Œè¡Œé©¶äº†180Km
çº¢ç¯äº®èµ·ï¼Œæ‰€æœ‰è¡Œé©¶ä¸­çš„è½¦è¾†ä¸å…è®¸é€šè¿‡
ç»¿ç¯äº®èµ·ï¼Œæ‰€æœ‰è¡Œé©¶ä¸­çš„è½¦è¾†å¿…é¡»é€šè¿‡
VWCaré€šè¿‡äº†çº¢ç¯
VWCaræ­£åœ¨è¡Œé©¶ä¸­ï¼Œè¡Œé©¶äº†240Km
BMWCaré€šè¿‡äº†çº¢ç¯
BMWCaræ­£åœ¨è¡Œé©¶ä¸­ï¼Œè¡Œé©¶äº†240Km
VWCaré€šè¿‡äº†çº¢ç¯
VWCaræ­£åœ¨è¡Œé©¶ä¸­ï¼Œè¡Œé©¶äº†300Km
BMWCaré€šè¿‡äº†çº¢ç¯
BMWCaræ­£åœ¨è¡Œé©¶ä¸­ï¼Œè¡Œé©¶äº†300Km
VWCaré€šè¿‡äº†çº¢ç¯
VWCaræ­£åœ¨è¡Œé©¶ä¸­ï¼Œè¡Œé©¶äº†360Km
BMWCaré€šè¿‡äº†çº¢ç¯
BMWCaræ­£åœ¨è¡Œé©¶ä¸­ï¼Œè¡Œé©¶äº†360Km
çº¢ç¯äº®èµ·ï¼Œæ‰€æœ‰è¡Œé©¶ä¸­çš„è½¦è¾†ä¸å…è®¸é€šè¿‡
ç»¿ç¯äº®èµ·ï¼Œæ‰€æœ‰è¡Œé©¶ä¸­çš„è½¦è¾†å¿…é¡»é€šè¿‡
VWCaré€šè¿‡äº†çº¢ç¯
VWCaræ­£åœ¨è¡Œé©¶ä¸­ï¼Œè¡Œé©¶äº†420Km
BMWCaré€šè¿‡äº†çº¢ç¯
</code></pre></div></div>

<h3 id="å®ä¾‹2">å®ä¾‹2</h3>

<p>é¢è¯•é¢˜ï¼šæœ‰ä¸¤ä¸ªçº¿ç¨‹ Aã€Bï¼ŒA çº¿ç¨‹æ‰“å° a,b,c çš„å­—æ¯ï¼ŒBçº¿ç¨‹æ‰“å° 2,4,6 çš„æ•°å­—ï¼ŒAã€B çº¿ç¨‹å°†è½®è¯¢æ‰“å°ï¼Œå¦‚ï¼ša2 b4 c6â€¦</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Event</span>


<span class="c1"># æ‰“å°å­—æ¯å‡½æ•°
</span><span class="k">def</span> <span class="nf">printLetter</span><span class="p">(</span><span class="n">letterEvent</span><span class="p">,</span> <span class="n">numEvent</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span><span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">,</span> <span class="s">"c"</span><span class="p">]:</span>
        <span class="n">letterEvent</span><span class="p">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
        <span class="n">letterEvent</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">numEvent</span><span class="p">.</span><span class="nb">set</span><span class="p">()</span>


<span class="c1"># æ‰“å°æ•°å­—å‡½æ•°
</span><span class="k">def</span> <span class="nf">printNum</span><span class="p">(</span><span class="n">numEvent</span><span class="p">,</span> <span class="n">letterEvent</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">]:</span>
        <span class="n">numEvent</span><span class="p">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">" "</span><span class="p">)</span>
        <span class="n">numEvent</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">letterEvent</span><span class="p">.</span><span class="nb">set</span><span class="p">()</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">letterEvent</span><span class="p">,</span> <span class="n">numEvent</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(),</span> <span class="n">Event</span><span class="p">()</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span> <span class="o">=</span> <span class="n">printLetter</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">letterEvent</span><span class="p">,</span> <span class="n">numEvent</span><span class="p">))</span>
    <span class="n">t2</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span> <span class="o">=</span> <span class="n">printNum</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">numEvent</span><span class="p">,</span> <span class="n">letterEvent</span><span class="p">))</span>

    <span class="n">threads</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">threads</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span>
    <span class="n">threads</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">t2</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">:</span>
        <span class="n">t</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>

    <span class="n">letterEvent</span><span class="p">.</span><span class="nb">set</span><span class="p">()</span>
</code></pre></div></div>

<p>è¿è¡Œç»“æœï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">a2</span> <span class="n">b4</span> <span class="n">c6</span>
</code></pre></div></div>

<h2 id="æ€»ç»“">æ€»ç»“</h2>

<p>æœ¬èŠ‚ä»‹ç»äº†å¤šçº¿ç¨‹çš„ Event äº‹ä»¶ï¼Œå®ƒåªæœ‰4ä¸ªå‡½æ•°ï¼šset()ã€clear()ã€wait(timeout) å’Œ isSet() ï¼Œå¤§å®¶ä¸€å®šä¼šå¾ˆå¿«æŒæ¡çš„ã€‚</p>

<blockquote>
  <p>ç¤ºä¾‹ä»£ç ï¼šhttps://github.com/JustDoPython/python-100-day/tree/master/day-054</p>
</blockquote>
:ET