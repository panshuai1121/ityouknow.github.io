I"éU<p>by æˆ´æ™¯æ³¢</p>

<h2 id="scrapy-æ¡†æ¶å®ç°çˆ¬è™«çš„åŸºæœ¬åŸç†">Scrapy æ¡†æ¶å®ç°çˆ¬è™«çš„åŸºæœ¬åŸç†</h2>

<p>Scrapy å°±æ˜¯å°è£…å¥½çš„æ¡†æ¶ï¼Œä½ å¯ä»¥ä¸“å¿ƒç¼–å†™çˆ¬è™«çš„æ ¸å¿ƒé€»è¾‘ï¼Œæ— éœ€è‡ªå·±ç¼–å†™ä¸çˆ¬è™«é€»è¾‘æ— å…³çš„ä»£ç ï¼Œå¥—ç”¨è¿™ä¸ªæ¡†æ¶å°±å¯ä»¥å®ç°ä»¥ä¸ŠåŠŸèƒ½â€”â€”çˆ¬å–åˆ°æƒ³è¦çš„æ•°æ®ã€‚</p>

<p>Scrapyæ˜¯ä¸€ä¸ªPythonå®ç°çš„è½»é‡çº§çˆ¬è™«æ¡†æ¶ï¼Œå®ƒå€ŸåŠ©Twistedå®ç°å¼‚æ­¥æŠ“å–ã€‚</p>

<p>Scrapy æ˜¯ä¸€ä¸ªä¸ºäº†çˆ¬å–ç½‘ç«™æ•°æ®ï¼Œæå–ç»“æ„æ€§æ•°æ®è€Œç¼–å†™çš„åº”ç”¨æ¡†æ¶ã€‚ å¯ä»¥åº”ç”¨åœ¨åŒ…æ‹¬æ•°æ®æŒ–æ˜ï¼Œä¿¡æ¯å¤„ç†æˆ–å­˜å‚¨å†å²æ•°æ®ç­‰ä¸€ç³»åˆ—çš„ç¨‹åºä¸­ã€‚</p>

<p>æœ¬æ–‡æ¡£å°†é€šè¿‡ä»‹ç»ScrapyèƒŒåçš„æ¦‚å¿µä½¿æ‚¨å¯¹å…¶å·¥ä½œåŸç†æœ‰æ‰€äº†è§£ï¼Œå¦‚æœæš‚æ—¶ç†è§£ä¸æ·±ä¹Ÿæ²¡å…³ç³»ï¼Œåè¾¹ä¼šç»“åˆå®ä¾‹å…·ä½“ä»‹ç»ã€‚</p>

<!--more-->

<h2 id="python-çˆ¬è™«åŸºæœ¬æµç¨‹">Python çˆ¬è™«åŸºæœ¬æµç¨‹</h2>

<h2 id="a-å‘èµ·è¯·æ±‚b-è§£æå†…å®¹c-è·å–å“åº”å†…å®¹d-ä¿å­˜æ•°æ®">A å‘èµ·è¯·æ±‚â€”â€”â€”B è§£æå†…å®¹â€”â€”â€”C è·å–å“åº”å†…å®¹â€”â€”â€”D ä¿å­˜æ•°æ®</h2>

<p>A é€šè¿‡ HTTP å‘ç›®æ ‡ç«™ç‚¹å‘èµ·è¯·æ±‚ï¼Œå³å‘é€ä¸€ä¸ª Request ï¼Œè¯·æ±‚å¯ä»¥åŒ…å«é¢å¤–çš„ headers ç­‰ä¿¡æ¯ï¼Œç­‰å¾…æœåŠ¡å™¨å“åº”ã€‚</p>

<p>B å¾—åˆ°çš„å†…å®¹å¯èƒ½æ˜¯ HTML ï¼Œå¯ä»¥ç”¨æ­£åˆ™è¡¨è¾¾å¼ã€ç½‘é¡µè§£æåº“è¿›è¡Œè§£æã€‚å¯èƒ½æ˜¯ Json ï¼Œå¯ä»¥ç›´æ¥è½¬ä¸º Json å¯¹è±¡è§£æï¼Œå¯èƒ½æ˜¯äºŒè¿›åˆ¶æ•°æ®ï¼Œå¯ä»¥åšä¿å­˜æˆ–è€…è¿›ä¸€æ­¥çš„å¤„ç†ã€‚</p>

<p>C å¦‚æœæœåŠ¡å™¨èƒ½æ­£å¸¸å“åº”ï¼Œä¼šå¾—åˆ°ä¸€ä¸ª Response ï¼Œ Response çš„å†…å®¹ä¾¿æ˜¯æ‰€è¦è·å–çš„é¡µé¢å†…å®¹ï¼Œç±»å‹å¯èƒ½æœ‰ HTML ï¼Œ Json å­—ç¬¦ä¸²ï¼ŒäºŒè¿›åˆ¶æ•°æ®ï¼ˆå¦‚å›¾ç‰‡è§†é¢‘ï¼‰ç­‰ç±»å‹ã€‚</p>

<p>D ä¿å­˜å½¢å¼å¤šæ ·ï¼Œå¯ä»¥å­˜ä¸ºæ–‡æœ¬ï¼Œä¹Ÿå¯ä»¥ä¿å­˜è‡³æ•°æ®åº“ï¼Œæˆ–è€…ä¿å­˜ç‰¹å®šæ ¼å¼çš„æ–‡ä»¶ã€‚</p>

<p>æ­å»ºè‡ªå·±æœ¬æœºç¯å¢ƒå¦‚ä¸‹ï¼šWindows7 64bitâ€”â€”â€”Python3.7â€”â€”â€”Pycharm64</p>

<h2 id="å®‰è£…-pythonå®‰è£…-pycharmå®‰è£…-scrapyæ–°å»ºçˆ¬è™«é¡¹ç›®">å®‰è£… Pythonâ€”â€”â€”å®‰è£… Pycharmâ€”â€”â€”å®‰è£… Scrapyâ€”â€”â€”æ–°å»ºçˆ¬è™«é¡¹ç›®</h2>

<p>ç®€å•è§£é‡Šï¼šå°† Python æ¯”ä½œ Java ï¼Œé‚£ä¹ˆ Pycharm å°±ç›¸å½“äº eclipse ï¼Œ Pycharm å°±æ˜¯ Python è¯­è¨€çš„è¿è¡Œç¯å¢ƒ IDE å·¥å…·ã€‚</p>

<h2 id="å®‰è£…-python">å®‰è£… Python</h2>

<p>åœ¨ Python çš„å®˜ç½‘ www.python.org ä¸­æ‰¾åˆ°æœ€æ–°ç‰ˆæœ¬çš„ Python å®‰è£…åŒ…ï¼Œç‚¹å‡»è¿›è¡Œä¸‹è½½ï¼Œè¯·æ³¨æ„ï¼Œå½“ä½ çš„ç”µè„‘æ˜¯32ä½çš„æœºå™¨ï¼Œè¯·é€‰æ‹©32ä½çš„å®‰è£…åŒ…ï¼Œå¦‚æœæ˜¯64ä½çš„ï¼Œè¯·é€‰æ‹©64ä½çš„å®‰è£…åŒ…ï¼›</p>

<p>æˆ‘è‡ªå·±æœºå™¨æ˜¯ win7 64bit æ‰€ä»¥æˆ‘ä¸‹è½½çš„æ˜¯ python-3.7.4.amd64.exeï¼Œå…¶ä¸­çš„ add python 3.7 to PATH ä¸€å®šè¦å‹¾é€‰ã€‚</p>

<p>å¦å¤–å®‰è£… python è·¯å¾„ä¸è¦æœ‰ä¸­æ–‡å’Œç©ºæ ¼ï¼Œé¿å…ä»¥åéº»çƒ¦ã€‚åè¾¹å°±ç‚¹å‡»ä¸‹ä¸€æ­¥å³å¯ã€‚</p>

<p>å¦‚æœå¿˜è®°å‹¾é€‰åˆ™éœ€è¦æ‰‹åŠ¨æ·»åŠ ç¯å¢ƒå˜é‡ï¼šï¼ˆéœ€è¦æ·»åŠ ä¸¤ä¸ªï¼š c:\python3.7.0;c:\python3.7.0\Scriptsï¼‰</p>

<p>å³é”®è®¡ç®—æœºâ€”â€”ç‚¹å‡»å±æ€§â€”â€”ç‚¹å‡»é«˜çº§ç³»ç»Ÿè®¾ç½®â€”â€”é«˜çº§â€”â€”ç¯å¢ƒå˜é‡â€”â€”ç”¨æˆ·å˜é‡â€”â€”PATH  æ·»åŠ è‡ªå·±å®‰è£… python çš„è·¯å¾„ã€‚</p>

<h2 id="å®‰è£…-pycharm">å®‰è£… Pycharm</h2>

<p>æœ¬ç¯‡å¯¹äºç¯å¢ƒçš„æ­å»ºåªæ˜¯èµ·åˆ°æŠ›ç –å¼•ç‰çš„ä½œç”¨ï¼Œå»ºè®®å¤§å®¶ä»¥ä¸‹è¾¹åšå‚è€ƒã€‚</p>

<p>https://www.runoob.com/w3cnote/pycharm-windows-install.html</p>

<h2 id="å®‰è£…-scrapy">å®‰è£… Scrapy</h2>

<p>ç”±äºå®‰è£… Scrapy ä¸æ˜¯æœ¬ç³»åˆ—é‡ç‚¹ï¼Œæ‰€ä»¥ä»…å±•ç¤º Windows ç³»ç»Ÿä¸Šå®‰è£… Scrapy çš„æ­¥éª¤ã€‚æ³¨æ„ï¼šä¸€å®šæŒ‰é¡ºåºå®‰è£…ã€‚ Cmd è¿›å…¥ dos çª—å£ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Users\Administrator&gt;python
Python 3.7.0 (v3.7.0:1bf9cc5093, Jun 27 2018, 04:59:51) [MSC v.1914 64 bit (AMD64)] on win32
Type "help", "copyright", "credits" or "license" for more information.
C:\Users\Administrator&gt;python -m pip -V
pip 19.0.3 from c:\python3.7.0\lib\site-packages\pip (python 3.7)  
1.python -m pip install --upgrade pip
2.python -m pip install Twisted-18.9.0-cp37-cp37m-win_amd64.whl
3.python -m pip install pypiwin32
4.python -m pip install scrapy
5.python -m pip install requests
</code></pre></div></div>

<p>å¦‚æœä¸­é€”å®‰è£…é‡åˆ°é—®é¢˜è¯·åŠæ—¶ Google æŸ¥é˜…èµ„æ–™ï¼ŒæŸ¥é˜…å°±æ˜¯ç§¯ç´¯çš„è¿‡ç¨‹ã€‚</p>

<h2 id="scrapy-åˆ›å»ºæ–°é¡¹ç›®">Scrapy åˆ›å»ºæ–°é¡¹ç›®ï¼š</h2>

<p>Pycharm ä¸­ç”¨ alt+F12 åˆ‡æ¢åˆ°å‘½ä»¤è¡Œï¼Œåœ¨å‘½ä»¤è¡Œè¾“å…¥ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">venv2</span><span class="p">)</span> <span class="n">E</span><span class="p">:</span>\<span class="o">&gt;</span><span class="n">scrapy</span> <span class="n">startproject</span> <span class="n">peilv</span>
</code></pre></div></div>

<p>å°±ä¼šç”Ÿæˆ Scrapy é¡¹ç›®ï¼Œé¡¹ç›®åç§°æ˜¯ peilv ï¼Œç»“æ„å¦‚ä¸‹ï¼šä¸»è¦æ”¹å†™2ä¸ªæ–‡ä»¶ï¼šâ€œitemsã€settingsâ€ï¼Œæ–°å¢2ä¸ªæ–‡ä»¶ï¼šâ€œçˆ¬è™«ä¸»ç¨‹åºâ€ã€itemcsvexporterã€‚</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>peilv
scrapy.cfg                     #åˆ›å»ºé¡¹ç›®æ—¶è‡ªåŠ¨ç”Ÿæˆï¼Œé¡¹ç›®çš„é…ç½®æ–‡ä»¶
peilv/
    __init__.py                #åˆ›å»ºé¡¹ç›®æ—¶è‡ªåŠ¨ç”Ÿæˆï¼Œæ— éœ€ä»»ä½•æ”¹åŠ¨
    items.py                   #åˆ›å»ºé¡¹ç›®æ—¶è‡ªåŠ¨ç”Ÿæˆï¼Œå®šä¹‰çˆ¬å–çš„å­—æ®µ    
    pipelines.py               #åˆ›å»ºé¡¹ç›®æ—¶è‡ªåŠ¨ç”Ÿæˆï¼Œå¦‚å­˜å…¥æ–‡ä»¶ï¼Œæ— éœ€ä»»ä½•æ”¹åŠ¨    
    settings.py                #åˆ›å»ºé¡¹ç›®æ—¶è‡ªåŠ¨ç”Ÿæˆï¼Œå°†çˆ¬å–å­—æ®µæŒ‰é¡ºåºè¾“å‡º    
    middlewares.py             #åˆ›å»ºé¡¹ç›®æ—¶è‡ªåŠ¨ç”Ÿæˆï¼Œæ— éœ€ä»»ä½•æ”¹åŠ¨    
    spiders/   
        __init__.py            #åˆ›å»ºé¡¹ç›®æ—¶è‡ªåŠ¨ç”Ÿæˆï¼Œæ— éœ€ä»»ä½•æ”¹åŠ¨	
	itemcsvexporter.py     #éœ€è‡ªå·±ç¼–å†™ï¼Œä»£ç å›ºå®š	
        çˆ¬è™«ä¸»ç¨‹åº.py           #éœ€è‡ªå·±ç¼–å†™ï¼Œçˆ¬è™«çš„ä¸»ç¨‹åº
</code></pre></div></div>

<h2 id="itemspy">items.pyï¼š</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## -*- coding: utf-8 -*-
</span><span class="kn">import</span> <span class="nn">scrapy</span>
<span class="k">class</span> <span class="nc">PeilvItem</span><span class="p">(</span><span class="n">scrapy</span><span class="p">.</span><span class="n">Item</span><span class="p">):</span>
    <span class="c1"># define the fields for your item here like:
</span>    <span class="n">cc</span>  <span class="o">=</span> <span class="n">scrapy</span><span class="p">.</span><span class="n">Field</span><span class="p">()</span><span class="c1">#changci
</span>    <span class="n">li</span> <span class="o">=</span>  <span class="n">scrapy</span><span class="p">.</span><span class="n">Field</span><span class="p">()</span><span class="c1">#libo
</span>    <span class="n">b5</span>  <span class="o">=</span> <span class="n">scrapy</span><span class="p">.</span><span class="n">Field</span><span class="p">()</span><span class="c1">#bet365
</span></code></pre></div></div>

<p>ä»¥ä¸Šæ˜¯å®šä¹‰æ‚¨æƒ³æŠ“å–çš„æ•°æ®ï¼Œåœ¨Scrapyä¸­ï¼Œ è¿™æ˜¯é€šè¿‡ Scrapy Items æ¥å®Œæˆçš„ã€‚é€šè¿‡scrapy.Field()æ–¹æ³•åˆ›å»ºéœ€è¦å­˜å‚¨çš„å­—æ®µï¼Œæ¯”å¦‚ccå­˜å‚¨æ¯”èµ›çš„åœºæ¬¡ä¿¡æ¯ï¼Œliå­˜å‚¨ç«‹åšçš„èµ”ç‡ä¿¡æ¯ï¼Œç­‰ç­‰ã€‚</p>

<p>å…³äºè¿™ä¸ªitems.pyï¼Œä½ åªè¦è€ƒè™‘å®ƒå°±æ˜¯ä¸€ä¸ªå­˜å‚¨æ•°æ®çš„å®¹å™¨ï¼Œå¯ä»¥è€ƒè™‘æˆä¸€ä¸ªç»“æ„ä½“ï¼Œä½ æ‰€æœ‰éœ€è¦æå–çš„ä¿¡æ¯éƒ½åœ¨è¿™é‡Œé¢å­˜ç€ã€‚</p>

<p>è¿™é‡Œæˆ‘ä»¬éœ€è¦å­˜å‚¨3ä¸ªå˜é‡ï¼Œccï¼Œliï¼Œb5ï¼Œæ‰€ä»¥æˆ‘åœ¨é‡Œé¢åŠ å…¥ä¸‰ä¸ªå˜é‡ï¼Œå°±è¿™ä¹ˆç®€å•ã€‚</p>

<h2 id="pipelinespy">pipelines.pyï¼š</h2>

<p>ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä½ è¦æ“ä½œæ•°æ®åº“ä»€ä¹ˆçš„ï¼Œéœ€è¦åœ¨è¿™é‡Œå¤„ç†itemsï¼Œä½ å¯ä»¥æŠŠitemså†™å…¥æ•°æ®åº“ï¼Œä½†æ˜¯ä»Šå¤©æˆ‘ä»¬ç”¨ä¸åˆ°æ•°æ®åº“ï¼Œscrapyè‡ªå¸¦äº†ä¸€ä¸ªå¾ˆå¥½çš„åŠŸèƒ½å°±æ˜¯Feed exportsï¼Œå®ƒæ”¯æŒå¤šç§æ ¼å¼çš„è‡ªåŠ¨è¾“å‡ºã€‚</p>

<p>æ‰€ä»¥æˆ‘ä»¬ç›´æ¥ç”¨è¿™ä¸ªå°±å¥½äº†ï¼Œpipelinesç»´æŒä¸å˜ã€‚</p>

<h2 id="settingspy">settings.pyï¼š</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## -*- coding: utf-8 -*-
</span><span class="n">FEED_EXPORT_ENCODING</span> <span class="o">=</span> <span class="s">"gb18030"</span> <span class="c1">#è§£å†³å¯¼å‡ºçš„ Excel æ–‡ä»¶ä¸­æ–‡ä¹±ç é—®é¢˜
</span><span class="p">...</span>
<span class="n">FEED_EXPORTERS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'csv'</span><span class="p">:</span> <span class="s">'peilv.spiders.itemcsvexporter.itemcsvexporter'</span><span class="p">,</span>
<span class="p">}</span>   
<span class="n">FIELDS_TO_EXPORT</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">'cc'</span><span class="p">,</span><span class="c1">#æ¯”èµ›åœºæ¬¡
</span>    <span class="s">'li'</span><span class="p">,</span><span class="c1">#ç«‹åšçš„èµ”ç‡
</span>    <span class="s">'b5'</span><span class="p">,</span><span class="c1">#bet365çš„èµ”ç‡
</span>   <span class="p">]</span>
<span class="p">...</span>
</code></pre></div></div>

<p>FEED_EXPORT_ENCODINGç”¨gb18030å¸¸é‡æ¥è§£å†³ä¸­æ–‡ä¹±ç é—®é¢˜ï¼ŒFEED_EXPORTERSè¡¨æ˜äº†è¾“å‡ºæ–‡ä»¶çš„æ ¼å¼ï¼ŒFIELDS_TO_EXPORTç»™å®šäº†è¾“å‡ºå­—æ®µçš„é¡ºåºã€‚</p>

<h2 id="itemcsvexporterpy">itemcsvexporter.pyï¼š</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">scrapy.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">scrapy.exporters</span> <span class="kn">import</span> <span class="n">CsvItemExporter</span>
<span class="c1">#æŒ‡å®šè¾“å‡ºåˆ° csv æ–‡ä»¶ä¸­å­—æ®µçš„é¡ºåºï¼Œç»“åˆ setting.py
</span><span class="k">class</span> <span class="nc">itemcsvexporter</span><span class="p">(</span><span class="n">CsvItemExporter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="p">...</span>
</code></pre></div></div>

<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯æœ‰çš„ç‰ˆæœ¬ä¸æ”¯æŒfrom scrapy.contrib.exporter import CsvItemExporterç±»ï¼Œæ‰€ä»¥ç”¨from scrapy.exporters import CsvItemExporteræ›¿æ¢å³å¯ã€‚
é€šå¸¸ç»“åˆsettingä¸­çš„å­—æ®µé¡ºåºï¼Œè§„å®šæœ€ç»ˆCSVæ–‡ä»¶ä¸­çš„åˆ—æ’åºè§„åˆ™ã€‚</p>

<h2 id="çˆ¬è™«ä¸»ç¨‹åºpyä¸‹ä¸€ç¯‡è¯¦ç»†ä»‹ç»">çˆ¬è™«ä¸»ç¨‹åº.pyï¼š(ä¸‹ä¸€ç¯‡è¯¦ç»†ä»‹ç»)</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## -*- coding: utf-8 -*-
</span><span class="n">ls_url</span> <span class="o">=</span> <span class="s">'https://live.leisu.com/wanchang?date='</span><span class="c1">#lså†å²https://live.leisu.com/wanchang?date=20190606
</span><span class="k">class</span> <span class="nc">LiveJiangSpider</span><span class="p">(</span><span class="n">scrapy</span><span class="p">.</span><span class="n">Spider</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">'FBP'</span>
    <span class="n">allowed_domains</span> <span class="o">=</span> <span class="p">[</span><span class="s">'leisu.com'</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">start_requests</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">d1</span><span class="o">=</span><span class="s">'20190606'</span> <span class="c1">#å†å²çš„æ¯”èµ›
</span>            <span class="n">request</span> <span class="o">=</span> <span class="n">scrapy</span><span class="p">.</span><span class="n">http</span><span class="p">.</span><span class="n">FormRequest</span><span class="p">(</span><span class="n">ls_url</span> <span class="o">+</span> <span class="n">d1</span><span class="p">,</span><span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">parseLs</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="p">{</span><span class="s">'d1'</span><span class="p">:</span> <span class="n">d1</span><span class="p">})</span> <span class="c1">#å†å²çš„æ¯”èµ›
</span>            <span class="c1"># request = scrapy.http.FormRequest(wl_url + d1,callback=self.parseWl, meta={'d1': d1})#æœªæ¥çš„æ¯”èµ›
</span>            <span class="k">yield</span> <span class="n">request</span>
    <span class="k">def</span> <span class="nf">parseLs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">response</span><span class="p">):</span>
        <span class="n">d2</span><span class="o">=</span><span class="n">response</span><span class="p">.</span><span class="n">meta</span><span class="p">[</span><span class="s">'d1'</span><span class="p">]</span>
        <span class="n">sel</span><span class="o">=</span><span class="n">response</span><span class="p">.</span><span class="n">xpath</span>
        <span class="n">racelist</span><span class="o">=</span><span class="p">[</span><span class="n">e5</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">"'"</span><span class="p">)</span> <span class="k">for</span> <span class="n">e5</span> <span class="ow">in</span> <span class="n">sel</span><span class="p">(</span><span class="s">'//li[@data-status="8"]/@data-id'</span><span class="p">).</span><span class="n">extract</span><span class="p">()]</span>
        <span class="k">for</span> <span class="n">raceid</span> <span class="ow">in</span> <span class="n">racelist</span><span class="p">:</span><span class="c1">#raceid=['2674547'];raceid[0]=2674547
</span>            <span class="n">item</span> <span class="o">=</span> <span class="n">PeilvItem</span><span class="p">()</span>
            <span class="n">sel_div</span><span class="o">=</span><span class="n">sel</span><span class="p">(</span><span class="s">'//li[@data-id='</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">raceid</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s">']/div[@class="find-table layout-grid-tbody hide"]/div[@class="clearfix-row"]'</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">sel_div</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'span[@class="lab-lottery"]/span[@class="text-jc"]/text()'</span><span class="p">).</span><span class="n">extract</span><span class="p">())</span> <span class="o">==</span> <span class="s">"[]"</span><span class="p">:</span>
                <span class="n">item</span><span class="p">[</span><span class="s">'cc'</span><span class="p">]</span><span class="o">=</span><span class="s">""</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">item</span><span class="p">[</span><span class="s">'cc'</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sel_div</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'span[@class="lab-lottery"]/span[@class="text-jc"]/text()'</span><span class="p">).</span><span class="n">extract</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="s">"å‘¨"</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s">'cc'</span><span class="p">]:</span><span class="c1">#å–ç«å½©-å‘¨ä¸€001ç­‰
</span>                <span class="n">plurl</span><span class="o">=</span><span class="s">'https://live.leisu.com/3in1-'</span><span class="o">+</span><span class="n">raceid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">request</span> <span class="o">=</span> <span class="n">scrapy</span><span class="p">.</span><span class="n">http</span><span class="p">.</span><span class="n">FormRequest</span><span class="p">(</span><span class="n">plurl</span><span class="p">,</span><span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">parse</span><span class="p">,</span><span class="n">meta</span><span class="o">=</span><span class="p">{</span><span class="s">'item'</span><span class="p">:</span><span class="n">item</span><span class="p">})</span>
                <span class="k">yield</span> <span class="n">request</span> <span class="c1">#å¹¶éreturnï¼Œyieldå‹é˜Ÿåˆ—ï¼Œparseå‡½æ•°å°†ä¼šè¢«å½“åšä¸€ä¸ªç”Ÿæˆå™¨ä½¿ç”¨ã€‚scrapyä¼šé€ä¸€è·å–parseæ–¹æ³•ä¸­ç”Ÿæˆçš„ç»“æœï¼Œå¹¶æ²¡æœ‰ç›´æ¥æ‰§è¡Œparseï¼Œå¾ªç¯å®Œæˆåï¼Œå†æ‰§è¡Œparse
</span>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'--------------into parse----------------------'</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">meta</span><span class="p">[</span><span class="s">'item'</span><span class="p">]</span>
        <span class="n">pv</span><span class="o">=</span><span class="n">response</span><span class="p">.</span><span class="n">xpath</span>
        <span class="n">pl_str</span> <span class="o">=</span> <span class="s">'/td[@class="bd-left"]/div[@class="begin float-left w-bar-100 bd-bottom p-b-8 color-999 m-b-8"]/span[@class="float-left col-3"]/text()'</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">pv</span><span class="p">(</span><span class="s">'//*[@data-id="5"]'</span><span class="o">+</span><span class="n">pl_str</span><span class="p">).</span><span class="n">extract</span><span class="p">())</span><span class="o">==</span><span class="s">"[]"</span><span class="p">:</span>
            <span class="n">item</span><span class="p">[</span><span class="s">'li'</span><span class="p">]</span> <span class="o">=</span>  <span class="s">''</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">item</span><span class="p">[</span><span class="s">'li'</span><span class="p">]</span><span class="o">=</span><span class="n">pv</span><span class="p">(</span><span class="s">'//*[@data-id="5"]'</span> <span class="o">+</span> <span class="n">pl_str</span><span class="p">).</span><span class="n">extract</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">pv</span><span class="p">(</span><span class="s">'//*[@data-id="2"]'</span><span class="o">+</span><span class="n">pl_str</span><span class="p">).</span><span class="n">extract</span><span class="p">())</span><span class="o">==</span><span class="s">"[]"</span><span class="p">:</span>
            <span class="n">item</span><span class="p">[</span><span class="s">'b5'</span><span class="p">]</span> <span class="o">=</span>  <span class="s">''</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">item</span><span class="p">[</span><span class="s">'b5'</span><span class="p">]</span><span class="o">=</span><span class="n">pv</span><span class="p">(</span><span class="s">'//*[@data-id="2"]'</span> <span class="o">+</span> <span class="n">pl_str</span><span class="p">).</span><span class="n">extract</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">yield</span> <span class="n">item</span><span class="c1">#ç¨‹åºåœ¨å–å¾—å„ä¸ªé¡µé¢çš„itemså‰ï¼Œä¼šå…ˆå¤„ç†å®Œä¹‹å‰æ‰€æœ‰çš„requesté˜Ÿåˆ—é‡Œçš„è¯·æ±‚ï¼Œç„¶åå†æå–items
</span></code></pre></div></div>

<p>çˆ¬è™«ä¸»ç¨‹åºå®ç°äº†çˆ¬å–ç½‘é¡µæ•°æ®çš„å…·ä½“é€»è¾‘ï¼Œåœ¨ä¸‹ä¸€è®²ä¼šç»“åˆä¸€ä¸ªå…·ä½“äº‹ä¾‹è¯¦ç»†ä»‹ç»ã€‚</p>

<p>æ”¹å†™å®Œç¨‹åºåï¼Œæœ€ç»ˆæ‰§è¡Œå‘½ä»¤ï¼š
Pycharm ç”¨ alt+F12 åˆ‡æ¢åˆ°å‘½ä»¤è¡Œåœ¨é¡¹ç›® peilv è·¯å¾„ä¸Šæ‰§è¡Œï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">venv2</span><span class="p">)</span> <span class="n">E</span><span class="p">:</span>\<span class="o">&gt;</span><span class="n">cd</span> <span class="n">peilv</span>\<span class="n">peilv</span> 
<span class="p">(</span><span class="n">venv2</span><span class="p">)</span> <span class="n">E</span><span class="p">:</span>\<span class="n">peilv</span>\<span class="n">peilv</span><span class="o">&gt;</span><span class="n">scrapy</span> <span class="n">crawl</span> <span class="n">FBP</span> <span class="o">-</span><span class="n">o</span> <span class="n">BaseData</span><span class="p">.</span><span class="n">csv</span>
</code></pre></div></div>

<p>å…¶ä¸­ FBP æ˜¯åœ¨â€œçˆ¬è™«ä¸»ç¨‹åº.pyâ€å®šä¹‰çš„â€”â€”name = â€˜FBPâ€™ï¼Œâ€œ-o BaseData.csvâ€ æ˜¯å°†çˆ¬å–çš„æ•°æ®è¾“å‡ºåˆ° csv æ–‡ä»¶ä¸­ã€‚</p>

<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>ä»¥ä¸Šé¦–å…ˆåˆ›å»ºä¸€ä¸ªå·¥ç¨‹å’ŒSpideræ¨¡æ¿ï¼Œç„¶åç¼–å†™Spiderï¼Œç¼–å†™Item Pipelineï¼Œå€ŸåŠ©äº†Scrapyä¸­çš„ä¸‰ä¸ªç±»â€”â€”Requestç±»ã€Responseç±»å’ŒItemç±»ã€‚</p>

<p>åŒæ—¶æˆ‘ä»¬ä»¥ä¸€ä¸ªå®æˆ˜é¡¹ç›®ä¸ºä¾æ‰˜ï¼Œå°†å»ºç«‹ Scrapy é¡¹ç›®çš„è¿‡ç¨‹ä»é›¶å¼€å§‹ï¼Œæ·±å…¥æµ…å‡ºï¼Œè®©è¯»è€…èƒ½å¤Ÿå®è·µçˆ¬è™«çš„æ•´ä¸ªè¿‡ç¨‹ã€‚</p>

<h2 id="ä»£ç åœ°å€">ä»£ç åœ°å€</h2>

<blockquote>
  <p>ç¤ºä¾‹ä»£ç ï¼š<a href="https://github.com/JustDoPython/python-100-day/tree/master/day-070">Python-100-days-day070</a></p>
</blockquote>

:ET