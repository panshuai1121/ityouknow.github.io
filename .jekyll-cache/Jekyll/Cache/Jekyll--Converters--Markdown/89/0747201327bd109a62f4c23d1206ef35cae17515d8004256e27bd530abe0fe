I"ØW<p>å¾®æœåŠ¡çš„ç‰¹ç‚¹å†³å®šäº†åŠŸèƒ½æ¨¡å—çš„éƒ¨ç½²æ˜¯åˆ†å¸ƒå¼çš„ï¼Œå¤§éƒ¨åˆ†åŠŸèƒ½æ¨¡å—éƒ½æ˜¯è¿è¡Œåœ¨ä¸åŒçš„æœºå™¨ä¸Šï¼Œå½¼æ­¤é€šè¿‡æœåŠ¡è°ƒç”¨è¿›è¡Œäº¤äº’ï¼Œå‰åå°çš„ä¸šåŠ¡æµä¼šç»è¿‡å¾ˆå¤šä¸ªå¾®æœåŠ¡çš„å¤„ç†å’Œä¼ é€’ï¼Œå‡ºç°äº†å¼‚å¸¸å¦‚ä½•å¿«é€Ÿå®šä½æ˜¯å“ªä¸ªç¯èŠ‚å‡ºç°äº†é—®é¢˜ï¼Ÿ</p>

<p>åœ¨è¿™ç§æ¡†æ¶ä¸‹ï¼Œå¾®æœåŠ¡çš„ç›‘æ§æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚æœ¬æ–‡ä¸»è¦ç»“åˆ Spring Boot Actuatorï¼Œè·Ÿå¤§å®¶ä¸€èµ·åˆ†äº«å¾®æœåŠ¡ Spring Boot Actuator çš„å¸¸è§ç”¨æ³•ï¼Œæ–¹ä¾¿æˆ‘ä»¬åœ¨æ—¥å¸¸ä¸­å¯¹æˆ‘ä»¬çš„å¾®æœåŠ¡è¿›è¡Œç›‘æ§æ²»ç†ã€‚</p>

<h2 id="actuator-ç›‘æ§">Actuator ç›‘æ§</h2>

<p>Spring Boot ä½¿ç”¨â€œä¹ æƒ¯ä¼˜äºé…ç½®çš„ç†å¿µâ€ï¼Œé‡‡ç”¨åŒ…æ‰«æå’Œè‡ªåŠ¨åŒ–é…ç½®çš„æœºåˆ¶æ¥åŠ è½½ä¾èµ– Jar ä¸­çš„ Spring beanï¼Œä¸éœ€è¦ä»»ä½• Xml é…ç½®ï¼Œå°±å¯ä»¥å®ç° Spring çš„æ‰€æœ‰é…ç½®ã€‚è™½ç„¶è¿™æ ·åšèƒ½è®©æˆ‘ä»¬çš„ä»£ç å˜å¾—éå¸¸ç®€æ´ï¼Œä½†æ˜¯æ•´ä¸ªåº”ç”¨çš„å®ä¾‹åˆ›å»ºå’Œä¾èµ–å…³ç³»ç­‰ä¿¡æ¯éƒ½è¢«ç¦»æ•£åˆ°äº†å„ä¸ªé…ç½®ç±»çš„æ³¨è§£ä¸Šï¼Œè¿™ä½¿å¾—æˆ‘ä»¬åˆ†ææ•´ä¸ªåº”ç”¨ä¸­èµ„æºå’Œå®ä¾‹çš„å„ç§å…³ç³»å˜å¾—éå¸¸çš„å›°éš¾ã€‚</p>

<p>Actuator æ˜¯ Spring Boot æä¾›çš„å¯¹åº”ç”¨ç³»ç»Ÿçš„è‡ªçœå’Œç›‘æ§çš„é›†æˆåŠŸèƒ½ï¼Œå¯ä»¥æŸ¥çœ‹åº”ç”¨é…ç½®çš„è¯¦ç»†ä¿¡æ¯ï¼Œä¾‹å¦‚è‡ªåŠ¨åŒ–é…ç½®ä¿¡æ¯ã€åˆ›å»ºçš„ Spring beans ä»¥åŠä¸€äº›ç¯å¢ƒå±æ€§ç­‰ã€‚</p>

<p>ä¸ºäº†ä¿è¯ actuator æš´éœ²çš„ç›‘æ§æ¥å£çš„å®‰å…¨æ€§ï¼Œéœ€è¦æ·»åŠ å®‰å…¨æ§åˆ¶çš„ä¾èµ–<code class="highlighter-rouge">spring-boot-start-security</code>ä¾èµ–ï¼Œè®¿é—®åº”ç”¨ç›‘æ§ç«¯ç‚¹æ—¶ï¼Œéƒ½éœ€è¦è¾“å…¥éªŒè¯ä¿¡æ¯ã€‚Security ä¾èµ–ï¼Œå¯ä»¥é€‰æ‹©ä¸åŠ ï¼Œä¸è¿›è¡Œå®‰å…¨ç®¡ç†ï¼Œä½†ä¸å»ºè®®è¿™ä¹ˆåšã€‚</p>

<h2 id="actuator-çš„-rest-æ¥å£">Actuator çš„ REST æ¥å£</h2>

<p>Actuator ç›‘æ§åˆ†æˆä¸¤ç±»ï¼šåŸç”Ÿç«¯ç‚¹å’Œç”¨æˆ·è‡ªå®šä¹‰ç«¯ç‚¹ï¼›è‡ªå®šä¹‰ç«¯ç‚¹ä¸»è¦æ˜¯æŒ‡æ‰©å±•æ€§ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„å®é™…åº”ç”¨ï¼Œå®šä¹‰ä¸€äº›æ¯”è¾ƒå…³å¿ƒçš„æŒ‡æ ‡ï¼Œåœ¨è¿è¡ŒæœŸè¿›è¡Œç›‘æ§ã€‚</p>

<p>åŸç”Ÿç«¯ç‚¹æ˜¯åœ¨åº”ç”¨ç¨‹åºé‡Œæä¾›ä¼—å¤š Web æ¥å£ï¼Œé€šè¿‡å®ƒä»¬äº†è§£åº”ç”¨ç¨‹åºè¿è¡Œæ—¶çš„å†…éƒ¨çŠ¶å†µã€‚åŸç”Ÿç«¯ç‚¹åˆå¯ä»¥åˆ†æˆä¸‰ç±»ï¼š</p>

<ul>
  <li>åº”ç”¨é…ç½®ç±»ï¼šå¯ä»¥æŸ¥çœ‹åº”ç”¨åœ¨è¿è¡ŒæœŸçš„é™æ€ä¿¡æ¯ï¼šä¾‹å¦‚è‡ªåŠ¨é…ç½®ä¿¡æ¯ã€åŠ è½½çš„ springbean ä¿¡æ¯ã€yml æ–‡ä»¶é…ç½®ä¿¡æ¯ã€ç¯å¢ƒä¿¡æ¯ã€è¯·æ±‚æ˜ å°„ä¿¡æ¯ï¼›</li>
  <li>åº¦é‡æŒ‡æ ‡ç±»ï¼šä¸»è¦æ˜¯è¿è¡ŒæœŸçš„åŠ¨æ€ä¿¡æ¯ï¼Œä¾‹å¦‚å †æ ˆã€è¯·æ±‚è¿ã€ä¸€äº›å¥åº·æŒ‡æ ‡ã€metrics ä¿¡æ¯ç­‰ï¼›</li>
  <li>æ“ä½œæ§åˆ¶ç±»ï¼šä¸»è¦æ˜¯æŒ‡ shutdown,ç”¨æˆ·å¯ä»¥å‘é€ä¸€ä¸ªè¯·æ±‚å°†åº”ç”¨çš„ç›‘æ§åŠŸèƒ½å…³é—­ã€‚</li>
</ul>

<p>Actuator æä¾›äº† 13 ä¸ªæ¥å£ï¼Œå…·ä½“å¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚</p>

<table>
  <thead>
    <tr>
      <th>HTTP æ–¹æ³•</th>
      <th>è·¯å¾„</th>
      <th>æè¿°</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>GET</td>
      <td>/auditevents</td>
      <td>æ˜¾ç¤ºåº”ç”¨æš´éœ²çš„å®¡è®¡äº‹ä»¶ (æ¯”å¦‚è®¤è¯è¿›å…¥ã€è®¢å•å¤±è´¥)</td>
    </tr>
    <tr>
      <td>GET</td>
      <td>/beans</td>
      <td>æè¿°åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡é‡Œå…¨éƒ¨çš„ Beanï¼Œä»¥åŠå®ƒä»¬çš„å…³ç³»</td>
    </tr>
    <tr>
      <td>GET</td>
      <td>/conditions</td>
      <td>å°±æ˜¯ 1.0 çš„ /autoconfig ï¼Œæä¾›ä¸€ä»½è‡ªåŠ¨é…ç½®ç”Ÿæ•ˆçš„æ¡ä»¶æƒ…å†µï¼Œè®°å½•å“ªäº›è‡ªåŠ¨é…ç½®æ¡ä»¶é€šè¿‡äº†ï¼Œå“ªäº›æ²¡é€šè¿‡</td>
    </tr>
    <tr>
      <td>GET</td>
      <td>/configprops</td>
      <td>æè¿°é…ç½®å±æ€§(åŒ…å«é»˜è®¤å€¼)å¦‚ä½•æ³¨å…¥Bean</td>
    </tr>
    <tr>
      <td>GET</td>
      <td>/env</td>
      <td>è·å–å…¨éƒ¨ç¯å¢ƒå±æ€§</td>
    </tr>
    <tr>
      <td>GET</td>
      <td>/env/{name}</td>
      <td>æ ¹æ®åç§°è·å–ç‰¹å®šçš„ç¯å¢ƒå±æ€§å€¼</td>
    </tr>
    <tr>
      <td>GET</td>
      <td>/flyway</td>
      <td>æä¾›ä¸€ä»½ Flyway æ•°æ®åº“è¿ç§»ä¿¡æ¯</td>
    </tr>
    <tr>
      <td>GET</td>
      <td>/liquidbase</td>
      <td>æ˜¾ç¤ºLiquibase æ•°æ®åº“è¿ç§»çš„çº¤ç»†ä¿¡æ¯</td>
    </tr>
    <tr>
      <td>GET</td>
      <td>/health</td>
      <td>æŠ¥å‘Šåº”ç”¨ç¨‹åºçš„å¥åº·æŒ‡æ ‡ï¼Œè¿™äº›å€¼ç”± HealthIndicator çš„å®ç°ç±»æä¾›</td>
    </tr>
    <tr>
      <td>GET</td>
      <td>/heapdump</td>
      <td>dump ä¸€ä»½åº”ç”¨çš„ JVM å †ä¿¡æ¯</td>
    </tr>
    <tr>
      <td>GET</td>
      <td>/httptrace</td>
      <td>æ˜¾ç¤ºHTTPè¶³è¿¹ï¼Œæœ€è¿‘100ä¸ªHTTP request/repsponse</td>
    </tr>
    <tr>
      <td>GET</td>
      <td>/info</td>
      <td>è·å–åº”ç”¨ç¨‹åºçš„å®šåˆ¶ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ç”±infoæ‰“å¤´çš„å±æ€§æä¾›</td>
    </tr>
    <tr>
      <td>GET</td>
      <td>/logfile</td>
      <td>è¿”å›log fileä¸­çš„å†…å®¹(å¦‚æœ logging.file æˆ–è€… logging.path è¢«è®¾ç½®)</td>
    </tr>
    <tr>
      <td>GET</td>
      <td>/loggers</td>
      <td>æ˜¾ç¤ºå’Œä¿®æ”¹é…ç½®çš„loggers</td>
    </tr>
    <tr>
      <td>GET</td>
      <td>/metrics</td>
      <td>æŠ¥å‘Šå„ç§åº”ç”¨ç¨‹åºåº¦é‡ä¿¡æ¯ï¼Œæ¯”å¦‚å†…å­˜ç”¨é‡å’ŒHTTPè¯·æ±‚è®¡æ•°</td>
    </tr>
    <tr>
      <td>GET</td>
      <td>/metrics/{name}</td>
      <td>æŠ¥å‘ŠæŒ‡å®šåç§°çš„åº”ç”¨ç¨‹åºåº¦é‡å€¼</td>
    </tr>
    <tr>
      <td>GET</td>
      <td>/scheduledtasks</td>
      <td>å±•ç¤ºåº”ç”¨ä¸­çš„å®šæ—¶ä»»åŠ¡ä¿¡æ¯</td>
    </tr>
    <tr>
      <td>GET</td>
      <td>/sessions</td>
      <td>å¦‚æœæˆ‘ä»¬ä½¿ç”¨äº† Spring Session å±•ç¤ºåº”ç”¨ä¸­çš„ HTTP sessions ä¿¡æ¯</td>
    </tr>
    <tr>
      <td>POST</td>
      <td>/shutdown</td>
      <td>å…³é—­åº”ç”¨ç¨‹åºï¼Œè¦æ±‚endpoints.shutdown.enabledè®¾ç½®ä¸ºtrue</td>
    </tr>
    <tr>
      <td>GET</td>
      <td>/mappings</td>
      <td>æè¿°å…¨éƒ¨çš„ URIè·¯å¾„ï¼Œä»¥åŠå®ƒä»¬å’Œæ§åˆ¶å™¨(åŒ…å«Actuatorç«¯ç‚¹)çš„æ˜ å°„å…³ç³»</td>
    </tr>
    <tr>
      <td>GET</td>
      <td>/threaddump</td>
      <td>è·å–çº¿ç¨‹æ´»åŠ¨çš„å¿«ç…§</td>
    </tr>
  </tbody>
</table>

<h2 id="å¿«é€Ÿä¸Šæ‰‹">å¿«é€Ÿä¸Šæ‰‹</h2>

<h3 id="ç›¸å…³é…ç½®">ç›¸å…³é…ç½®</h3>

<p><strong>é¡¹ç›®ä¾èµ–</strong></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependencies&gt;</span>
  <span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div></div>

<p><strong>é…ç½®æ–‡ä»¶</strong></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>info.app.name=spring-boot-actuator
info.app.version= 1.0.0
info.app.test=test

management.endpoints.web.exposure.include=*
management.endpoint.health.show-details=always
#management.endpoints.web.base-path=/monitor

management.endpoint.shutdown.enabled=true
</code></pre></div></div>

<ul>
  <li><code class="highlighter-rouge">management.endpoints.web.base-path=/monitor</code> ä»£è¡¨å¯ç”¨å•ç‹¬çš„urlåœ°å€æ¥ç›‘æ§ Spring Boot åº”ç”¨ï¼Œä¸ºäº†å®‰å…¨ä¸€èˆ¬éƒ½å¯ç”¨ç‹¬ç«‹çš„ç«¯å£æ¥è®¿é—®åç«¯çš„ç›‘æ§ä¿¡æ¯</li>
  <li><code class="highlighter-rouge">management.endpoint.shutdown.enabled=true</code> å¯ç”¨æ¥å£å…³é—­ Spring Boot</li>
</ul>

<p>é…ç½®å®Œæˆä¹‹åï¼Œå¯åŠ¨é¡¹ç›®å°±å¯ä»¥ç»§ç»­éªŒè¯å„ä¸ªç›‘æ§åŠŸèƒ½äº†ã€‚</p>

<h2 id="å‘½ä»¤è¯¦è§£">å‘½ä»¤è¯¦è§£</h2>

<p>åœ¨ Spring Boot 2.x ä¸­ä¸ºäº†å®‰å…¨æœŸé—´ï¼ŒActuator åªå¼€æ”¾äº†ä¸¤ä¸ªç«¯ç‚¹ <code class="highlighter-rouge">/actuator/health</code> å’Œ <code class="highlighter-rouge">/actuator/info</code>ã€‚å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®æ‰“å¼€ã€‚</p>

<p>å¯ä»¥æ‰“å¼€æ‰€æœ‰çš„ç›‘æ§ç‚¹</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>management.endpoints.web.exposure.include=*
</code></pre></div></div>

<p>ä¹Ÿå¯ä»¥é€‰æ‹©æ‰“å¼€éƒ¨åˆ†</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>management.endpoints.web.exposure.exclude=beans,trace
</code></pre></div></div>

<p>Actuator é»˜è®¤æ‰€æœ‰çš„ç›‘æ§ç‚¹è·¯å¾„éƒ½åœ¨<code class="highlighter-rouge">/actuator/*</code>ï¼Œå½“ç„¶å¦‚æœæœ‰éœ€è¦è¿™ä¸ªè·¯å¾„ä¹Ÿæ”¯æŒå®šåˆ¶ã€‚</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>management.endpoints.web.base-path=/manage
</code></pre></div></div>

<p>è®¾ç½®å®Œé‡å¯åï¼Œå†æ¬¡è®¿é—®åœ°å€å°±ä¼šå˜æˆ<code class="highlighter-rouge">/manage/*</code></p>

<p>Actuator å‡ ä¹ç›‘æ§äº†åº”ç”¨æ¶‰åŠçš„æ–¹æ–¹é¢é¢ï¼Œæˆ‘ä»¬é‡ç‚¹è®²è¿°ä¸€äº›ç»å¸¸åœ¨é¡¹ç›®ä¸­å¸¸ç”¨çš„å‘½ä»¤ã€‚</p>

<h3 id="health">health</h3>

<p>health ä¸»è¦ç”¨æ¥æ£€æŸ¥åº”ç”¨çš„è¿è¡ŒçŠ¶æ€ï¼Œè¿™æ˜¯æˆ‘ä»¬ä½¿ç”¨æœ€é«˜é¢‘çš„ä¸€ä¸ªç›‘æ§ç‚¹ã€‚é€šå¸¸ä½¿ç”¨æ­¤æ¥å£æé†’æˆ‘ä»¬åº”ç”¨å®ä¾‹çš„è¿è¡ŒçŠ¶æ€ï¼Œä»¥åŠåº”ç”¨ä¸â€å¥åº·â€œçš„åŸå› ï¼Œæ¯”å¦‚æ•°æ®åº“è¿æ¥ã€ç£ç›˜ç©ºé—´ä¸å¤Ÿç­‰ã€‚</p>

<p>é»˜è®¤æƒ…å†µä¸‹ health çš„çŠ¶æ€æ˜¯å¼€æ”¾çš„ï¼Œæ·»åŠ ä¾èµ–åå¯åŠ¨é¡¹ç›®ï¼Œè®¿é—®ï¼š<code class="highlighter-rouge">http://localhost:8080/actuator/health</code>å³å¯çœ‹åˆ°åº”ç”¨çš„çŠ¶æ€ã€‚</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    "status" : "UP"
}
</code></pre></div></div>

<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæœ€ç»ˆçš„ Spring Boot åº”ç”¨çš„çŠ¶æ€æ˜¯ç”± HealthAggregator æ±‡æ€»è€Œæˆçš„ï¼Œæ±‡æ€»çš„ç®—æ³•æ˜¯ï¼š</p>

<ul>
  <li>1 è®¾ç½®çŠ¶æ€ç é¡ºåºï¼š<code class="highlighter-rouge">setStatusOrder(Status.DOWN, Status.OUT_OF_SERVICE, Status.UP, Status.UNKNOWN);</code>ã€‚</li>
  <li>2 è¿‡æ»¤æ‰ä¸èƒ½è¯†åˆ«çš„çŠ¶æ€ç ã€‚</li>
  <li>3 å¦‚æœæ— ä»»ä½•çŠ¶æ€ç ï¼Œæ•´ä¸ª Spring Boot åº”ç”¨çš„çŠ¶æ€æ˜¯ UNKNOWNã€‚</li>
  <li>4 å°†æ‰€æœ‰æ”¶é›†åˆ°çš„çŠ¶æ€ç æŒ‰ç…§ 1 ä¸­çš„é¡ºåºæ’åºã€‚</li>
  <li>5 è¿”å›æœ‰åºçŠ¶æ€ç åºåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªçŠ¶æ€ç ï¼Œä½œä¸ºæ•´ä¸ª Spring Boot åº”ç”¨çš„çŠ¶æ€ã€‚</li>
</ul>

<p>health  é€šè¿‡åˆå¹¶å‡ ä¸ªå¥åº·æŒ‡æ•°æ£€æŸ¥åº”ç”¨çš„å¥åº·æƒ…å†µã€‚Spring Boot Actuator æœ‰å‡ ä¸ªé¢„å®šä¹‰çš„å¥åº·æŒ‡æ ‡æ¯”å¦‚<code class="highlighter-rouge">DataSourceHealthIndicator</code>, <code class="highlighter-rouge">DiskSpaceHealthIndicator</code>, <code class="highlighter-rouge">MongoHealthIndicator</code>, <code class="highlighter-rouge">RedisHealthIndicator</code>ç­‰ï¼Œå®ƒä½¿ç”¨è¿™äº›å¥åº·æŒ‡æ ‡ä½œä¸ºå¥åº·æ£€æŸ¥çš„ä¸€éƒ¨åˆ†ã€‚</p>

<p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä½ çš„åº”ç”¨ä½¿ç”¨ Redisï¼Œ<code class="highlighter-rouge">RedisHealthindicator</code> å°†è¢«å½“ä½œæ£€æŸ¥çš„ä¸€éƒ¨åˆ†ï¼›å¦‚æœä½¿ç”¨ MongoDBï¼Œé‚£ä¹ˆ<code class="highlighter-rouge">MongoHealthIndicator</code> å°†è¢«å½“ä½œæ£€æŸ¥çš„ä¸€éƒ¨åˆ†ã€‚</p>

<p>å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­å…³é—­ç‰¹å®šçš„å¥åº·æ£€æŸ¥æŒ‡æ ‡ï¼Œæ¯”å¦‚å…³é—­ redis çš„å¥åº·æ£€æŸ¥ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>management.health.redise.enabled=false
</code></pre></div></div>

<p>é»˜è®¤ï¼Œæ‰€æœ‰çš„è¿™äº›å¥åº·æŒ‡æ ‡è¢«å½“ä½œå¥åº·æ£€æŸ¥çš„ä¸€éƒ¨åˆ†ã€‚</p>

<h3 id="info">info</h3>

<p>info å°±æ˜¯æˆ‘ä»¬è‡ªå·±é…ç½®åœ¨é…ç½®æ–‡ä»¶ä¸­ä»¥ info å¼€å¤´çš„é…ç½®ä¿¡æ¯ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨ç¤ºä¾‹é¡¹ç›®ä¸­çš„é…ç½®æ˜¯ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>info.app.name=spring-boot-actuator
info.app.version= 1.0.0
info.app.test= test
</code></pre></div></div>

<p>å¯åŠ¨ç¤ºä¾‹é¡¹ç›®ï¼Œè®¿é—®ï¼š<code class="highlighter-rouge">http://localhost:8080/actuator/info</code>è¿”å›éƒ¨åˆ†ä¿¡æ¯å¦‚ä¸‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  "app": {
    "name": "spring-boot-actuator",
    "version": "1.0.0",
    "test":"test"
  }
}
</code></pre></div></div>

<h3 id="beans">beans</h3>

<p>æ ¹æ®ç¤ºä¾‹å°±å¯ä»¥çœ‹å‡ºï¼Œå±•ç¤ºäº† bean çš„åˆ«åã€ç±»å‹ã€æ˜¯å¦å•ä¾‹ã€ç±»çš„åœ°å€ã€ä¾èµ–ç­‰ä¿¡æ¯ã€‚</p>

<p>å¯åŠ¨ç¤ºä¾‹é¡¹ç›®ï¼Œè®¿é—®ï¼š<code class="highlighter-rouge">http://localhost:8080/actuator/beans</code>è¿”å›éƒ¨åˆ†ä¿¡æ¯å¦‚ä¸‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[
  {
    "context": "application:8080:management",
    "parent": "application:8080",
    "beans": [
      {
        "bean": "embeddedServletContainerFactory",
        "aliases": [
          
        ],
        "scope": "singleton",
        "type": "org.springframework.boot.context.embedded.tomcat.TomcatEmbeddedServletContainerFactory",
        "resource": "null",
        "dependencies": [
          
        ]
      },
      {
        "bean": "endpointWebMvcChildContextConfiguration",
        "aliases": [
          
        ],
        "scope": "singleton",
        "type": "org.springframework.boot.actuate.autoconfigure.EndpointWebMvcChildContextConfiguration$$EnhancerBySpringCGLIB$$a4a10f9d",
        "resource": "null",
        "dependencies": [
          
        ]
      }
  }
]
</code></pre></div></div>

<h3 id="conditions">conditions</h3>

<p>Spring Boot çš„è‡ªåŠ¨é…ç½®åŠŸèƒ½éå¸¸ä¾¿åˆ©ï¼Œä½†æœ‰æ—¶å€™ä¹Ÿæ„å‘³ç€å‡ºé—®é¢˜æ¯”è¾ƒéš¾æ‰¾å‡ºå…·ä½“çš„åŸå› ã€‚ä½¿ç”¨ conditions å¯ä»¥åœ¨åº”ç”¨è¿è¡Œæ—¶æŸ¥çœ‹ä»£ç äº†æŸä¸ªé…ç½®åœ¨ä»€ä¹ˆæ¡ä»¶ä¸‹ç”Ÿæ•ˆï¼Œæˆ–è€…æŸä¸ªè‡ªåŠ¨é…ç½®ä¸ºä»€ä¹ˆæ²¡æœ‰ç”Ÿæ•ˆã€‚</p>

<p>å¯åŠ¨ç¤ºä¾‹é¡¹ç›®ï¼Œè®¿é—®ï¼š<code class="highlighter-rouge">http://localhost:8080/actuator/conditions</code>è¿”å›éƒ¨åˆ†ä¿¡æ¯å¦‚ä¸‹ï¼š</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"positiveMatches"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
     </span><span class="nl">"DevToolsDataSourceAutoConfiguration"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"notMatched"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"condition"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DevToolsDataSourceAutoConfiguration.DevToolsDataSourceCondition"</span><span class="p">,</span><span class="w"> 
                    </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DevTools DataSource Condition did not find a single DataSource bean"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">],</span><span class="w"> 
            </span><span class="nl">"matched"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w">
        </span><span class="p">},</span><span class="w"> 
        </span><span class="nl">"RemoteDevToolsAutoConfiguration"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"notMatched"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"condition"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OnPropertyCondition"</span><span class="p">,</span><span class="w"> 
                    </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"@ConditionalOnProperty (spring.devtools.remote.secret) did not find property 'secret'"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">],</span><span class="w"> 
            </span><span class="nl">"matched"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"condition"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OnClassCondition"</span><span class="p">,</span><span class="w"> 
                    </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"@ConditionalOnClass found required classes 'javax.servlet.Filter', 'org.springframework.http.server.ServerHttpRequest'; @ConditionalOnMissingClass did not find unwanted class"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="heapdump">heapdump</h3>

<p>è¿”å›ä¸€ä¸ª GZip å‹ç¼©çš„ JVM å † dump</p>

<p>å¯åŠ¨ç¤ºä¾‹é¡¹ç›®ï¼Œè®¿é—®ï¼š<code class="highlighter-rouge">http://localhost:8080/actuator/heapdump</code>ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª Jvm çš„å †æ–‡ä»¶ heapdumpï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ JDK è‡ªå¸¦çš„ Jvm ç›‘æ§å·¥å…· VisualVM æ‰“å¼€æ­¤æ–‡ä»¶æŸ¥çœ‹å†…å­˜å¿«ç…§ã€‚ç±»ä¼¼å¦‚ä¸‹å›¾ï¼š</p>

<p><img src="http://favorites.ren/assets/images/2018/springboot/heapdump.png" alt="" /></p>

<h3 id="shutdown">shutdown</h3>

<p>å¼€å¯æ¥å£ä¼˜é›…å…³é—­ Spring Boot åº”ç”¨ï¼Œè¦ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½é¦–å…ˆéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>management.endpoint.shutdown.enabled=true
</code></pre></div></div>

<p>é…ç½®å®Œæˆä¹‹åï¼Œå¯åŠ¨ç¤ºä¾‹é¡¹ç›®ï¼Œä½¿ç”¨ curl æ¨¡æ‹Ÿ post è¯·æ±‚è®¿é—® shutdown æ¥å£ã€‚</p>
<blockquote>
  <p>shutdown æ¥å£é»˜è®¤åªæ”¯æŒ post è¯·æ±‚ã€‚</p>
</blockquote>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -X POST "http://localhost:8080/actuator/shutdown" 
{
    "message": "Shutting down, bye..."
}
</code></pre></div></div>

<p>æ­¤æ—¶ä½ ä¼šå‘ç°åº”ç”¨å·²ç»è¢«å…³é—­ã€‚</p>

<h3 id="mappings">mappings</h3>

<p>æè¿°å…¨éƒ¨çš„ URI è·¯å¾„ï¼Œä»¥åŠå®ƒä»¬å’Œæ§åˆ¶å™¨çš„æ˜ å°„å…³ç³»</p>

<p>å¯åŠ¨ç¤ºä¾‹é¡¹ç›®ï¼Œè®¿é—®ï¼š<code class="highlighter-rouge">http://localhost:8080/actuator/mappings</code>è¿”å›éƒ¨åˆ†ä¿¡æ¯å¦‚ä¸‹ï¼š</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"/**/favicon.ico"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"bean"</span><span class="p">:</span><span class="w"> </span><span class="s2">"faviconHandlerMapping"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"{[/hello]}"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"bean"</span><span class="p">:</span><span class="w"> </span><span class="s2">"requestMappingHandlerMapping"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"public java.lang.String com.neo.controller.HelloController.index()"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"{[/error]}"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"bean"</span><span class="p">:</span><span class="w"> </span><span class="s2">"requestMappingHandlerMapping"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"public org.springframework.http.ResponseEntity&lt;java.util.Map&lt;java.lang.String, java.lang.Object&gt;&gt; org.springframework.boot.autoconfigure.web.BasicErrorController.error(javax.servlet.http.HttpServletRequest)"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="threaddump">threaddump</h3>

<p>/threaddump æ¥å£ä¼šç”Ÿæˆå½“å‰çº¿ç¨‹æ´»åŠ¨çš„å¿«ç…§ã€‚è¿™ä¸ªåŠŸèƒ½éå¸¸å¥½ï¼Œæ–¹ä¾¿æˆ‘ä»¬åœ¨æ—¥å¸¸å®šä½é—®é¢˜çš„æ—¶å€™æŸ¥çœ‹çº¿ç¨‹çš„æƒ…å†µã€‚
ä¸»è¦å±•ç¤ºäº†çº¿ç¨‹åã€çº¿ç¨‹IDã€çº¿ç¨‹çš„çŠ¶æ€ã€æ˜¯å¦ç­‰å¾…é”èµ„æºç­‰ä¿¡æ¯ã€‚</p>

<p>å¯åŠ¨ç¤ºä¾‹é¡¹ç›®ï¼Œè®¿é—®ï¼š<code class="highlighter-rouge">http://localhost:8080/actuator/threaddump</code>è¿”å›éƒ¨åˆ†ä¿¡æ¯å¦‚ä¸‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[
  {
    "threadName": "http-nio-8088-exec-6",
    "threadId": 49,
    "blockedTime": -1,
    "blockedCount": 0,
    "waitedTime": -1,
    "waitedCount": 2,
    "lockName": "java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject@1630a501",
    "lockOwnerId": -1,
    "lockOwnerName": null,
    "inNative": false,
    "suspended": false,
    "threadState": "WAITING",
    "stackTrace": [
      {
        "methodName": "park",
        "fileName": "Unsafe.java",
        "lineNumber": -2,
        "className": "sun.misc.Unsafe",
        "nativeMethod": true
      },
      ...
      {
        "methodName": "run",
        "fileName": "TaskThread.java",
        "lineNumber": 61,
        "className": "org.apache.tomcat.util.threads.TaskThread$WrappingRunnable",
        "nativeMethod": false
      }
      ...
    ],
    "lockInfo": {
      "className": "java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject",
      "identityHashCode": 372286721
    }
  }
  ...
]
</code></pre></div></div>

<p>ç”Ÿäº§å‡ºç°é—®é¢˜çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡åº”ç”¨çš„çº¿ç¨‹å¿«ç…§æ¥æ£€æµ‹åº”ç”¨æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ã€‚</p>

<blockquote>
  <p>æ–‡ç« å†…å®¹å·²ç»å‡çº§åˆ° Spring Boot 2.x</p>
</blockquote>

<p><strong><a href="https://github.com/ityouknow/spring-boot-examples/tree/master/spring-boot-actuator">ç¤ºä¾‹ä»£ç -github</a></strong></p>

<p><strong><a href="https://gitee.com/ityouknow/spring-boot-examples/tree/master/spring-boot-actuator">ç¤ºä¾‹ä»£ç -ç äº‘</a></strong></p>

<h2 id="å‚è€ƒ">å‚è€ƒ</h2>

<p><a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#production-ready">Spring Boot Actuator: Production-ready features</a><br />
<a href="http://mp.163.com/v2/article/detail/D7SQCHGT0511FQO9.html">å¯¹æ²¡æœ‰ç›‘æ§çš„å¾®æœåŠ¡Say Noï¼</a>  <br />
<a href="https://www.jianshu.com/p/af9738634a21">Spring Boot Actuator ä½¿ç”¨</a></p>

:ET