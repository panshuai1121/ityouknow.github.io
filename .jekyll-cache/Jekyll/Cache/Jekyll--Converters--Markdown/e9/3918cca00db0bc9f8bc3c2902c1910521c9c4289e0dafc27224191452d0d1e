I" W<p>urllib æ˜¯ä¸€ä¸ª python å†…ç½®åŒ…ï¼Œä¸éœ€è¦é¢å¤–å®‰è£…å³å¯ä½¿ç”¨ï¼ŒåŒ…é‡Œé¢åŒ…å«äº†ä»¥ä¸‹å‡ ä¸ªç”¨æ¥å¤„ç† url çš„æ¨¡å—ï¼š</p>

<ul>
  <li>urllib.requestï¼Œç”¨æ¥æ‰“å¼€å’Œè¯»å– urlï¼Œæ„æ€å°±æ˜¯å¯ä»¥ç”¨å®ƒæ¥æ¨¡æ‹Ÿå‘é€è¯·æ±‚ï¼Œå°±åƒåœ¨æµè§ˆå™¨é‡Œè¾“å…¥ç½‘å€ç„¶åæ•²å‡»å›è½¦ä¸€æ ·ï¼Œè·å–ç½‘é¡µå“åº”å†…å®¹ã€‚</li>
  <li>urllib.errorï¼Œç”¨æ¥å¤„ç† urllib.request å¼•èµ·çš„å¼‚å¸¸ï¼Œä¿è¯ç¨‹åºçš„æ­£å¸¸æ‰§è¡Œã€‚</li>
  <li>urllib.parseï¼Œç”¨æ¥è§£æ urlï¼Œå¯ä»¥å¯¹ url è¿›è¡Œæ‹†åˆ†ã€åˆå¹¶ç­‰ã€‚</li>
  <li>urllib.robotparseï¼Œç”¨æ¥è§£æ robots.txt æ–‡ä»¶ï¼Œåˆ¤æ–­ç½‘ç«™æ˜¯å¦èƒ½å¤Ÿè¿›è¡Œçˆ¬å–ã€‚</li>
</ul>

<p>æŒæ¡ä»¥ä¸Šå››ä¸ªæ¨¡å—ï¼Œä½ å°±èƒ½å¯¹ç½‘ç«™è¿›è¡Œç®€å•çš„çˆ¬è™«æ“ä½œï¼Œä¸‹é¢æˆ‘ä»¬é€ä¸ªä»‹ç»ã€‚</p>

<!--more-->

<h2 id="1-urllibrequest-æ¨¡å—">1 urllib.request æ¨¡å—</h2>

<p>urllib.request æ¨¡å—å®šä¹‰äº†ä»¥ä¸‹å‡ ä¸ªå‡½æ•°ã€‚</p>

<h3 id="11-urllibrequesturlopenurl-datanone-timeout--cafilenone-capathnone-cadefaultfalse-contextnone">1.1 urllib.request.urlopen(url, data=None, [timeout, ]*, cafile=None, capath=None, cadefault=False, context=None)</h3>

<p>è¯¥å‡½æ•°ä¸»è¦ç”¨äºæ¨¡æ‹Ÿç½‘ç«™è¯·æ±‚ï¼Œè¿”å›ä¸€ä¸ª HTTPResponse ç±»å‹çš„å¯¹è±¡ã€‚</p>

<h4 id="111-urlopen-å‡½æ•°ä¸­å‚æ•°å®šä¹‰">1.1.1 urlopen å‡½æ•°ä¸­å‚æ•°å®šä¹‰</h4>

<ul>
  <li>urlï¼Œå¿…é€‰å‚æ•°ï¼Œæ˜¯ä¸€ä¸ª str å­—ç¬¦ä¸²æˆ–è€… Request å¯¹è±¡(åé¢ä¼šä»‹ç»)ã€‚</li>
  <li>dataï¼Œbytes ç±»å‹çš„å¯é€‰å‚æ•°ï¼Œå¦‚æœä¼ é€’çš„æ˜¯å­—å…¸å‹æ•°æ®ï¼Œå¯ä»¥ç”¨ urllib.parse.urlencode() è¿›è¡Œç¼–ç ï¼Œè¿”å› str å­—ç¬¦ä¸²ï¼Œå†å°† str è½¬æ¢æˆ bytes å­—èŠ‚æµã€‚å¦‚æœä¼ é€’ data å‚æ•°ï¼Œurlopen å°†ä½¿ç”¨ HTTP POST æ–¹å¼è¯·æ±‚ï¼Œå¦åˆ™ä¸º HTTP GET è¯·æ±‚ã€‚</li>
  <li>timeoutï¼Œå¯é€‰å‚æ•°ï¼Œè®¾ç½®è¶…æ—¶æ—¶é—´(æœªè®¾ç½®æ—¶ä½¿ç”¨å…¨å±€é»˜è®¤è¶…æ—¶æ—¶é—´)ï¼Œä»¥ç§’ä¸ºå•ä½è®¡æ—¶ï¼Œå¦‚æœ urlopen è¯·æ±‚è¶…å‡ºäº†è®¾ç½®æ—¶é—´è¿˜æœªå¾—åˆ°å“åº”åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</li>
  <li>cafile å’Œ capathï¼Œå¯é€‰å‚æ•°ï¼Œåœ¨ HTTPS è¿æ¥è¯·æ±‚æ—¶æŒ‡å®šå·²è®¤è¯çš„ CA è¯ä¹¦ä»¥åŠè¯ä¹¦è·¯å¾„ã€‚</li>
  <li>cadefaultï¼Œä¸€èˆ¬å¯å¿½ç•¥è¯¥å‚æ•°ã€‚</li>
  <li>contextï¼Œssl.SSLContext ç±»å‹çš„å¯é€‰å‚æ•°ï¼Œç”¨æ¥æŒ‡å®š SSL è®¾ç½®ã€‚</li>
</ul>

<h4 id="112-urlopen-å‡½æ•°è¿”å›ç±»å‹">1.1.2 urlopen å‡½æ•°è¿”å›ç±»å‹</h4>

<p>urlopen å‡½æ•°è¯·æ±‚è¿”å›ä¸€ä¸ª HTTPResponse å“åº”ä¸Šä¸‹æ–‡ï¼Œæˆ–è€…è¯·æ±‚å¼‚å¸¸æŠ›å‡º URLError åè®®é”™è¯¯ï¼Œä¸€èˆ¬æœ‰å¦‚ä¸‹å±æ€§ï¼š</p>

<ul>
  <li>geturl()ï¼Œè¿”å›æ£€ç´¢çš„ urlï¼Œé€šå¸¸ç”¨äºåˆ¤å®šæ˜¯å¦è¿›è¡Œäº†é‡å®šå‘ã€‚</li>
  <li>info()ï¼Œè¿”å›ç½‘é¡µçš„å¤´ä¿¡æ¯ã€‚</li>
  <li>getcode()ï¼Œè¿”å› HTTPResponse å“åº”çš„çŠ¶æ€ç ã€‚</li>
</ul>

<h4 id="113-urlopen-å‡½æ•°çš„åº”ç”¨å®ä¾‹">1.1.3 urlopen å‡½æ•°çš„åº”ç”¨å®ä¾‹</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># åˆ›å»ºä¸€ä¸ª HTTP GET è¯·æ±‚ï¼Œè¾“å‡ºå“åº”ä¸Šä¸‹æ–‡
from urllib.request import urlopen
response = urlopen("http://www.python.org")
print(response.read()) 
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># åˆ›å»ºä¸€ä¸ª HTTP POST è¯·æ±‚ï¼Œè¾“å‡ºå“åº”ä¸Šä¸‹æ–‡
from urllib.request import urlopen
from urllib.parse import urlencode
data = {'kw' : 'python'}
data = bytes(urlencode(data), encoding = 'utf-8')
response = urlopen("https://fanyi.baidu.com/sug", data)
print(response.read().decode('unicode_escape'))
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># åˆ›å»ºä¸€ä¸ª HTTP GET è¯·æ±‚ï¼Œè®¾ç½®è¶…æ—¶æ—¶é—´ä¸º0.1s
import urllib.request
import urllib.error
try:
    response=urllib.request.urlopen('http://www.python.org',timeout=0.1)
    print(response.read()) 
except urllib.error.URLError as e:
    print(e.reason)
</code></pre></div></div>

<h3 id="12-urllibrequestrequesturl-datanone-headers-origin_req_hostnone-unverifiablefalse-methodnone">1.2 urllib.request.Request(url, data=None, headers={}, origin_req_host=None, unverifiable=False, method=None)</h3>

<p>è¯¥å‡½æ•°ä¸»è¦ç”¨äºæ„é€ ä¸€ä¸ª urlï¼Œè¿”å›ä¸€ä¸ª urllib.request.Request å¯¹è±¡ã€‚</p>

<h4 id="121-request-å‡½æ•°ä¸­å‚æ•°å®šä¹‰">1.2.1 Request å‡½æ•°ä¸­å‚æ•°å®šä¹‰</h4>

<ul>
  <li>urlï¼Œå¿…é€‰å‚æ•°ï¼Œè¯·æ±‚çš„ url åœ°å€ã€‚</li>
  <li>dataï¼Œbytes ç±»å‹çš„å¯é€‰å‚æ•°ã€‚</li>
  <li>headersï¼Œå­—å…¸ç±»å‹ï¼Œæœ‰äº› HTTP æœåŠ¡å™¨ä»…å…è®¸æ¥è‡ªæµè§ˆå™¨çš„è¯·æ±‚ï¼Œå› æ­¤é€šè¿‡ headers æ¥æ¨¡æ‹Ÿæµè§ˆå™¨å¯¹ url çš„è®¿é—®ï¼Œæ¯”å¦‚æ¨¡æ‹Ÿè°·æ­Œæµè§ˆå™¨æ—¶ä½¿ç”¨çš„ headersï¼šâ€Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.132 Safari/537.36â€ã€‚å¯ä»¥é€šè¿‡è°ƒç”¨ add_header() æ¥æ·»åŠ  headers ä¿¡æ¯ã€‚</li>
  <li>origin_req_hostï¼Œè¯·æ±‚æ–¹çš„ host åç§°æˆ–è€… IP åœ°å€ã€‚</li>
  <li>unverifiableï¼Œè¡¨ç¤ºè¿™ä¸ªè¯·æ±‚æ˜¯å¦æ— æ³•éªŒè¯ï¼Œé»˜è®¤ä¸º Falseã€‚æ¯”å¦‚è¯·æ±‚ä¸€å¼ å›¾ç‰‡ï¼Œå¦‚æœæ²¡æœ‰æƒé™è·å–å›¾ç‰‡é‚£å®ƒçš„å€¼å°±æ˜¯ trueã€‚</li>
  <li>methodï¼Œæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç”¨æ¥æŒ‡ç¤ºè¯·æ±‚ä½¿ç”¨çš„æ–¹æ³•ï¼Œå¦‚ï¼šGET,POST,PUT ç­‰ï¼Œé»˜è®¤æ˜¯ GET è¯·æ±‚ã€‚</li>
</ul>

<h4 id="122-request-å‡½æ•°è¿”å›ç±»å‹">1.2.2 Request å‡½æ•°è¿”å›ç±»å‹</h4>

<p>ä¸ urlopen å‡½æ•°è¯·æ±‚è¿”å›ä¸€æ ·ï¼Œä¸€èˆ¬è¿”å›ä¸€ä¸ª HTTPResponse å“åº”ä¸Šä¸‹æ–‡ã€‚</p>

<h4 id="123-request-å‡½æ•°çš„åº”ç”¨å®ä¾‹">1.2.3 Request å‡½æ•°çš„åº”ç”¨å®ä¾‹</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># é‡‡ç”¨ HTTP GET è¯·æ±‚çš„æ–¹æ³•æ¨¡æ‹Ÿè°·æ­Œæµè§ˆå™¨è®¿é—®ç½‘ç«™ï¼Œè¾“å‡ºå“åº”ä¸Šä¸‹æ–‡
from urllib import request,parse
url = 'http://www.python.org'
headers = {
    'User-Agent':'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.132 Safari/537.36'
}
req = request.Request(url, headers = headers, method = 'GET')
response = request.urlopen(req) 
print(response.read())
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># é‡‡ç”¨ HTTP POST è¯·æ±‚çš„æ–¹æ³•æ¨¡æ‹Ÿè°·æ­Œæµè§ˆå™¨è®¿é—®ç½‘ç«™ï¼Œè¾“å‡ºå“åº”ä¸Šä¸‹æ–‡
from urllib import request
from urllib import parse
url = 'https://fanyi.baidu.com/sug'
data = {'kw' : 'python'}
data = bytes(parse.urlencode(data), encoding = 'utf-8')
headers = {
    'User-Agent':'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.132 Safari/537.36'
}
req = request.Request(url, data, headers, method = 'POST')
response = request.urlopen(req) 
print(response.read().decode('unicode_escape'))
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># åˆ›å»ºä¸€ä¸ª HTTP GET è¯·æ±‚ï¼Œé€šè¿‡ add_header æ·»åŠ ä¸€ä¸ª UserAgent
import urllib.request
import random
url = 'http://www.python.org'
headerUserAgentList = ['Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.132 Safari/537.36',
'Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0']
randomHeaderUserAgent = random.choice(headerUserAgentList) # éšæœºé€‰å–ä¸€ä¸ª UserAgent
req = urllib.request.Request(url) 
req.add_header('User-Agent', randomHeaderUserAgent) # æ·»åŠ  UserAgent
response=urllib.request.urlopen(req)
print(req.get_header('User-agent'))
print(req.headers) # æ‰“å°è¯·æ±‚çš„ header ä¿¡æ¯
</code></pre></div></div>

<h2 id="2-urlliberror-æ¨¡å—">2 urllib.error æ¨¡å—</h2>

<p>urllib.error æ¨¡å—å®šä¹‰äº†ç”± urllib.request æ¨¡å—å¼•å‘çš„å¼‚å¸¸ï¼Œå¼‚å¸¸ä¸»è¦åŒ…å« URLError å’Œ HTTPErrorã€‚</p>

<h3 id="21-urlliberrorurlerror-å¼‚å¸¸">2.1 urllib.error.URLError å¼‚å¸¸</h3>

<p>URLError ç±»ç»§æ‰¿è‡ª OSError ç±»ï¼Œæ˜¯ error å¼‚å¸¸æ¨¡å—çš„åŸºç±»ï¼Œç”±requestæ¨¡å—äº§ç”Ÿçš„å¼‚å¸¸éƒ½å¯ä»¥é€šè¿‡æ•è·è¿™ä¸ªç±»æ¥å¤„ç†ã€‚URLError åªæœ‰ä¸€ä¸ªå±æ€§ reasonï¼Œå³è¿”å›é”™è¯¯çš„åŸå› ã€‚</p>

<p>åº”ç”¨å®ä¾‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># åœ¨è¯·æ±‚è¿æ¥æ—¶å€™æ•è·ç½‘å€é”™è¯¯å¼•å‘çš„å¼‚å¸¸
from urllib import request, error
try:
    response = request.urlopen('https://www,baidu,com')
except error.URLError as e:
    print(e.reason)
</code></pre></div></div>

<h3 id="22-urlliberrorhttperror-å¼‚å¸¸">2.2 urllib.error.HTTPError å¼‚å¸¸</h3>

<p>HTTPError æ˜¯ URLError çš„å­ç±»ï¼Œä¸“é—¨ç”¨æ¥å¤„ç† HTTP è¯·æ±‚é”™è¯¯ï¼Œæ¯”å¦‚è®¤è¯è¯·æ±‚å¤±è´¥ï¼ŒåŒ…å«ä»¥ä¸‹ä¸‰ä¸ªå±æ€§ï¼š</p>

<ul>
  <li>codeï¼šè¿”å› HTTP å“åº”çš„çŠ¶æ€ç ï¼Œå¦‚404é¡µé¢ä¸å­˜åœ¨ç­‰ã€‚</li>
  <li>reasonï¼šè¿”å›é”™è¯¯çš„åŸå› ã€‚</li>
  <li>headersï¼šè¿”å› HTTP å“åº”å¤´ä¿¡æ¯ã€‚</li>
</ul>

<p>åº”ç”¨ä¸¾ä¾‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># è¿”å›401æœªæˆæƒé”™è¯¯
from urllib import request,error
try:
    response=request.urlopen('http://pythonscraping.com/pages/auth/login.php')
    print(response.getcode())
except error.HTTPError as e:
    print('1.é”™è¯¯åŸå› ï¼š\n%s\n2.çŠ¶æ€ç ï¼š\n%s\n3.å“åº”å¤´ä¿¡æ¯ï¼š\n%s' %(e.reason, e.code, e.headers))
except error.URLError as e:
    print(e.reason)
</code></pre></div></div>

<h2 id="3-urllibparse-æ¨¡å—">3 urllib.parse æ¨¡å—</h2>

<p>urllib.parse æ¨¡å—å®šä¹‰äº†ä¸€ä¸ªå¤„ç† url çš„æ ‡å‡†æ¥å£ï¼Œç”¨æ¥å®ç° url å­—ç¬¦ä¸²çš„æŠ½å–ã€åˆå¹¶ä»¥åŠé“¾æ¥è½¬æ¢ã€‚è¯¥æ¨¡å—ä¸»è¦ç”¨åˆ°çš„å‡½æ•°å¦‚ä¸‹ã€‚</p>

<h3 id="31-urllibparseurlparseurlstring-scheme-allow_fragmentstrue">3.1 urllib.parse.urlparse(urlstring, scheme=â€™â€™, allow_fragments=True)</h3>

<p>ç”¨äºå®ç° url å­—ç¬¦ä¸²çš„è¯†åˆ«å’Œåˆ†æ®µï¼Œå¯ä»¥åˆ†ä¸ºå…­ä¸ªå­—ç¬¦ä¸²ï¼Œåˆ†åˆ«æ˜¯ scheme (åè®®)ï¼Œnetloc (åŸŸå)ï¼Œpath (è·¯å¾„)ï¼Œparams (å‚æ•°)ï¼Œquery (æŸ¥è¯¢æ¡ä»¶)å’Œ fragment (é”šç‚¹)ï¼Œå…¶ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼šâ€œscheme://netloc/path;parameters?query#fragmentâ€ã€‚å®é™…ä¸Šå…·ä½“ url æŸäº›å­—æ®µå¯èƒ½ä¼šä¸å­˜åœ¨ï¼Œæ¯”å¦‚ â€œhttp://www.baidu.comâ€ åªåŒ…å«äº†åè®®å’ŒåŸŸåã€‚</p>

<h4 id="311-urlparse-å‡½æ•°ä¸­å‚æ•°å®šä¹‰">3.1.1 urlparse å‡½æ•°ä¸­å‚æ•°å®šä¹‰</h4>

<ul>
  <li>urlstringï¼Œå¾…è§£æçš„ url å­—ç¬¦ä¸²ã€‚</li>
  <li>schemeï¼Œæ˜¯é»˜è®¤çš„åè®®ï¼Œæ¯”å¦‚ http æˆ–è€… httpsï¼Œurl å­—ç¬¦ä¸²ä¸­å¦‚æœä¸æºå¸¦ç›¸å…³åè®®ï¼Œå¯ä»¥é€šè¿‡ scheme æ¥æŒ‡å®šï¼Œå¦‚æœ url ä¸­æŒ‡å®šäº†ç›¸å…³åè®®åˆ™åœ¨ url ä¸­ç”Ÿæ•ˆã€‚</li>
  <li>allow_fragmentsï¼Œæ˜¯å¦å¿½ç•¥é”šç‚¹ï¼Œè®¾ç½®ä¸º False å³ fragment éƒ¨åˆ†ä¼šè¢«å¿½ç•¥ï¼Œåä¹‹ä¸ä¼šå¿½ç•¥ã€‚</li>
</ul>

<h4 id="312-urlparse-çš„è¿”å›ç±»å‹">3.1.2 urlparse çš„è¿”å›ç±»å‹</h4>

<p>å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ª urllib.parse.ParseResult å¯¹è±¡ï¼Œè·å–è§£æå‡ºæ¥çš„ url å…­ä¸ªå­—æ®µã€‚</p>

<h4 id="313-urlparse-åº”ç”¨ä¸¾ä¾‹">3.1.3 urlparse åº”ç”¨ä¸¾ä¾‹</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># è§£æå¹¶è¾“å‡º url ä¸­æ¯ä¸ªå­—æ®µçš„å­—ç¬¦ä¸²
import urllib
url = 'http://www.baidu.com/urllib.parse.html;python?kw=urllib.parse#module-urllib'
result = urllib.parse.urlparse(url)
print(result)
print(result.scheme, result.netloc, result.path, result.params, result.query, result.fragment, sep = '\n')
</code></pre></div></div>

<h3 id="32-urllibparseurlunparseparts">3.2 urllib.parse.urlunparse(parts)</h3>

<p>ä¸ urlparse ç›¸åï¼Œé€šè¿‡åˆ—è¡¨æˆ–è€…å…ƒç¥–çš„å½¢å¼å°†åˆ†æ®µçš„å­—ç¬¦ä¸²ç»„åˆæˆä¸€ä¸ªå®Œæ•´çš„ url å­—ç¬¦ä¸²ã€‚</p>

<h4 id="321-urlunparse-å‡½æ•°ä¸­å‚æ•°å®šä¹‰">3.2.1 urlunparse å‡½æ•°ä¸­å‚æ•°å®šä¹‰</h4>

<ul>
  <li>partsï¼Œå¯ä»¥æ˜¯åˆ—è¡¨æˆ–è€…å…ƒç»„ã€‚</li>
</ul>

<h4 id="322-urlunparse-çš„è¿”å›ç±»å‹">3.2.2 urlunparse çš„è¿”å›ç±»å‹</h4>

<p>urlunparse å‡½æ•°è¿”å›ä¸€ä¸ªæ„é€ å¥½çš„ url å­—ç¬¦ä¸²ã€‚</p>

<h4 id="323-åº”ç”¨ä¸¾ä¾‹">3.2.3 åº”ç”¨ä¸¾ä¾‹</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># é€šè¿‡ data åˆ—è¡¨æˆ–å…ƒç»„æ„é€ ä¸€ä¸ª url å¹¶è¾“å‡º
import urllib
dataList = ['http', 'www.baidu.com', '/urllib.parse.html', 'python', 'kw=urllib.parse', 'modul-urllib'] # å…­ä¸ªå­—ç¬¦ä¸²éƒ½å¿…é¡»å¡«å†™ï¼Œå¦åˆ™ä¼šå‡ºç° ValueError é”™è¯¯ï¼Œå¦‚æœæŸä¸€å­—ç¬¦ä¸²ä¸å­˜åœ¨åˆ™å¡«å…¥ç©ºå­—ç¬¦
dataTuple = ('http', 'www.baidu.com', '/urllib.parse.html', '', 'kw=urllib.parse', 'modul-urllib') # å…­ä¸ªå­—ç¬¦ä¸²éƒ½å¿…é¡»å¡«å†™ï¼Œå¦åˆ™ä¼šå‡ºç° ValueError é”™è¯¯ï¼Œå¦‚æœæŸä¸€å­—ç¬¦ä¸²ä¸å­˜åœ¨åˆ™å¡«å…¥ç©ºå­—ç¬¦
urlList = urllib.parse.urlunparse(dataList)
urlTuple = urllib.parse.urlunparse(dataTuple)
print('1.urlList:%s\n2.urlTuple:%s' % (urlList, urlTuple))
</code></pre></div></div>

<h3 id="33-urllibparseurlspliturlstring-scheme-allow_fragmentstrue">3.3 urllib.parse.urlsplit(urlstring, scheme=â€™â€™, allow_fragments=True)</h3>

<p>ä¸ urlparse å‡½æ•°ç±»ä¼¼ï¼Œä½†å®ƒåªè¿”å› url å­—ç¬¦ä¸²çš„5ä¸ªå­—æ®µï¼ŒæŠŠ params åˆå¹¶åˆ° path ä¸­ã€‚</p>

<h4 id="urlsplit-åº”ç”¨ä¸¾ä¾‹">urlsplit åº”ç”¨ä¸¾ä¾‹</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># è§£æå¹¶è¾“å‡º url ä¸­æ¯ä¸ªå­—æ®µçš„å­—ç¬¦ä¸²ï¼Œparams ä¼šåˆå¹¶åˆ° path ä¸­ã€‚
import urllib
url = 'http://www.baidu.com/urllib.parse.html;python?kw=urllib.parse#modul-urllib'
result = urllib.parse.urlsplit(url)
print(result)
print(result.scheme, result.netloc, result.path, result.query, result.fragment, sep = '\n')
</code></pre></div></div>

<h3 id="34-urllibparseurlunsplitparts">3.4 urllib.parse.urlunsplit(parts)</h3>

<p>ä¸ urlunparse å‡½æ•°ç±»ä¼¼ï¼Œå®ƒä¹Ÿæ˜¯å°† url ä¸­å„éƒ¨åˆ†å­—æ®µç»„åˆå®Œæ•´çš„ url å­—ç¬¦ä¸²çš„æ–¹æ³•ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯åˆ—è¡¨æˆ–å…ƒç»„çš„é•¿åº¦å¿…é¡»æ˜¯5ä¸ªï¼Œå› ä¸ºå®ƒæŠŠ params çœç•¥äº†ã€‚</p>

<h4 id="urlunsplit-åº”ç”¨ä¸¾ä¾‹">urlunsplit åº”ç”¨ä¸¾ä¾‹</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># é€šè¿‡ data åˆ—è¡¨æˆ–å…ƒç»„æ„é€ ä¸€ä¸ª url å¹¶è¾“å‡º
import urllib
dataList = ['http', 'www.baidu.com', '/urllib.parse.html;python', 'kw=urllib.parse', 'modul-urllib'] # äº”ä¸ªå­—ç¬¦ä¸²éƒ½å¿…é¡»å¡«å†™ï¼Œå¦åˆ™ä¼šå‡ºç° ValueError é”™è¯¯ï¼Œå¦‚æœæŸä¸€å­—ç¬¦ä¸²ä¸å­˜åœ¨åˆ™å¡«å…¥ç©ºå­—ç¬¦
dataTuple = ('http', 'www.baidu.com', '/urllib.parse.html;python', 'kw=urllib.parse', 'modul-urllib') # äº”ä¸ªå­—ç¬¦ä¸²éƒ½å¿…é¡»å¡«å†™ï¼Œå¦åˆ™ä¼šå‡ºç° ValueError é”™è¯¯ï¼Œå¦‚æœæŸä¸€å­—ç¬¦ä¸²ä¸å­˜åœ¨åˆ™å¡«å…¥ç©ºå­—ç¬¦
urlList = urllib.parse.urlunsplit(dataList)
urlTuple = urllib.parse.urlunsplit(dataTuple)
print('1.urlList:%s\n2.urlTuple:%s' % (urlList, urlTuple))
</code></pre></div></div>

<h3 id="35-urllibparsequotestring-safe-encodingnone-errorsnone">3.5 urllib.parse.quote(string, safe=â€™/â€™, encoding=None, errors=None)</h3>

<p>ä½¿ç”¨ %xx è½¬ä¹‰å­—ç¬¦æ›¿æ¢å­—ç¬¦ä¸²ä¸­çš„ç‰¹æ®Šå­—ç¬¦ï¼Œæ¯”å¦‚æ±‰å­—ã€‚å­—æ¯ã€æ•°å­—å’Œâ€˜_.-~â€™å­—ç¬¦ä¸ä¼šè¢«æ›¿æ¢ã€‚</p>

<h4 id="351-quote-å‡½æ•°ä¸­å‚æ•°å®šä¹‰">3.5.1 quote å‡½æ•°ä¸­å‚æ•°å®šä¹‰</h4>

<ul>
  <li>stringï¼Œå¯ä»¥æ˜¯ str å­—ç¬¦ä¸²æˆ– bytes ç±»å‹ã€‚</li>
  <li>safeï¼Œå¯é€‰å‚æ•°ï¼Œé»˜è®¤æ˜¯â€™/â€™ï¼ŒæŒ‡æ˜ä¸åº”è¯¥è¢«æ›¿æ¢çš„é™„åŠ  ASCII å­—ç¬¦ã€‚</li>
  <li>encoding å’Œ errorsï¼Œå¯é€‰å‚æ•°ï¼Œç”¨æ¥å®šä¹‰å¦‚ä½•å¤„ç† non-ASCII å­—ç¬¦ã€‚ä¸€èˆ¬é»˜è®¤è®¾ç½®ç¼–ç æ–¹æ³•ä¸º encoding=â€™utf-8â€™ï¼Œerrors=â€™strictâ€™ï¼Œè¿™æ„å‘³ç€ç¼–ç é”™è¯¯å°†å¼•å‘ UnicodeErrorã€‚å¦‚æœ string æ˜¯ bytes ç±»å‹ï¼Œä¸èƒ½è®¾ç½® encoding å’Œ errorsï¼Œå¦åˆ™å°†å¼•å‘ TypeErrorã€‚</li>
</ul>

<h4 id="352-quote-å‡½æ•°çš„è¿”å›ç±»å‹">3.5.2 quote å‡½æ•°çš„è¿”å›ç±»å‹</h4>

<p>quote å‡½æ•°è¿”å›ä¸€ä¸ªç¼–ç åçš„å­—ç¬¦ä¸²ã€‚</p>

<h4 id="353-åº”ç”¨ä¸¾ä¾‹">3.5.3 åº”ç”¨ä¸¾ä¾‹</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># é‡‡ç”¨ quote å¯¹ url ä¸­çš„æ±‰å­—è¿›è¡Œç¼–ç ï¼Œè¾“å‡ºç¼–ç åçš„ç»“æœ
import urllib
url = 'http://www.baidu.com/çˆ¬è™«'
result = urllib.parse.quote(url)
print(result)
url = 'http://www.baidu.com/+çˆ¬è™«'
result = urllib.parse.quote(url, '+') # æ›´æ”¹ safe å‚æ•°
print(result)
</code></pre></div></div>

<h3 id="36-urllibparseunquotestring-encodingutf-8-errorsreplace">3.6 urllib.parse.unquote(string, encoding=â€™utf-8â€™, errors=â€™replaceâ€™)</h3>

<p>ä¸ quote å‡½æ•°ç›¸åï¼ŒæŠŠ %xx è½¬ä¹‰å­—ç¬¦æ›¿æ¢æˆå­—ç¬¦ã€‚</p>

<h4 id="361-unquote-å‡½æ•°çš„å‚æ•°å®šä¹‰">3.6.1 unquote å‡½æ•°çš„å‚æ•°å®šä¹‰</h4>

<ul>
  <li>stringï¼Œå¿…é¡»æ˜¯ str å­—ç¬¦ä¸²ã€‚</li>
  <li>encoding å’Œ errorsï¼Œå¯é€‰å‚æ•°ï¼Œå®šä¹‰å¦‚ä½•å°† %xx è½¬ä¹‰å­—ç¬¦è§£ç ä¸º Unicode å­—ç¬¦ã€‚encoding é»˜è®¤ä¸º â€˜utf-8â€™ï¼Œerrors é»˜è®¤ä¸º â€˜replaceâ€™ï¼Œè¡¨ç¤ºæ— æ•ˆçš„è½¬ä¹‰å­—ç¬¦å°†ä¼šç”¨å ä½ç¬¦æ›¿æ¢ã€‚</li>
</ul>

<h4 id="362-unquote-å‡½æ•°çš„è¿”å›ç±»å‹">3.6.2 unquote å‡½æ•°çš„è¿”å›ç±»å‹</h4>

<p>unquote å‡½æ•°è¿”å›ä¸€ä¸ªè§£ç åçš„å­—ç¬¦ä¸²ã€‚</p>

<h4 id="363-åº”ç”¨ä¸¾ä¾‹">3.6.3 åº”ç”¨ä¸¾ä¾‹</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># è§£ç ç»è¿‡ quote å‡½æ•°å¤„ç†åçš„ urlï¼Œè¾“å‡ºè§£ç åçš„ç»“æœã€‚
import urllib
url = 'http://www.baidu.com/çˆ¬è™«'
result = urllib.parse.quote(url)
print(result)
result = urllib.parse.unquote(url)
print(result)
</code></pre></div></div>

<h3 id="37-urllibparseurljoinbase-url-allow_fragmentstrue">3.7 urllib.parse.urljoin(base, url, allow_fragments=True)</h3>

<p>è¯¥å‡½æ•°ç”¨æ¥å°†åŸºæœ¬ url ä¸å¦ä¸€ä¸ª url ç»„åˆï¼Œæ›´æ–°åŸºæœ¬ url å­—ç¬¦ä¸²ã€‚å®ƒä¼šä½¿ç”¨ url å¯¹åŸºæœ¬ url ä¸­ç¼ºå¤±çš„éƒ¨åˆ†è¿›è¡Œè¡¥å……ï¼Œæ¯”å¦‚ scheme (åè®®)ã€netloc (åŸŸå)å’Œ path (è·¯å¾„)ã€‚å³æ ¹æ® url å­—ç¬¦ä¸²ä¸­å¸¦æœ‰çš„å­—æ®µï¼Œå¯¹åŸºæœ¬ url ä¸­æ²¡æœ‰çš„å­—æ®µè¿›è¡Œè¡¥å……ï¼Œå·²å­˜åœ¨çš„å­—æ®µè¿›è¡Œæ›¿æ¢ã€‚</p>

<h4 id="371-urljoin-å‡½æ•°ä¸­å‚æ•°å®šä¹‰">3.7.1 urljoin å‡½æ•°ä¸­å‚æ•°å®šä¹‰</h4>

<ul>
  <li>baseï¼Œæ˜¯ä¸€ä¸ªåŸºæœ¬ urlã€‚</li>
  <li>urlï¼Œå°† scheme (åè®®)ã€netloc (åŸŸå)æˆ– path (è·¯å¾„)å­—æ®µç»„åˆè¿›åŸºæœ¬ url çš„ urlã€‚</li>
  <li>allow_fragmentsï¼Œæ˜¯å¦å¿½ç•¥é”šç‚¹ï¼Œè®¾ç½®ä¸º False å³ fragment éƒ¨åˆ†ä¼šè¢«å¿½ç•¥ï¼Œåä¹‹ä¸ä¼šå¿½ç•¥ã€‚</li>
</ul>

<h4 id="372-urljoin-å‡½æ•°è¿”å›ç±»å‹">3.7.2 urljoin å‡½æ•°è¿”å›ç±»å‹</h4>

<p>è¿”å›ç»„åˆæˆåŠŸçš„ url å­—ç¬¦ä¸²ã€‚</p>

<h4 id="373-åº”ç”¨ä¸¾ä¾‹">3.7.3 åº”ç”¨ä¸¾ä¾‹</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># åŸºäº url å¯¹ base_url è¿›è¡Œé‡æ–°ç»„åˆï¼Œå¹¶è¾“å‡ºç»„åˆç»“æœã€‚
import urllib
base_url = 'http://www.baidu.com'
url = 'https://www.google.com/urllib.parse.html;python?kw=urllib.parse#module-urllib'
result = urllib.parse.urljoin(base_url,url,False)
print(result)
</code></pre></div></div>

<h3 id="38-urllibparseurlencodequery-doseqfalse-safe-encodingnone-errorsnone-quote_viaquote_plus">3.8 urllib.parse.urlencode(query, doseq=False, safe=â€™â€™, encoding=None, errors=None, quote_via=quote_plus)</h3>

<p>urlencode å‡½æ•°å¯ä»¥å°†å­—å…¸è½¬åŒ–ä¸º GET è¯·æ±‚ä¸­çš„ query (æŸ¥è¯¢æ¡ä»¶)ï¼Œæˆ–è€…å°†å­—å…¸è½¬åŒ–ä¸º POST è¯·æ±‚ä¸­éœ€è¦ä¸Šä¼ çš„æ•°æ®ã€‚</p>

<h4 id="381-urlencode-å‡½æ•°ä¸­å‚æ•°å®šä¹‰">3.8.1 urlencode å‡½æ•°ä¸­å‚æ•°å®šä¹‰</h4>

<ul>
  <li>queryï¼Œå­—å…¸ç±»å‹ã€‚</li>
  <li>doseqï¼Œå…è®¸å­—å…¸ä¸­ä¸€ä¸ªé”®å¯¹åº”å¤šä¸ªå€¼ï¼Œç¼–ç æˆ query (æŸ¥è¯¢æ¡ä»¶)ã€‚</li>
  <li>safeã€encoding å’Œ errorsï¼Œè¿™ä¸‰ä¸ªå‚æ•°ç”± quote_via æŒ‡å®šã€‚</li>
</ul>

<h4 id="382-urlencode-å‡½æ•°è¿”å›ç±»å‹">3.8.2 urlencode å‡½æ•°è¿”å›ç±»å‹</h4>

<p>urlencode å‡½æ•°è¿”å› str å­—ç¬¦ä¸²ã€‚</p>

<h4 id="383-åº”ç”¨ä¸¾ä¾‹">3.8.3 åº”ç”¨ä¸¾ä¾‹</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># åˆ›å»º GET è¯·æ±‚
import urllib
params = {'username':'xxx','password':'123'}
base_url='http://www.baidu.com'
url=base_url + '?' + urllib.parse.urlencode(params)
print(url)
params = {'username':['xxx', 'yyy'], 'password':'123'} # username é”®å¯¹åº”å¤šä¸ªå€¼
base_url='http://www.baidu.com'
url=base_url + '?' + urllib.parse.urlencode(params) # doseq è®¾ç½®ä¸º Falseï¼Œä¼šè§£ææˆä¹±ç 
print(url)
url=base_url + '?' + urllib.parse.urlencode(params, True) # doseq è®¾ç½®ä¸º True
print(url)
</code></pre></div></div>

<h2 id="4-urllibrobotparse-æ¨¡å—">4 urllib.robotparse æ¨¡å—</h2>

<p>rebotparser æ¨¡å—æä¾›äº†ä¸€ä¸ª RobotFileParser ç±»ï¼Œä¸»è¦ç”¨æ¥è§£æç½‘ç«™ä¸Šå‘å¸ƒçš„ robots.txtï¼Œç„¶åæ ¹æ®è§£æå†…å®¹åˆ¤æ–­çˆ¬è™«æ˜¯å¦æœ‰æƒé™æ¥çˆ¬å–è¿™ä¸ªç½‘é¡µã€‚</p>

<h3 id="41-robotstxt-æ–‡ä»¶">4.1 robots.txt æ–‡ä»¶</h3>

<p>robots.txtï¼Œå­˜æ”¾äºç½‘ç«™æ ¹ç›®å½•ä¸‹ï¼Œé‡‡ç”¨ ASCII ç¼–ç çš„æ–‡æœ¬æ–‡ä»¶ï¼Œè®°å½•æ­¤ç½‘ç«™ä¸­çš„å“ªäº›å†…å®¹æ˜¯ä¸åº”è¢«çˆ¬è™«è·å–çš„ï¼Œå“ªäº›æ˜¯å¯ä»¥è¢«çˆ¬è™«è·å–çš„ã€‚</p>

<h4 id="robotstxt-æ–‡ä»¶å†…å®¹ä¸¾ä¾‹">robots.txt æ–‡ä»¶å†…å®¹ä¸¾ä¾‹</h4>

<p>User-agent: *
Disallow: /
Allow: /public/</p>

<ul>
  <li>User-agentï¼Œçˆ¬è™«çš„åç§°ï¼Œå°†å…¶è®¾ç½®ä¸º * ä»£è¡¨åè®®å¯¹ä»»ä½•çˆ¬è™«æœ‰æ•ˆï¼Œå¦‚æœè®¾ç½®ä¸º Baiduspider åˆ™ä»£è¡¨åè®®ä»…å¯¹ç™¾åº¦çˆ¬è™«æœ‰æ•ˆï¼Œè¦æ˜¯æœ‰å¤šæ¡åˆ™å¯¹å¤šä¸ªçˆ¬è™«æœ‰æ•ˆï¼Œè‡³å°‘éœ€è¦æŒ‡å®šä¸€æ¡ã€‚</li>
  <li>Disallowï¼Œç½‘é¡µä¸­ä¸å…è®¸æŠ“å–çš„ç›®å½•ï¼Œä¸Šè¿°ä¾‹å­ä¸­è®¾ç½®çš„ / ä»£è¡¨ä¸å…è®¸æŠ“å–æ‰€æœ‰çš„é¡µé¢ã€‚</li>
  <li>Allowï¼Œä¸€èˆ¬å’Œ Disallow ä¸€èµ·ä½¿ç”¨ï¼Œç”¨æ¥æ’é™¤å•ç‹¬çš„æŸäº›é™åˆ¶ï¼Œä¸Šè¿°ä¾‹å­ä¸­è®¾ç½®ä¸º /public/ è¡¨ç¤ºæ‰€æœ‰é¡µé¢ä¸å…è®¸æŠ“å–ï¼Œä½†å¯ä»¥æŠ“å– public ç›®å½•ã€‚</li>
</ul>

<h3 id="42-urllibrobotparserrobotfileparserurl-ç±»åŠå…¶å¸¸ç”¨æ–¹æ³•">4.2 urllib.robotparser.RobotFileParser(url=â€™â€™) ç±»åŠå…¶å¸¸ç”¨æ–¹æ³•</h3>

<ul>
  <li>set_url(url)ï¼Œè®¾ç½®å¼•ç”¨ robots.txt æ–‡ä»¶çš„ urlï¼Œå¦‚æœåœ¨åˆ›å»º RobotFileParser å¯¹è±¡æ—¶ä¼ å…¥äº† urlï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦ä½¿ç”¨è¿™ä¸ªæ–¹æ³•è®¾ç½® urlã€‚</li>
  <li>read()ï¼Œè¯»å– robots.txt æ–‡ä»¶å¹¶å°†å…¶æä¾›ç»™è§£æå™¨ï¼Œä¸è¿”å›ä»»ä½•å†…å®¹ã€‚</li>
  <li>parse(lines)ï¼Œç”¨æ¥è§£æ robots.txt æŸäº›è¡Œçš„å†…å®¹ï¼Œå¹¶å®‰è£…è¯­æ³•è§„åˆ™æ¥åˆ†æå†…å®¹ã€‚</li>
  <li>can_fetch(useragent, url)ï¼Œä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œç”¨æˆ·ä»£ç†ä»¥åŠè¦çˆ¬å–çš„ç½‘ç«™ï¼Œè¿”å›çš„å†…å®¹æ˜¯è¯¥ç”¨æˆ·ä»£ç†å¦å¯ä»¥æŠ“å–è¿™ä¸ªç½‘ç«™ï¼Œç»“æœä¸º True æˆ– Falseã€‚</li>
</ul>

<h4 id="åº”ç”¨ä¸¾ä¾‹">åº”ç”¨ä¸¾ä¾‹</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># ä½¿ç”¨ä¸¤ç§çˆ¬è™«ä»£ç†åˆ†åˆ«æŸ¥çœ‹æ˜¯å¦å¯ä»¥å¯¹ 'http://www.baidu.com' ç½‘ç«™è¿›è¡Œçˆ¬å–
from urllib.robotparser import RobotFileParser
rp = RobotFileParser()
rp.set_url("http://www.baidu.com/robots.txt")
rp.read()
print(rp.can_fetch('Baiduspider', 'http://www.baidu.com')) 
print(rp.can_fetch('*', 'http://www.baidu.com'))
</code></pre></div></div>

<h2 id="5-æ€»ç»“">5 æ€»ç»“</h2>

<p>æœ¬èŠ‚ç»™å¤§å®¶ä»‹ç»äº† Python ä¸­ urllib åŒ…çš„ä½¿ç”¨ï¼Œä¸º Python å·¥ç¨‹å¸ˆå¯¹è¯¥åŒ…çš„ä½¿ç”¨æä¾›äº†æ”¯æ’‘ï¼Œäº†è§£çˆ¬å–ç½‘ç«™æ‰€éœ€çš„ä¸€äº›åŸºæœ¬å‡½æ•°æ“ä½œã€‚</p>

<h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2>

<p>[1] https://docs.python.org/3/library/urllib.html</p>

<p>[2] https://www.cnblogs.com/zhangxinqi/p/9170312.html</p>

<blockquote>
  <p>ç¤ºä¾‹ä»£ç ï¼š<a href="https://github.com/JustDoPython/python-100-day/tree/master/day-056-urllib">Python-100-days-day056</a></p>
</blockquote>
:ET